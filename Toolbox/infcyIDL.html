<!DOCTYPE html>
<!-- Generated by Cython 0.29.3 -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Cython: infcyIDL.pyx</title>
    <style type="text/css">
    
body.cython { font-family: courier; font-size: 12; }

.cython.tag  {  }
.cython.line { margin: 0em }
.cython.code { font-size: 9; color: #444444; display: none; margin: 0px 0px 0px 8px; border-left: 8px none; }

.cython.line .run { background-color: #B0FFB0; }
.cython.line .mis { background-color: #FFB0B0; }
.cython.code.run  { border-left: 8px solid #B0FFB0; }
.cython.code.mis  { border-left: 8px solid #FFB0B0; }

.cython.code .py_c_api  { color: red; }
.cython.code .py_macro_api  { color: #FF7000; }
.cython.code .pyx_c_api  { color: #FF3000; }
.cython.code .pyx_macro_api  { color: #FF7000; }
.cython.code .refnanny  { color: #FFA000; }
.cython.code .trace  { color: #FFA000; }
.cython.code .error_goto  { color: #FFA000; }

.cython.code .coerce  { color: #008000; border: 1px dotted #008000 }
.cython.code .py_attr { color: #FF0000; font-weight: bold; }
.cython.code .c_attr  { color: #0000FF; }
.cython.code .py_call { color: #FF0000; font-weight: bold; }
.cython.code .c_call  { color: #0000FF; }

.cython.score-0 {background-color: #FFFFff;}
.cython.score-1 {background-color: #FFFFe7;}
.cython.score-2 {background-color: #FFFFd4;}
.cython.score-3 {background-color: #FFFFc4;}
.cython.score-4 {background-color: #FFFFb6;}
.cython.score-5 {background-color: #FFFFaa;}
.cython.score-6 {background-color: #FFFF9f;}
.cython.score-7 {background-color: #FFFF96;}
.cython.score-8 {background-color: #FFFF8d;}
.cython.score-9 {background-color: #FFFF86;}
.cython.score-10 {background-color: #FFFF7f;}
.cython.score-11 {background-color: #FFFF79;}
.cython.score-12 {background-color: #FFFF73;}
.cython.score-13 {background-color: #FFFF6e;}
.cython.score-14 {background-color: #FFFF6a;}
.cython.score-15 {background-color: #FFFF66;}
.cython.score-16 {background-color: #FFFF62;}
.cython.score-17 {background-color: #FFFF5e;}
.cython.score-18 {background-color: #FFFF5b;}
.cython.score-19 {background-color: #FFFF57;}
.cython.score-20 {background-color: #FFFF55;}
.cython.score-21 {background-color: #FFFF52;}
.cython.score-22 {background-color: #FFFF4f;}
.cython.score-23 {background-color: #FFFF4d;}
.cython.score-24 {background-color: #FFFF4b;}
.cython.score-25 {background-color: #FFFF48;}
.cython.score-26 {background-color: #FFFF46;}
.cython.score-27 {background-color: #FFFF44;}
.cython.score-28 {background-color: #FFFF43;}
.cython.score-29 {background-color: #FFFF41;}
.cython.score-30 {background-color: #FFFF3f;}
.cython.score-31 {background-color: #FFFF3e;}
.cython.score-32 {background-color: #FFFF3c;}
.cython.score-33 {background-color: #FFFF3b;}
.cython.score-34 {background-color: #FFFF39;}
.cython.score-35 {background-color: #FFFF38;}
.cython.score-36 {background-color: #FFFF37;}
.cython.score-37 {background-color: #FFFF36;}
.cython.score-38 {background-color: #FFFF35;}
.cython.score-39 {background-color: #FFFF34;}
.cython.score-40 {background-color: #FFFF33;}
.cython.score-41 {background-color: #FFFF32;}
.cython.score-42 {background-color: #FFFF31;}
.cython.score-43 {background-color: #FFFF30;}
.cython.score-44 {background-color: #FFFF2f;}
.cython.score-45 {background-color: #FFFF2e;}
.cython.score-46 {background-color: #FFFF2d;}
.cython.score-47 {background-color: #FFFF2c;}
.cython.score-48 {background-color: #FFFF2b;}
.cython.score-49 {background-color: #FFFF2b;}
.cython.score-50 {background-color: #FFFF2a;}
.cython.score-51 {background-color: #FFFF29;}
.cython.score-52 {background-color: #FFFF29;}
.cython.score-53 {background-color: #FFFF28;}
.cython.score-54 {background-color: #FFFF27;}
.cython.score-55 {background-color: #FFFF27;}
.cython.score-56 {background-color: #FFFF26;}
.cython.score-57 {background-color: #FFFF26;}
.cython.score-58 {background-color: #FFFF25;}
.cython.score-59 {background-color: #FFFF24;}
.cython.score-60 {background-color: #FFFF24;}
.cython.score-61 {background-color: #FFFF23;}
.cython.score-62 {background-color: #FFFF23;}
.cython.score-63 {background-color: #FFFF22;}
.cython.score-64 {background-color: #FFFF22;}
.cython.score-65 {background-color: #FFFF22;}
.cython.score-66 {background-color: #FFFF21;}
.cython.score-67 {background-color: #FFFF21;}
.cython.score-68 {background-color: #FFFF20;}
.cython.score-69 {background-color: #FFFF20;}
.cython.score-70 {background-color: #FFFF1f;}
.cython.score-71 {background-color: #FFFF1f;}
.cython.score-72 {background-color: #FFFF1f;}
.cython.score-73 {background-color: #FFFF1e;}
.cython.score-74 {background-color: #FFFF1e;}
.cython.score-75 {background-color: #FFFF1e;}
.cython.score-76 {background-color: #FFFF1d;}
.cython.score-77 {background-color: #FFFF1d;}
.cython.score-78 {background-color: #FFFF1c;}
.cython.score-79 {background-color: #FFFF1c;}
.cython.score-80 {background-color: #FFFF1c;}
.cython.score-81 {background-color: #FFFF1c;}
.cython.score-82 {background-color: #FFFF1b;}
.cython.score-83 {background-color: #FFFF1b;}
.cython.score-84 {background-color: #FFFF1b;}
.cython.score-85 {background-color: #FFFF1a;}
.cython.score-86 {background-color: #FFFF1a;}
.cython.score-87 {background-color: #FFFF1a;}
.cython.score-88 {background-color: #FFFF1a;}
.cython.score-89 {background-color: #FFFF19;}
.cython.score-90 {background-color: #FFFF19;}
.cython.score-91 {background-color: #FFFF19;}
.cython.score-92 {background-color: #FFFF19;}
.cython.score-93 {background-color: #FFFF18;}
.cython.score-94 {background-color: #FFFF18;}
.cython.score-95 {background-color: #FFFF18;}
.cython.score-96 {background-color: #FFFF18;}
.cython.score-97 {background-color: #FFFF17;}
.cython.score-98 {background-color: #FFFF17;}
.cython.score-99 {background-color: #FFFF17;}
.cython.score-100 {background-color: #FFFF17;}
.cython.score-101 {background-color: #FFFF16;}
.cython.score-102 {background-color: #FFFF16;}
.cython.score-103 {background-color: #FFFF16;}
.cython.score-104 {background-color: #FFFF16;}
.cython.score-105 {background-color: #FFFF16;}
.cython.score-106 {background-color: #FFFF15;}
.cython.score-107 {background-color: #FFFF15;}
.cython.score-108 {background-color: #FFFF15;}
.cython.score-109 {background-color: #FFFF15;}
.cython.score-110 {background-color: #FFFF15;}
.cython.score-111 {background-color: #FFFF15;}
.cython.score-112 {background-color: #FFFF14;}
.cython.score-113 {background-color: #FFFF14;}
.cython.score-114 {background-color: #FFFF14;}
.cython.score-115 {background-color: #FFFF14;}
.cython.score-116 {background-color: #FFFF14;}
.cython.score-117 {background-color: #FFFF14;}
.cython.score-118 {background-color: #FFFF13;}
.cython.score-119 {background-color: #FFFF13;}
.cython.score-120 {background-color: #FFFF13;}
.cython.score-121 {background-color: #FFFF13;}
.cython.score-122 {background-color: #FFFF13;}
.cython.score-123 {background-color: #FFFF13;}
.cython.score-124 {background-color: #FFFF13;}
.cython.score-125 {background-color: #FFFF12;}
.cython.score-126 {background-color: #FFFF12;}
.cython.score-127 {background-color: #FFFF12;}
.cython.score-128 {background-color: #FFFF12;}
.cython.score-129 {background-color: #FFFF12;}
.cython.score-130 {background-color: #FFFF12;}
.cython.score-131 {background-color: #FFFF12;}
.cython.score-132 {background-color: #FFFF11;}
.cython.score-133 {background-color: #FFFF11;}
.cython.score-134 {background-color: #FFFF11;}
.cython.score-135 {background-color: #FFFF11;}
.cython.score-136 {background-color: #FFFF11;}
.cython.score-137 {background-color: #FFFF11;}
.cython.score-138 {background-color: #FFFF11;}
.cython.score-139 {background-color: #FFFF11;}
.cython.score-140 {background-color: #FFFF11;}
.cython.score-141 {background-color: #FFFF10;}
.cython.score-142 {background-color: #FFFF10;}
.cython.score-143 {background-color: #FFFF10;}
.cython.score-144 {background-color: #FFFF10;}
.cython.score-145 {background-color: #FFFF10;}
.cython.score-146 {background-color: #FFFF10;}
.cython.score-147 {background-color: #FFFF10;}
.cython.score-148 {background-color: #FFFF10;}
.cython.score-149 {background-color: #FFFF10;}
.cython.score-150 {background-color: #FFFF0f;}
.cython.score-151 {background-color: #FFFF0f;}
.cython.score-152 {background-color: #FFFF0f;}
.cython.score-153 {background-color: #FFFF0f;}
.cython.score-154 {background-color: #FFFF0f;}
.cython.score-155 {background-color: #FFFF0f;}
.cython.score-156 {background-color: #FFFF0f;}
.cython.score-157 {background-color: #FFFF0f;}
.cython.score-158 {background-color: #FFFF0f;}
.cython.score-159 {background-color: #FFFF0f;}
.cython.score-160 {background-color: #FFFF0f;}
.cython.score-161 {background-color: #FFFF0e;}
.cython.score-162 {background-color: #FFFF0e;}
.cython.score-163 {background-color: #FFFF0e;}
.cython.score-164 {background-color: #FFFF0e;}
.cython.score-165 {background-color: #FFFF0e;}
.cython.score-166 {background-color: #FFFF0e;}
.cython.score-167 {background-color: #FFFF0e;}
.cython.score-168 {background-color: #FFFF0e;}
.cython.score-169 {background-color: #FFFF0e;}
.cython.score-170 {background-color: #FFFF0e;}
.cython.score-171 {background-color: #FFFF0e;}
.cython.score-172 {background-color: #FFFF0e;}
.cython.score-173 {background-color: #FFFF0d;}
.cython.score-174 {background-color: #FFFF0d;}
.cython.score-175 {background-color: #FFFF0d;}
.cython.score-176 {background-color: #FFFF0d;}
.cython.score-177 {background-color: #FFFF0d;}
.cython.score-178 {background-color: #FFFF0d;}
.cython.score-179 {background-color: #FFFF0d;}
.cython.score-180 {background-color: #FFFF0d;}
.cython.score-181 {background-color: #FFFF0d;}
.cython.score-182 {background-color: #FFFF0d;}
.cython.score-183 {background-color: #FFFF0d;}
.cython.score-184 {background-color: #FFFF0d;}
.cython.score-185 {background-color: #FFFF0d;}
.cython.score-186 {background-color: #FFFF0d;}
.cython.score-187 {background-color: #FFFF0c;}
.cython.score-188 {background-color: #FFFF0c;}
.cython.score-189 {background-color: #FFFF0c;}
.cython.score-190 {background-color: #FFFF0c;}
.cython.score-191 {background-color: #FFFF0c;}
.cython.score-192 {background-color: #FFFF0c;}
.cython.score-193 {background-color: #FFFF0c;}
.cython.score-194 {background-color: #FFFF0c;}
.cython.score-195 {background-color: #FFFF0c;}
.cython.score-196 {background-color: #FFFF0c;}
.cython.score-197 {background-color: #FFFF0c;}
.cython.score-198 {background-color: #FFFF0c;}
.cython.score-199 {background-color: #FFFF0c;}
.cython.score-200 {background-color: #FFFF0c;}
.cython.score-201 {background-color: #FFFF0c;}
.cython.score-202 {background-color: #FFFF0c;}
.cython.score-203 {background-color: #FFFF0b;}
.cython.score-204 {background-color: #FFFF0b;}
.cython.score-205 {background-color: #FFFF0b;}
.cython.score-206 {background-color: #FFFF0b;}
.cython.score-207 {background-color: #FFFF0b;}
.cython.score-208 {background-color: #FFFF0b;}
.cython.score-209 {background-color: #FFFF0b;}
.cython.score-210 {background-color: #FFFF0b;}
.cython.score-211 {background-color: #FFFF0b;}
.cython.score-212 {background-color: #FFFF0b;}
.cython.score-213 {background-color: #FFFF0b;}
.cython.score-214 {background-color: #FFFF0b;}
.cython.score-215 {background-color: #FFFF0b;}
.cython.score-216 {background-color: #FFFF0b;}
.cython.score-217 {background-color: #FFFF0b;}
.cython.score-218 {background-color: #FFFF0b;}
.cython.score-219 {background-color: #FFFF0b;}
.cython.score-220 {background-color: #FFFF0b;}
.cython.score-221 {background-color: #FFFF0b;}
.cython.score-222 {background-color: #FFFF0a;}
.cython.score-223 {background-color: #FFFF0a;}
.cython.score-224 {background-color: #FFFF0a;}
.cython.score-225 {background-color: #FFFF0a;}
.cython.score-226 {background-color: #FFFF0a;}
.cython.score-227 {background-color: #FFFF0a;}
.cython.score-228 {background-color: #FFFF0a;}
.cython.score-229 {background-color: #FFFF0a;}
.cython.score-230 {background-color: #FFFF0a;}
.cython.score-231 {background-color: #FFFF0a;}
.cython.score-232 {background-color: #FFFF0a;}
.cython.score-233 {background-color: #FFFF0a;}
.cython.score-234 {background-color: #FFFF0a;}
.cython.score-235 {background-color: #FFFF0a;}
.cython.score-236 {background-color: #FFFF0a;}
.cython.score-237 {background-color: #FFFF0a;}
.cython.score-238 {background-color: #FFFF0a;}
.cython.score-239 {background-color: #FFFF0a;}
.cython.score-240 {background-color: #FFFF0a;}
.cython.score-241 {background-color: #FFFF0a;}
.cython.score-242 {background-color: #FFFF0a;}
.cython.score-243 {background-color: #FFFF0a;}
.cython.score-244 {background-color: #FFFF0a;}
.cython.score-245 {background-color: #FFFF0a;}
.cython.score-246 {background-color: #FFFF09;}
.cython.score-247 {background-color: #FFFF09;}
.cython.score-248 {background-color: #FFFF09;}
.cython.score-249 {background-color: #FFFF09;}
.cython.score-250 {background-color: #FFFF09;}
.cython.score-251 {background-color: #FFFF09;}
.cython.score-252 {background-color: #FFFF09;}
.cython.score-253 {background-color: #FFFF09;}
.cython.score-254 {background-color: #FFFF09;}
    </style>
</head>
<body class="cython">
<p><span style="border-bottom: solid 1px grey;">Generated by Cython 0.29.3</span></p>
<p>
    <span style="background-color: #FFFF00">Yellow lines</span> hint at Python interaction.<br />
    Click on a line that starts with a "<code>+</code>" to see the C code that Cython generated for it.
</p>
<p>Raw output: <a href="infcyIDL.cpp">infcyIDL.cpp</a></p>
<div class="cython"><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">001</span>: # cython: infer_types=True</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_test, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">002</span>: # distutils: language=c++</pre>
<pre class="cython line score-0">&#xA0;<span class="">003</span>: # __author__ = 'Fiona Lippert'</pre>
<pre class="cython line score-0">&#xA0;<span class="">004</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">005</span>: # MODELS</pre>
<pre class="cython line score-0">&#xA0;<span class="">006</span>: from Models.models cimport Model</pre>
<pre class="cython line score-0">&#xA0;<span class="">007</span>: from Models.fastIsing cimport Ising</pre>
<pre class="cython line score-0">&#xA0;<span class="">008</span>: </pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">009</span>: import numpy as np</pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_numpy, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 9, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_np, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 9, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">010</span>: cimport numpy as np</pre>
<pre class="cython line score-0">&#xA0;<span class="">011</span>: cimport cython</pre>
<pre class="cython line score-0">&#xA0;<span class="">012</span>: from cython.parallel cimport parallel, prange, threadid</pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">013</span>: import multiprocessing as mp</pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_multiprocessing, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 13, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_mp, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 13, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">014</span>: import copy</pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_copy, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 14, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_copy, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 14, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">015</span>: from cpython.ref cimport PyObject</pre>
<pre class="cython line score-0">&#xA0;<span class="">016</span>: </pre>
<pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">017</span>: from scipy.stats import linregress</pre>
<pre class='cython code score-19 '>  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 17, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_linregress);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_linregress);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, __pyx_n_s_linregress);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_scipy_stats, __pyx_t_1, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 17, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_2, __pyx_n_s_linregress);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 17, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_linregress, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 17, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">018</span>: from scipy.signal import correlate</pre>
<pre class='cython code score-19 '>  __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 18, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_correlate);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_correlate);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 0, __pyx_n_s_correlate);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_scipy_signal, __pyx_t_2, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 18, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_1, __pyx_n_s_correlate);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 18, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_correlate, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 18, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">019</span>: import scipy</pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_scipy, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 19, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_scipy, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 19, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">020</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">021</span>: # progressbar</pre>
<pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">022</span>: from tqdm import tqdm   #progress bar</pre>
<pre class='cython code score-19 '>  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 22, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_tqdm);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_tqdm);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, __pyx_n_s_tqdm);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_tqdm, __pyx_t_1, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 22, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_2, __pyx_n_s_tqdm);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 22, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_tqdm, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 22, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">023</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">024</span>: # cython</pre>
<pre class="cython line score-0">&#xA0;<span class="">025</span>: from libcpp.vector cimport vector</pre>
<pre class="cython line score-0">&#xA0;<span class="">026</span>: from libcpp.string cimport string</pre>
<pre class="cython line score-0">&#xA0;<span class="">027</span>: from libc.stdlib cimport srand, malloc, free</pre>
<pre class="cython line score-0">&#xA0;<span class="">028</span>: from libc.math cimport exp, log2, sqrt</pre>
<pre class="cython line score-0">&#xA0;<span class="">029</span>: from libcpp.unordered_map cimport unordered_map</pre>
<pre class="cython line score-0">&#xA0;<span class="">030</span>: from libc.stdio cimport printf</pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">031</span>: import ctypes</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_ctypes, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 31, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_ctypes, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 31, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">032</span>: from cython.view cimport array as cvarray</pre>
<pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">033</span>: from timeit import default_timer as timer</pre>
<pre class='cython code score-19 '>  __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 33, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_default_timer);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_default_timer);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 0, __pyx_n_s_default_timer);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_timeit, __pyx_t_2, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 33, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_1, __pyx_n_s_default_timer);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 33, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_timer, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 33, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">034</span>: from cython.operator cimport dereference as deref, preincrement as prec</pre>
<pre class="cython line score-0">&#xA0;<span class="">035</span>: from cpython cimport PyObject, Py_XINCREF, Py_XDECREF</pre>
<pre class="cython line score-0">&#xA0;<span class="">036</span>: from cpython.mem cimport PyMem_Malloc, PyMem_Realloc, PyMem_Free</pre>
<pre class="cython line score-0">&#xA0;<span class="">037</span>: cdef extern from *:</pre>
<pre class="cython line score-0">&#xA0;<span class="">038</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">039</span>:     #include &lt;Python.h&gt;</pre>
<pre class="cython line score-0">&#xA0;<span class="">040</span>:     #include &lt;mutex&gt;</pre>
<pre class="cython line score-0">&#xA0;<span class="">041</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">042</span>:     std::mutex ref_mutex;</pre>
<pre class="cython line score-0">&#xA0;<span class="">043</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">044</span>:     class PyObjectHolder{</pre>
<pre class="cython line score-0">&#xA0;<span class="">045</span>:     public:</pre>
<pre class="cython line score-0">&#xA0;<span class="">046</span>:         PyObject *ptr;</pre>
<pre class="cython line score-0">&#xA0;<span class="">047</span>:         PyObjectHolder():ptr(nullptr){}</pre>
<pre class="cython line score-0">&#xA0;<span class="">048</span>:         PyObjectHolder(PyObject *o):ptr(o){</pre>
<pre class="cython line score-0">&#xA0;<span class="">049</span>:             std::lock_guard&lt;std::mutex&gt; guard(ref_mutex);</pre>
<pre class="cython line score-0">&#xA0;<span class="">050</span>:             Py_XINCREF(ptr);</pre>
<pre class="cython line score-0">&#xA0;<span class="">051</span>:         }</pre>
<pre class="cython line score-0">&#xA0;<span class="">052</span>:         //rule of 3</pre>
<pre class="cython line score-0">&#xA0;<span class="">053</span>:         ~PyObjectHolder(){</pre>
<pre class="cython line score-0">&#xA0;<span class="">054</span>:             std::lock_guard&lt;std::mutex&gt; guard(ref_mutex);</pre>
<pre class="cython line score-0">&#xA0;<span class="">055</span>:             Py_XDECREF(ptr);</pre>
<pre class="cython line score-0">&#xA0;<span class="">056</span>:         }</pre>
<pre class="cython line score-0">&#xA0;<span class="">057</span>:         PyObjectHolder(const PyObjectHolder &amp;h):</pre>
<pre class="cython line score-0">&#xA0;<span class="">058</span>:             PyObjectHolder(h.ptr){}</pre>
<pre class="cython line score-0">&#xA0;<span class="">059</span>:         PyObjectHolder&amp; operator=(const PyObjectHolder &amp;other){</pre>
<pre class="cython line score-0">&#xA0;<span class="">060</span>:             {</pre>
<pre class="cython line score-0">&#xA0;<span class="">061</span>:                 std::lock_guard&lt;std::mutex&gt; guard(ref_mutex);</pre>
<pre class="cython line score-0">&#xA0;<span class="">062</span>:                 Py_XDECREF(ptr);</pre>
<pre class="cython line score-0">&#xA0;<span class="">063</span>:                 ptr=other.ptr;</pre>
<pre class="cython line score-0">&#xA0;<span class="">064</span>:                 Py_XINCREF(ptr);</pre>
<pre class="cython line score-0">&#xA0;<span class="">065</span>:             }</pre>
<pre class="cython line score-0">&#xA0;<span class="">066</span>:             return *this;</pre>
<pre class="cython line score-0">&#xA0;<span class="">067</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">068</span>:         }</pre>
<pre class="cython line score-0">&#xA0;<span class="">069</span>:     };</pre>
<pre class="cython line score-0">&#xA0;<span class="">070</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">071</span>:     cdef cppclass PyObjectHolder:</pre>
<pre class="cython line score-0">&#xA0;<span class="">072</span>:         PyObject *ptr</pre>
<pre class="cython line score-0">&#xA0;<span class="">073</span>:         PyObjectHolder(PyObject *o) nogil</pre>
<pre class="cython line score-0">&#xA0;<span class="">074</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">075</span>: </pre>
<pre class="cython line score-21" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">076</span>: def checkDistribution():</pre>
<pre class='cython code score-21 '>/* Python wrapper */
static PyObject *__pyx_pw_7Toolbox_8infcyIDL_1checkDistribution(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_7Toolbox_8infcyIDL_checkDistribution[] = "Warning statement";
static PyMethodDef __pyx_mdef_7Toolbox_8infcyIDL_1checkDistribution = {"checkDistribution", (PyCFunction)__pyx_pw_7Toolbox_8infcyIDL_1checkDistribution, METH_NOARGS, __pyx_doc_7Toolbox_8infcyIDL_checkDistribution};
static PyObject *__pyx_pw_7Toolbox_8infcyIDL_1checkDistribution(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("checkDistribution (wrapper)", 0);
  __pyx_r = __pyx_pf_7Toolbox_8infcyIDL_checkDistribution(__pyx_self);

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_7Toolbox_8infcyIDL_checkDistribution(CYTHON_UNUSED PyObject *__pyx_self) {
  PyObject *__pyx_v_platform = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("checkDistribution", 0);
/* … */
  /* function exit code */
  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.checkDistribution", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_platform);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__41 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_n_s_platform);<span class='error_goto'> if (unlikely(!__pyx_tuple__41)) __PYX_ERR(0, 76, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__41);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__41);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_7Toolbox_8infcyIDL_1checkDistribution, NULL, __pyx_n_s_Toolbox_infcyIDL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 76, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_checkDistribution, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 76, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__42 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(0, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__41, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Toolbox_infcyIDL_pyx, __pyx_n_s_checkDistribution, 76, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__42)) __PYX_ERR(0, 76, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">077</span>:     '''Warning statement'''</pre>
<pre class="cython line score-15" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">078</span>:     from platform import platform</pre>
<pre class='cython code score-15 '>  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 78, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_platform);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_platform);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, __pyx_n_s_platform);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_platform, __pyx_t_1, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 78, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_2, __pyx_n_s_platform);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 78, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
  __pyx_v_platform = __pyx_t_1;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-39" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">079</span>:     if 'windows' in platform().lower():</pre>
<pre class='cython code score-39 '>  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_platform);
  __pyx_t_3 = __pyx_v_platform; __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_4) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 79, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_lower);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 79, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_1 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_1)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  __pyx_t_2 = (__pyx_t_1) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_1) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 79, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_5 = (<span class='pyx_c_api'>__Pyx_PySequence_ContainsTF</span>(__pyx_n_u_windows, __pyx_t_2, Py_EQ)); if (unlikely(__pyx_t_5 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 79, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_6 = (__pyx_t_5 != 0);
  if (__pyx_t_6) {
/* … */
  }
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">080</span>:         print('Warning: Windows detected. Please remember to respect the GIL'\</pre>
<pre class='cython code score-8 '>    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_builtin_print, __pyx_tuple_, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 80, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
/* … */
  __pyx_tuple_ = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_kp_u_Warning_Windows_detected_Please);<span class='error_goto'> if (unlikely(!__pyx_tuple_)) __PYX_ERR(0, 80, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple_);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple_);
</pre><pre class="cython line score-0">&#xA0;<span class="">081</span>:               ' when using multi-core functions')</pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">082</span>: checkDistribution()</pre>
<pre class='cython code score-6 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_checkDistribution);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 82, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">083</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">084</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">085</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">086</span>: @cython.wraparound(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">087</span>: @cython.nonecheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">088</span>: @cython.cdivision(True)</pre>
<pre class="cython line score-0">&#xA0;<span class="">089</span>: @cython.initializedcheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">090</span>: @cython.overflowcheck(False)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">091</span>: cdef double mean(long[::1] arr, long len, int abs=0) nogil:</pre>
<pre class='cython code score-0 '>static double __pyx_f_7Toolbox_8infcyIDL_mean(__Pyx_memviewslice __pyx_v_arr, long __pyx_v_len, struct __pyx_opt_args_7Toolbox_8infcyIDL_mean *__pyx_optional_args) {
  int __pyx_v_abs = ((int)0);
  double __pyx_v_mu;
  long __pyx_v_i;
  double __pyx_r;
  if (__pyx_optional_args) {
    if (__pyx_optional_args-&gt;__pyx_n &gt; 0) {
      __pyx_v_abs = __pyx_optional_args-&gt;abs;
    }
  }
/* … */
  /* function exit code */
  __pyx_L0:;
  return __pyx_r;
}
/* … */
struct __pyx_opt_args_7Toolbox_8infcyIDL_mean {
  int __pyx_n;
  int abs;
};
</pre><pre class="cython line score-0">&#xA0;<span class="">092</span>:     cdef:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">093</span>:         double mu = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_mu = 0.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">094</span>:         long i</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">095</span>:     for i in range(len):</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_len;
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">096</span>:         mu = mu + arr[i]</pre>
<pre class='cython code score-0 '>    __pyx_t_4 = __pyx_v_i;
    __pyx_v_mu = (__pyx_v_mu + (*((long *) ( /* dim=0 */ ((char *) (((long *) __pyx_v_arr.data) + __pyx_t_4)) ))));
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">097</span>:     mu = mu / len</pre>
<pre class='cython code score-0 '>  __pyx_v_mu = (__pyx_v_mu / ((double)__pyx_v_len));
</pre><pre class="cython line score-0">&#xA0;<span class="">098</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">099</span>:     if abs and mu &lt; 0:</pre>
<pre class='cython code score-0 '>  __pyx_t_6 = (__pyx_v_abs != 0);
  if (__pyx_t_6) {
  } else {
    __pyx_t_5 = __pyx_t_6;
    goto __pyx_L6_bool_binop_done;
  }
  __pyx_t_6 = ((__pyx_v_mu &lt; 0.0) != 0);
  __pyx_t_5 = __pyx_t_6;
  __pyx_L6_bool_binop_done:;
  if (__pyx_t_5) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">100</span>:         return -mu</pre>
<pre class='cython code score-0 '>    __pyx_r = (-__pyx_v_mu);
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">101</span>:     else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">102</span>:         return mu</pre>
<pre class='cython code score-0 '>  /*else*/ {
    __pyx_r = __pyx_v_mu;
    goto __pyx_L0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">103</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">104</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">105</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">106</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">107</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">108</span>: @cython.wraparound(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">109</span>: @cython.nonecheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">110</span>: @cython.cdivision(True)</pre>
<pre class="cython line score-0">&#xA0;<span class="">111</span>: @cython.initializedcheck(False)</pre>
<pre class="cython line score-78" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">112</span>: cpdef tuple getSnapshotsPerDist2(Model model, long node, \</pre>
<pre class='cython code score-78 '>static PyObject *__pyx_pw_7Toolbox_8infcyIDL_3getSnapshotsPerDist2(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_7Toolbox_8infcyIDL_getSnapshotsPerDist2(struct __pyx_obj_6Models_6models_Model *__pyx_v_model, long __pyx_v_node, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_7Toolbox_8infcyIDL_getSnapshotsPerDist2 *__pyx_optional_args) {
  long __pyx_v_nSamples = __pyx_k__2;
  long __pyx_v_burninSamples = __pyx_k__3;
  int __pyx_v_maxDist = ((int)1);
  std::vector&lt;std::unordered_map&lt;std::string,double&gt; &gt;  __pyx_v_snapshots;
  long __pyx_v_d;
  long __pyx_v_sample;
  double __pyx_v_part;
  std::string __pyx_v_state;
  std::vector&lt;PyObjectHolder&gt;  __pyx_v_models_;
  int __pyx_v_tid;
  int __pyx_v_nThreads;
  std::unordered_map&lt;long,std::vector&lt;long&gt; &gt;  __pyx_v_allNeighbours_G;
  std::unordered_map&lt;long,std::vector&lt;long&gt; &gt;  __pyx_v_allNeighbours_idx;
  PyObject *__pyx_v_tmp = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("getSnapshotsPerDist2", 0);
  if (__pyx_optional_args) {
    if (__pyx_optional_args-&gt;__pyx_n &gt; 0) {
      __pyx_v_nSamples = __pyx_optional_args-&gt;nSamples;
      if (__pyx_optional_args-&gt;__pyx_n &gt; 1) {
        __pyx_v_burninSamples = __pyx_optional_args-&gt;burninSamples;
        if (__pyx_optional_args-&gt;__pyx_n &gt; 2) {
          __pyx_v_maxDist = __pyx_optional_args-&gt;maxDist;
        }
      }
    }
  }
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_t_14));
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_15, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_19);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.getSnapshotsPerDist2", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_tmp);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_7Toolbox_8infcyIDL_3getSnapshotsPerDist2(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_7Toolbox_8infcyIDL_2getSnapshotsPerDist2[] = "\n    Extract snapshots from MC for large network, for which the decimal encoding causes overflows\n    Take nSamples snapshots for each set of neighbours at distance d, ranging from d=1 to d=maxDist\n    ";
static PyObject *__pyx_pw_7Toolbox_8infcyIDL_3getSnapshotsPerDist2(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_6Models_6models_Model *__pyx_v_model = 0;
  long __pyx_v_node;
  long __pyx_v_nSamples;
  long __pyx_v_burninSamples;
  int __pyx_v_maxDist;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("getSnapshotsPerDist2 (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_model,&amp;__pyx_n_s_node,&amp;__pyx_n_s_nSamples,&amp;__pyx_n_s_burninSamples,&amp;__pyx_n_s_maxDist,0};
    PyObject* values[5] = {0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_model)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_node)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("getSnapshotsPerDist2", 0, 2, 5, 1); <span class='error_goto'>__PYX_ERR(0, 112, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_nSamples);
          if (value) { values[2] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_burninSamples);
          if (value) { values[3] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_maxDist);
          if (value) { values[4] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "getSnapshotsPerDist2") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 112, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_model = ((struct __pyx_obj_6Models_6models_Model *)values[0]);
    __pyx_v_node = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[1]); if (unlikely((__pyx_v_node == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 112, __pyx_L3_error)</span>
    if (values[2]) {
      __pyx_v_nSamples = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[2]); if (unlikely((__pyx_v_nSamples == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 113, __pyx_L3_error)</span>
    } else {
      __pyx_v_nSamples = __pyx_k__2;
    }
    if (values[3]) {
      __pyx_v_burninSamples = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[3]); if (unlikely((__pyx_v_burninSamples == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 113, __pyx_L3_error)</span>
    } else {
      __pyx_v_burninSamples = __pyx_k__3;
    }
    if (values[4]) {
      __pyx_v_maxDist = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[4]); if (unlikely((__pyx_v_maxDist == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 113, __pyx_L3_error)</span>
    } else {
      __pyx_v_maxDist = ((int)1);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("getSnapshotsPerDist2", 0, 2, 5, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 112, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.getSnapshotsPerDist2", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_model), __pyx_ptype_6Models_6models_Model, 1, "model", 0))) <span class='error_goto'>__PYX_ERR(0, 112, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_7Toolbox_8infcyIDL_2getSnapshotsPerDist2(__pyx_self, __pyx_v_model, __pyx_v_node, __pyx_v_nSamples, __pyx_v_burninSamples, __pyx_v_maxDist);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_7Toolbox_8infcyIDL_2getSnapshotsPerDist2(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6Models_6models_Model *__pyx_v_model, long __pyx_v_node, long __pyx_v_nSamples, long __pyx_v_burninSamples, int __pyx_v_maxDist) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("getSnapshotsPerDist2", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_2.__pyx_n = 3;
  __pyx_t_2.nSamples = __pyx_v_nSamples;
  __pyx_t_2.burninSamples = __pyx_v_burninSamples;
  __pyx_t_2.maxDist = __pyx_v_maxDist;
  __pyx_t_1 = __pyx_f_7Toolbox_8infcyIDL_getSnapshotsPerDist2(__pyx_v_model, __pyx_v_node, 0, &amp;__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 112, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.getSnapshotsPerDist2", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
struct __pyx_opt_args_7Toolbox_8infcyIDL_getSnapshotsPerDist2 {
  int __pyx_n;
  long nSamples;
  long burninSamples;
  int maxDist;
};
</pre><pre class="cython line score-40" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">113</span>:           long nSamples = int(1e2), long burninSamples = int(1e3), int maxDist = 1):</pre>
<pre class='cython code score-40 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyNumber_Int</span>(__pyx_float_1e2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 113, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_2); if (unlikely((__pyx_t_3 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 113, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_k__2 = __pyx_t_3;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyNumber_Int</span>(__pyx_float_1e3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 113, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_2); if (unlikely((__pyx_t_3 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 113, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_k__3 = __pyx_t_3;
/* … */
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyNumber_Int</span>(__pyx_float_1e2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 113, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
/* … */
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_2); if (unlikely((__pyx_t_3 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 113, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_k__2 = __pyx_t_3;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyNumber_Int</span>(__pyx_float_1e3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 113, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_2); if (unlikely((__pyx_t_3 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 113, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_k__3 = __pyx_t_3;
</pre><pre class="cython line score-0">&#xA0;<span class="">114</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">115</span>:     Extract snapshots from MC for large network, for which the decimal encoding causes overflows</pre>
<pre class="cython line score-0">&#xA0;<span class="">116</span>:     Take nSamples snapshots for each set of neighbours at distance d, ranging from d=1 to d=maxDist</pre>
<pre class="cython line score-0">&#xA0;<span class="">117</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">118</span>:     cdef:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">119</span>:         vector[unordered_map[string, double]] snapshots = vector[unordered_map[string, double]](maxDist)</pre>
<pre class='cython code score-0 '>  try {
    __pyx_t_1 = std::vector&lt;std::unordered_map&lt;std::string,double&gt; &gt; (__pyx_v_maxDist);
  } catch(...) {
    __Pyx_CppExn2PyErr();
    <span class='error_goto'>__PYX_ERR(0, 119, __pyx_L1_error)</span>
  }
  __pyx_v_snapshots = __pyx_t_1;
</pre><pre class="cython line score-0">&#xA0;<span class="">120</span>:         long d, sample</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">121</span>:         double part = 1/(&lt;double&gt; nSamples)</pre>
<pre class='cython code score-0 '>  __pyx_v_part = (1.0 / ((double)__pyx_v_nSamples));
</pre><pre class="cython line score-0">&#xA0;<span class="">122</span>:         string state</pre>
<pre class="cython line score-0">&#xA0;<span class="">123</span>:         vector[PyObjectHolder] models_</pre>
<pre class="cython line score-29" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">124</span>:         int tid, nThreads = mp.cpu_count(), nodeSpin</pre>
<pre class='cython code score-29 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_mp);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 124, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_cpu_count);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 124, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
    }
  }
  __pyx_t_2 = (__pyx_t_3) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, __pyx_t_3) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 124, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_2); if (unlikely((__pyx_t_5 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 124, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_nThreads = __pyx_t_5;
</pre><pre class="cython line score-0">&#xA0;<span class="">125</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">126</span>:         unordered_map[long, vector[long]] allNeighbours_G, allNeighbours_idx</pre>
<pre class="cython line score-0">&#xA0;<span class="">127</span>: </pre>
<pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">128</span>:     node = model.mapping[node] # map to internal index</pre>
<pre class='cython code score-13 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(((PyObject *)__pyx_v_model), __pyx_n_s_mapping);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 128, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_2, __pyx_v_node, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 128, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_4); if (unlikely((__pyx_t_6 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 128, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_node = __pyx_t_6;
</pre><pre class="cython line score-17" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">129</span>:     allNeighbours_G, allNeighbours_idx = model.neighboursAtDist(node, maxDist)</pre>
<pre class='cython code score-17 '>  __pyx_t_4 = ((struct __pyx_vtabstruct_6Models_6models_Model *)__pyx_v_model-&gt;__pyx_vtab)-&gt;neighboursAtDist(__pyx_v_model, __pyx_v_node, __pyx_v_maxDist, 0);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 129, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  if (likely(__pyx_t_4 != Py_None)) {
    PyObject* sequence = __pyx_t_4;
    Py_ssize_t size = <span class='pyx_c_api'>__Pyx_PySequence_SIZE</span>(sequence);
    if (unlikely(size != 2)) {
      if (size &gt; 2) <span class='pyx_c_api'>__Pyx_RaiseTooManyValuesError</span>(2);
      else if (size &gt;= 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(size);
      <span class='error_goto'>__PYX_ERR(0, 129, __pyx_L1_error)</span>
    }
    #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
    __pyx_t_2 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 0); 
    __pyx_t_3 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 1); 
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
    #else
    __pyx_t_2 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 129, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_3 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 129, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    #endif
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  } else {
    <span class='pyx_c_api'>__Pyx_RaiseNoneNotIterableError</span>(); <span class='error_goto'>__PYX_ERR(0, 129, __pyx_L1_error)</span>
  }
  __pyx_t_7 = __pyx_convert_unordered_map_from_py_long__and_std_3a__3a_vector_3c_long_3e___(__pyx_t_2);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 129, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_8 = __pyx_convert_unordered_map_from_py_long__and_std_3a__3a_vector_3c_long_3e___(__pyx_t_3);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 129, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_allNeighbours_G = __pyx_t_7;
  __pyx_v_allNeighbours_idx = __pyx_t_8;
</pre><pre class="cython line score-0">&#xA0;<span class="">130</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">131</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">132</span>:     for tid in range(nThreads):</pre>
<pre class='cython code score-0 '>  __pyx_t_5 = __pyx_v_nThreads;
  __pyx_t_9 = __pyx_t_5;
  for (__pyx_t_10 = 0; __pyx_t_10 &lt; __pyx_t_9; __pyx_t_10+=1) {
    __pyx_v_tid = __pyx_t_10;
</pre><pre class="cython line score-20" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">133</span>:         tmp = copy.deepcopy(model)</pre>
<pre class='cython code score-20 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_copy);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 133, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_deepcopy);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 133, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
      __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
      if (likely(__pyx_t_3)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
      }
    }
    __pyx_t_4 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, ((PyObject *)__pyx_v_model)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, ((PyObject *)__pyx_v_model));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 133, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_tmp, __pyx_t_4);
    __pyx_t_4 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">134</span>:         models_.push_back(PyObjectHolder(&lt;PyObject *&gt; tmp))</pre>
<pre class='cython code score-0 '>    try {
      __pyx_v_models_.push_back(PyObjectHolder(((PyObject *)__pyx_v_tmp)));
    } catch(...) {
      __Pyx_CppExn2PyErr();
      <span class='error_goto'>__PYX_ERR(0, 134, __pyx_L1_error)</span>
    }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">135</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">136</span>: </pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">137</span>:     for sample in prange(nSamples, nogil = True, schedule = 'static', num_threads = nThreads):</pre>
<pre class='cython code score-6 '>  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      <span class='pyx_c_api'>__Pyx_FastGIL_Remember</span>();
      #endif
      /*try:*/ {
        __pyx_t_6 = __pyx_v_nSamples;
        if (1 == 0) abort();
        {
            #if ((defined(__APPLE__) || defined(__OSX__)) &amp;&amp; (defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 2 || (__GNUC__ == 2 &amp;&amp; (__GNUC_MINOR__ &gt; 95)))))
                #undef likely
                #undef unlikely
                #define likely(x)   (x)
                #define unlikely(x) (x)
            #endif
            __pyx_t_12 = (__pyx_t_6 - 0 + 1 - 1/abs(1)) / 1;
            if (__pyx_t_12 &gt; 0)
            {
                #ifdef _OPENMP
                #pragma omp parallel
                #endif /* _OPENMP */
                {
                    #ifdef _OPENMP
                    #pragma omp for lastprivate(__pyx_v_d) firstprivate(__pyx_v_sample) lastprivate(__pyx_v_sample) lastprivate(__pyx_v_state) lastprivate(__pyx_v_tid) schedule(static)        __pyx_t_6 = __pyx_v_nSamples;
        if (1 == 0) abort();
        {
            #if ((defined(__APPLE__) || defined(__OSX__)) &amp;&amp; (defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 2 || (__GNUC__ == 2 &amp;&amp; (__GNUC_MINOR__ &gt; 95)))))
                #undef likely
                #undef unlikely
                #define likely(x)   (x)
                #define unlikely(x) (x)
            #endif
            __pyx_t_12 = (__pyx_t_6 - 0 + 1 - 1/abs(1)) / 1;
            if (__pyx_t_12 &gt; 0)
            {
                #ifdef _OPENMP
                #pragma omp parallel
                #endif /* _OPENMP */
                {
                    #ifdef _OPENMP
                    #pragma omp for lastprivate(__pyx_v_d) firstprivate(__pyx_v_sample) lastprivate(__pyx_v_sample) lastprivate(__pyx_v_state) lastprivate(__pyx_v_tid) schedule(static) num_threads(__pyx_v_nThreads)
                    #endif /* _OPENMP */
                    for (__pyx_t_11 = 0; __pyx_t_11 &lt; __pyx_t_12; __pyx_t_11++){
                        {
                            __pyx_v_sample = (long)(0 + 1 * __pyx_t_11);
                            /* Initialize private variables to invalid values */
                            __pyx_v_d = ((long)0xbad0bad0);
                            __pyx_v_tid = ((int)0xbad0bad0);
/* … */
      /*finally:*/ {
        /*normal exit:*/{
          #ifdef WITH_THREAD
          <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L7;
        }
        __pyx_L6_error: {
          #ifdef WITH_THREAD
          <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L1_error;
        }
        __pyx_L7:;
      }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">138</span>:         tid = threadid()</pre>
<pre class='cython code score-0 '>                            #ifdef _OPENMP
                            __pyx_t_5 = omp_get_thread_num();
                            #else
                            __pyx_t_5 = 0;
                            #endif
                            __pyx_v_tid = __pyx_t_5;
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">139</span>:         with gil:</pre>
<pre class='cython code score-6 '>                            {
                                #ifdef WITH_THREAD
                                PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                                #endif
                                /*try:*/ {
/* … */
                                /*finally:*/ {
                                  /*normal exit:*/{
                                    #ifdef WITH_THREAD
                                    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                                    #endif
                                    goto __pyx_L16;
                                  }
                                  __pyx_L15_error: {
                                    #ifdef WITH_THREAD
                                    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                                    #endif
                                    goto __pyx_L10_error;
                                  }
                                  __pyx_L16:;
                                }
                            }
</pre><pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">140</span>:             (&lt;Model&gt;models_[tid].ptr).seed += sample # enforce different seeds</pre>
<pre class='cython code score-16 '>                                  __pyx_t_13 = (__pyx_v_models_[__pyx_v_tid]).ptr;
                                  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)((struct __pyx_obj_6Models_6models_Model *)__pyx_t_13)));
                                  __pyx_t_14 = ((struct __pyx_obj_6Models_6models_Model *)__pyx_t_13);
                                  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(((PyObject *)__pyx_t_14), __pyx_n_s_seed);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 140, __pyx_L15_error)</span>
                                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
                                  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_sample);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 140, __pyx_L15_error)</span>
                                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
                                  __pyx_t_3 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_4, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 140, __pyx_L15_error)</span>
                                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
                                  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
                                  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
                                  if (<span class='pyx_c_api'>__Pyx_PyObject_SetAttrStr</span>(((PyObject *)__pyx_t_14), __pyx_n_s_seed, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 140, __pyx_L15_error)</span>
                                  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
                                  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_14)); __pyx_t_14 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">141</span>:             (&lt;Model&gt;models_[tid].ptr).reset()</pre>
<pre class='cython code score-0 '>                                  __pyx_t_13 = (__pyx_v_models_[__pyx_v_tid]).ptr;
                                  ((struct __pyx_vtabstruct_6Models_6models_Model *)((struct __pyx_obj_6Models_6models_Model *)__pyx_t_13)-&gt;__pyx_vtab)-&gt;reset(((struct __pyx_obj_6Models_6models_Model *)__pyx_t_13), 0);
                                }
</pre><pre class="cython line score-0">&#xA0;<span class="">142</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">143</span>:         (&lt;Model&gt;models_[tid].ptr).simulateNSteps(burninSamples)</pre>
<pre class='cython code score-0 '>                            __pyx_t_13 = (__pyx_v_models_[__pyx_v_tid]).ptr;
                            __pyx_t_15 = ((struct __pyx_vtabstruct_6Models_6models_Model *)((struct __pyx_obj_6Models_6models_Model *)__pyx_t_13)-&gt;__pyx_vtab)-&gt;simulateNSteps(((struct __pyx_obj_6Models_6models_Model *)__pyx_t_13), __pyx_v_burninSamples);<span class='error_goto'> if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 143, __pyx_L10_error)</span>
                            __PYX_XDEC_MEMVIEW(&amp;__pyx_t_15, 0);
                            __pyx_t_15.memview = NULL;
                            __pyx_t_15.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">144</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">145</span>:         for d in range(maxDist):</pre>
<pre class='cython code score-0 '>                            __pyx_t_5 = __pyx_v_maxDist;
                            __pyx_t_9 = __pyx_t_5;
                            for (__pyx_t_16 = 0; __pyx_t_16 &lt; __pyx_t_9; __pyx_t_16+=1) {
                              __pyx_v_d = __pyx_t_16;
</pre><pre class="cython line score-9" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">146</span>:             with gil: state = (&lt;Model&gt; models_[tid].ptr).encodeStateToString(allNeighbours_idx[d+1])</pre>
<pre class='cython code score-9 '>                              {
                                  #ifdef WITH_THREAD
                                  PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                                  #endif
                                  /*try:*/ {
                                    __pyx_t_13 = (__pyx_v_models_[__pyx_v_tid]).ptr;
                                    __pyx_t_3 = ((struct __pyx_vtabstruct_6Models_6models_Model *)((struct __pyx_obj_6Models_6models_Model *)__pyx_t_13)-&gt;__pyx_vtab)-&gt;encodeStateToString(((struct __pyx_obj_6Models_6models_Model *)__pyx_t_13), (__pyx_v_allNeighbours_idx[(__pyx_v_d + 1)]), 0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 146, __pyx_L22_error)</span>
                                    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
                                    __pyx_t_17 = <span class='pyx_c_api'>__pyx_convert_string_from_py_std__in_string</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 146, __pyx_L22_error)</span>
                                    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
                                    __pyx_v_state = __pyx_t_17;
                                  }
                                  /*finally:*/ {
                                    /*normal exit:*/{
                                      #ifdef WITH_THREAD
                                      <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                                      #endif
                                      goto __pyx_L23;
                                    }
                                    __pyx_L22_error: {
                                      #ifdef WITH_THREAD
                                      <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                                      #endif
                                      goto __pyx_L10_error;
                                    }
                                    __pyx_L23:;
                                  }
                              }
</pre><pre class="cython line score-20" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">147</span>:             snapshots[d][state] += part # each index corresponds to one system state, the array contains the probability of each state</pre>
<pre class='cython code score-20 '>                              __pyx_t_18 = __pyx_v_d;
                              __pyx_t_17 = __pyx_v_state;
                              ((__pyx_v_snapshots[__pyx_t_18])[__pyx_t_17]) = (((__pyx_v_snapshots[__pyx_t_18])[__pyx_t_17]) + __pyx_v_part);
                            }
                            goto __pyx_L25;
                            __pyx_L10_error:;
                            {
                                #ifdef WITH_THREAD
                                PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                                #endif
                                #ifdef _OPENMP
                                #pragma omp flush(__pyx_parallel_exc_type)
                                #endif /* _OPENMP */
                                if (!__pyx_parallel_exc_type) {
                                  <span class='pyx_c_api'>__Pyx_ErrFetchWithState</span>(&amp;__pyx_parallel_exc_type, &amp;__pyx_parallel_exc_value, &amp;__pyx_parallel_exc_tb);
                                  __pyx_parallel_filename = __pyx_filename; __pyx_parallel_lineno = __pyx_lineno; __pyx_parallel_clineno = __pyx_clineno;
                                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_parallel_exc_type);
                                }
                                #ifdef WITH_THREAD
                                <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                                #endif
                            }
                            __pyx_parallel_why = 4;
                            goto __pyx_L24;
                            __pyx_L24:;
                            #ifdef _OPENMP
                            #pragma omp critical(__pyx_parallel_lastprivates0)
                            #endif /* _OPENMP */
                            {
                                __pyx_parallel_temp0 = __pyx_v_d;
                                __pyx_parallel_temp1 = __pyx_v_sample;
                                __pyx_parallel_temp2 = __pyx_v_state;
                                __pyx_parallel_temp3 = __pyx_v_tid;
                            }
                            __pyx_L25:;
                            #ifdef _OPENMP
                            #pragma omp flush(__pyx_parallel_why)
                            #endif /* _OPENMP */
                        }
                    }
                    #ifdef _OPENMP
                    Py_END_ALLOW_THREADS
                    #else
{
#ifdef WITH_THREAD
                    PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                    #endif
                    #endif /* _OPENMP */
                    /* Clean up any temporaries */
                    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_t_14));
                    __pyx_t_14 = NULL;
                    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_15, 0);
                    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
                    __pyx_t_2 = NULL;
                    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
                    __pyx_t_3 = NULL;
                    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
                    __pyx_t_4 = NULL;
                    #ifdef WITH_THREAD
                    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                    #endif
                    #ifndef _OPENMP
}
#endif /* _OPENMP */
                }
            }
            if (__pyx_parallel_exc_type) {
              /* This may have been overridden by a continue, break or return in another thread. Prefer the error. */
              __pyx_parallel_why = 4;
            }
            if (__pyx_parallel_why) {
              __pyx_v_d = __pyx_parallel_temp0;
              __pyx_v_sample = __pyx_parallel_temp1;
              __pyx_v_state = __pyx_parallel_temp2;
              __pyx_v_tid = __pyx_parallel_temp3;
              switch (__pyx_parallel_why) {
                    case 4:
                {
                    #ifdef WITH_THREAD
                    PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                    #endif
                    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_parallel_exc_type);
                    <span class='pyx_c_api'>__Pyx_ErrRestoreWithState</span>(__pyx_parallel_exc_type, __pyx_parallel_exc_value, __pyx_parallel_exc_tb);
                    __pyx_filename = __pyx_parallel_filename; __pyx_lineno = __pyx_parallel_lineno; __pyx_clineno = __pyx_parallel_clineno;
                    #ifdef WITH_THREAD
                    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                    #endif
                }
                goto __pyx_L6_error;
              }
            }
        }
        #if ((defined(__APPLE__) || defined(__OSX__)) &amp;&amp; (defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 2 || (__GNUC__ == 2 &amp;&amp; (__GNUC_MINOR__ &gt; 95)))))
            #undef likely
            #undef unlikely
            #define likely(x)   __builtin_expect(!!(x), 1)
            #define unlikely(x) __builtin_expect(!!(x), 0)
        #endif
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">148</span>: </pre>
<pre class="cython line score-9" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">149</span>:     return snapshots, allNeighbours_G, allNeighbours_idx</pre>
<pre class='cython code score-9 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_3 = __pyx_convert_vector_to_py_std_3a__3a_unordered_map_3c_std_3a__3a_string_2c_double_3e___(__pyx_v_snapshots);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 149, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = __pyx_convert_unordered_map_to_py_long____std_3a__3a_vector_3c_long_3e___(__pyx_v_allNeighbours_G);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 149, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_4 = __pyx_convert_unordered_map_to_py_long____std_3a__3a_vector_3c_long_3e___(__pyx_v_allNeighbours_idx);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 149, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_19 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_19)) __PYX_ERR(0, 149, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_19);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 0, __pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 1, __pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 2, __pyx_t_4);
  __pyx_t_3 = 0;
  __pyx_t_2 = 0;
  __pyx_t_4 = 0;
  __pyx_r = ((PyObject*)__pyx_t_19);
  __pyx_t_19 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">150</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">151</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">152</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">153</span>: @cython.wraparound(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">154</span>: @cython.nonecheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">155</span>: @cython.cdivision(True)</pre>
<pre class="cython line score-0">&#xA0;<span class="">156</span>: @cython.initializedcheck(False)</pre>
<pre class="cython line score-112" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">157</span>: cpdef tuple getJointSnapshotsPerDist(Model model, long node, \</pre>
<pre class='cython code score-112 '>static PyObject *__pyx_pw_7Toolbox_8infcyIDL_5getJointSnapshotsPerDist(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_7Toolbox_8infcyIDL_getJointSnapshotsPerDist(struct __pyx_obj_6Models_6models_Model *__pyx_v_model, long __pyx_v_node, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_7Toolbox_8infcyIDL_getJointSnapshotsPerDist *__pyx_optional_args) {
  long __pyx_v_nSamples = __pyx_k__4;
  long __pyx_v_burninSamples = __pyx_k__5;
  int __pyx_v_maxDist = ((int)1);
  int __pyx_v_nBins = ((int)10);
  double __pyx_v_threshold = ((double)0.05);
  std::vector&lt;std::unordered_map&lt;int,std::unordered_map&lt;std::string,double&gt; &gt; &gt;  __pyx_v_snapshots;
  CYTHON_UNUSED std::vector&lt;std::unordered_map&lt;int,std::unordered_map&lt;std::string,double&gt; &gt; &gt;  __pyx_v_oldSnapshots;
  std::vector&lt;std::unordered_map&lt;int,std::unordered_map&lt;int,double&gt; &gt; &gt;  __pyx_v_avgSnapshots;
  std::vector&lt;std::unordered_map&lt;int,std::unordered_map&lt;int,double&gt; &gt; &gt;  __pyx_v_oldAvgSnapshots;
  long __pyx_v_d;
  long __pyx_v_sample;
  double __pyx_v_Z;
  std::string __pyx_v_state;
  std::vector&lt;PyObjectHolder&gt;  __pyx_v_models_;
  int __pyx_v_tid;
  int __pyx_v_nThreads;
  int __pyx_v_nodeSpin;
  int __pyx_v_avg;
  PyArrayObject *__pyx_v_KL = 0;
  double __pyx_v_KL_d;
  __Pyx_memviewslice __pyx_v_bins = { 0, 0, { 0 }, { 0 }, { 0 } };
  CYTHON_UNUSED std::unordered_map&lt;long,std::vector&lt;long&gt; &gt;  __pyx_v_allNeighbours_G;
  std::unordered_map&lt;long,std::vector&lt;long&gt; &gt;  __pyx_v_allNeighbours_idx;
  CYTHON_UNUSED int __pyx_v_rep;
  PyObject *__pyx_v_tmp = NULL;
  PyObject *__pyx_v_pNew = NULL;
  PyObject *__pyx_v_pOld = NULL;
  int __pyx_7genexpr__pyx_v_s;
  PyObject *__pyx_7genexpr__pyx_v_k = NULL;
  int __pyx_8genexpr1__pyx_v_s;
  PyObject *__pyx_8genexpr1__pyx_v_k = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("getJointSnapshotsPerDist", 0);
  if (__pyx_optional_args) {
    if (__pyx_optional_args-&gt;__pyx_n &gt; 0) {
      __pyx_v_nSamples = __pyx_optional_args-&gt;nSamples;
      if (__pyx_optional_args-&gt;__pyx_n &gt; 1) {
        __pyx_v_burninSamples = __pyx_optional_args-&gt;burninSamples;
        if (__pyx_optional_args-&gt;__pyx_n &gt; 2) {
          __pyx_v_maxDist = __pyx_optional_args-&gt;maxDist;
          if (__pyx_optional_args-&gt;__pyx_n &gt; 3) {
            __pyx_v_nBins = __pyx_optional_args-&gt;nBins;
            if (__pyx_optional_args-&gt;__pyx_n &gt; 4) {
              __pyx_v_threshold = __pyx_optional_args-&gt;threshold;
            }
          }
        }
      }
    }
  }
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_11, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_t_20));
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_21, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_32);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.getJointSnapshotsPerDist", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_KL);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_bins, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_tmp);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_pNew);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_pOld);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_7genexpr__pyx_v_k);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_8genexpr1__pyx_v_k);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_7Toolbox_8infcyIDL_5getJointSnapshotsPerDist(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_7Toolbox_8infcyIDL_4getJointSnapshotsPerDist[] = "\n    Extract snapshots from MC for large network, for which the decimal encoding causes overflows\n    Take snapshots for each set of neighbours at distance d, ranging from d=1 to d=maxDist.\n    Store snapshots for different spin states of the central node separately to estimate the joint pdf.\n    Additionally, the discretized average magnetization of neighbours at distance d is sampled.\n    Every nSamples, compute the KL-divergence between the previous sample distribution and the new one. Stop sampling if it drops below threshold.\n    ";
static PyObject *__pyx_pw_7Toolbox_8infcyIDL_5getJointSnapshotsPerDist(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_6Models_6models_Model *__pyx_v_model = 0;
  long __pyx_v_node;
  long __pyx_v_nSamples;
  long __pyx_v_burninSamples;
  int __pyx_v_maxDist;
  int __pyx_v_nBins;
  double __pyx_v_threshold;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("getJointSnapshotsPerDist (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_model,&amp;__pyx_n_s_node,&amp;__pyx_n_s_nSamples,&amp;__pyx_n_s_burninSamples,&amp;__pyx_n_s_maxDist,&amp;__pyx_n_s_nBins,&amp;__pyx_n_s_threshold,0};
    PyObject* values[7] = {0,0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_model)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_node)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("getJointSnapshotsPerDist", 0, 2, 7, 1); <span class='error_goto'>__PYX_ERR(0, 157, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_nSamples);
          if (value) { values[2] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_burninSamples);
          if (value) { values[3] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_maxDist);
          if (value) { values[4] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_nBins);
          if (value) { values[5] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_threshold);
          if (value) { values[6] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "getJointSnapshotsPerDist") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 157, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_model = ((struct __pyx_obj_6Models_6models_Model *)values[0]);
    __pyx_v_node = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[1]); if (unlikely((__pyx_v_node == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 157, __pyx_L3_error)</span>
    if (values[2]) {
      __pyx_v_nSamples = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[2]); if (unlikely((__pyx_v_nSamples == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 158, __pyx_L3_error)</span>
    } else {
      __pyx_v_nSamples = __pyx_k__4;
    }
    if (values[3]) {
      __pyx_v_burninSamples = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[3]); if (unlikely((__pyx_v_burninSamples == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 158, __pyx_L3_error)</span>
    } else {
      __pyx_v_burninSamples = __pyx_k__5;
    }
    if (values[4]) {
      __pyx_v_maxDist = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[4]); if (unlikely((__pyx_v_maxDist == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 158, __pyx_L3_error)</span>
    } else {
      __pyx_v_maxDist = ((int)1);
    }
    if (values[5]) {
      __pyx_v_nBins = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[5]); if (unlikely((__pyx_v_nBins == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 158, __pyx_L3_error)</span>
    } else {
      __pyx_v_nBins = ((int)10);
    }
    if (values[6]) {
      __pyx_v_threshold = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[6]); if (unlikely((__pyx_v_threshold == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 158, __pyx_L3_error)</span>
    } else {
      __pyx_v_threshold = ((double)0.05);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("getJointSnapshotsPerDist", 0, 2, 7, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 157, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.getJointSnapshotsPerDist", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_model), __pyx_ptype_6Models_6models_Model, 1, "model", 0))) <span class='error_goto'>__PYX_ERR(0, 157, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_7Toolbox_8infcyIDL_4getJointSnapshotsPerDist(__pyx_self, __pyx_v_model, __pyx_v_node, __pyx_v_nSamples, __pyx_v_burninSamples, __pyx_v_maxDist, __pyx_v_nBins, __pyx_v_threshold);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_7Toolbox_8infcyIDL_4getJointSnapshotsPerDist(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6Models_6models_Model *__pyx_v_model, long __pyx_v_node, long __pyx_v_nSamples, long __pyx_v_burninSamples, int __pyx_v_maxDist, int __pyx_v_nBins, double __pyx_v_threshold) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("getJointSnapshotsPerDist", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_2.__pyx_n = 5;
  __pyx_t_2.nSamples = __pyx_v_nSamples;
  __pyx_t_2.burninSamples = __pyx_v_burninSamples;
  __pyx_t_2.maxDist = __pyx_v_maxDist;
  __pyx_t_2.nBins = __pyx_v_nBins;
  __pyx_t_2.threshold = __pyx_v_threshold;
  __pyx_t_1 = __pyx_f_7Toolbox_8infcyIDL_getJointSnapshotsPerDist(__pyx_v_model, __pyx_v_node, 0, &amp;__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 157, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.getJointSnapshotsPerDist", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
struct __pyx_opt_args_7Toolbox_8infcyIDL_getJointSnapshotsPerDist {
  int __pyx_n;
  long nSamples;
  long burninSamples;
  int maxDist;
  int nBins;
  double threshold;
};
</pre><pre class="cython line score-40" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">158</span>:           long nSamples = int(1e3), long burninSamples = int(1e3), int maxDist = 1, int nBins=10, double threshold = 0.05):</pre>
<pre class='cython code score-40 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyNumber_Int</span>(__pyx_float_1e3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 158, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_2); if (unlikely((__pyx_t_3 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 158, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_k__4 = __pyx_t_3;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyNumber_Int</span>(__pyx_float_1e3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 158, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_2); if (unlikely((__pyx_t_3 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 158, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_k__5 = __pyx_t_3;
/* … */
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyNumber_Int</span>(__pyx_float_1e3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 158, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
/* … */
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_2); if (unlikely((__pyx_t_3 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 158, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_k__4 = __pyx_t_3;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyNumber_Int</span>(__pyx_float_1e3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 158, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_2); if (unlikely((__pyx_t_3 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 158, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_k__5 = __pyx_t_3;
</pre><pre class="cython line score-0">&#xA0;<span class="">159</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">160</span>:     Extract snapshots from MC for large network, for which the decimal encoding causes overflows</pre>
<pre class="cython line score-0">&#xA0;<span class="">161</span>:     Take snapshots for each set of neighbours at distance d, ranging from d=1 to d=maxDist.</pre>
<pre class="cython line score-0">&#xA0;<span class="">162</span>:     Store snapshots for different spin states of the central node separately to estimate the joint pdf.</pre>
<pre class="cython line score-0">&#xA0;<span class="">163</span>:     Additionally, the discretized average magnetization of neighbours at distance d is sampled.</pre>
<pre class="cython line score-0">&#xA0;<span class="">164</span>:     Every nSamples, compute the KL-divergence between the previous sample distribution and the new one. Stop sampling if it drops below threshold.</pre>
<pre class="cython line score-0">&#xA0;<span class="">165</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">166</span>:     cdef:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">167</span>:         vector[unordered_map[int, unordered_map[string, double]]] snapshots = vector[unordered_map[int, unordered_map[string, double]]](maxDist)</pre>
<pre class='cython code score-0 '>  try {
    __pyx_t_1 = std::vector&lt;std::unordered_map&lt;int,std::unordered_map&lt;std::string,double&gt; &gt; &gt; (__pyx_v_maxDist);
  } catch(...) {
    __Pyx_CppExn2PyErr();
    <span class='error_goto'>__PYX_ERR(0, 167, __pyx_L1_error)</span>
  }
  __pyx_v_snapshots = __pyx_t_1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">168</span>:         vector[unordered_map[int, unordered_map[string, double]]] oldSnapshots = vector[unordered_map[int, unordered_map[string, double]]](maxDist)</pre>
<pre class='cython code score-0 '>  try {
    __pyx_t_1 = std::vector&lt;std::unordered_map&lt;int,std::unordered_map&lt;std::string,double&gt; &gt; &gt; (__pyx_v_maxDist);
  } catch(...) {
    __Pyx_CppExn2PyErr();
    <span class='error_goto'>__PYX_ERR(0, 168, __pyx_L1_error)</span>
  }
  __pyx_v_oldSnapshots = __pyx_t_1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">169</span>:         vector[unordered_map[int, unordered_map[int, double]]] avgSnapshots = vector[unordered_map[int, unordered_map[int, double]]](maxDist)</pre>
<pre class='cython code score-0 '>  try {
    __pyx_t_2 = std::vector&lt;std::unordered_map&lt;int,std::unordered_map&lt;int,double&gt; &gt; &gt; (__pyx_v_maxDist);
  } catch(...) {
    __Pyx_CppExn2PyErr();
    <span class='error_goto'>__PYX_ERR(0, 169, __pyx_L1_error)</span>
  }
  __pyx_v_avgSnapshots = __pyx_t_2;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">170</span>:         vector[unordered_map[int, unordered_map[int, double]]] oldAvgSnapshots = vector[unordered_map[int, unordered_map[int, double]]](maxDist)</pre>
<pre class='cython code score-0 '>  try {
    __pyx_t_2 = std::vector&lt;std::unordered_map&lt;int,std::unordered_map&lt;int,double&gt; &gt; &gt; (__pyx_v_maxDist);
  } catch(...) {
    __Pyx_CppExn2PyErr();
    <span class='error_goto'>__PYX_ERR(0, 170, __pyx_L1_error)</span>
  }
  __pyx_v_oldAvgSnapshots = __pyx_t_2;
</pre><pre class="cython line score-0">&#xA0;<span class="">171</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">172</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">173</span>:         long d, i, sample</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">174</span>:         double Z       = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_Z = 0.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">175</span>:         string state</pre>
<pre class="cython line score-0">&#xA0;<span class="">176</span>:         vector[PyObjectHolder] models_</pre>
<pre class="cython line score-29" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">177</span>:         int tid, nThreads = mp.cpu_count(), nodeSpin, s, avg</pre>
<pre class='cython code score-29 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_mp);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 177, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_cpu_count);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 177, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
    }
  }
  __pyx_t_3 = (__pyx_t_4) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_5, __pyx_t_4) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 177, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_3); if (unlikely((__pyx_t_6 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 177, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_nThreads = __pyx_t_6;
</pre><pre class="cython line score-24" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">178</span>:         np.ndarray KL = np.ones(maxDist)</pre>
<pre class='cython code score-24 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 178, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_ones);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 178, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_maxDist);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 178, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_7 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
    __pyx_t_7 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
    if (likely(__pyx_t_7)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
    }
  }
  __pyx_t_3 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_7, __pyx_t_5) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, __pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 178, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 178, __pyx_L1_error)</span>
  __pyx_v_KL = ((PyArrayObject *)__pyx_t_3);
  __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">179</span>:         double KL_d</pre>
<pre class="cython line score-92" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">180</span>:         double[::1] bins = np.linspace(np.min(model.agentStates), np.max(model.agentStates), nBins)</pre>
<pre class='cython code score-92 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 180, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_linspace);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 180, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_7, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 180, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_min);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 180, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = __pyx_memoryview_fromslice(__pyx_v_model-&gt;agentStates, 1, (PyObject *(*)(char *)) __pyx_memview_get_long, (int (*)(char *, PyObject *)) __pyx_memview_set_long, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 180, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_9 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_8))) {
    __pyx_t_9 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_8);
    if (likely(__pyx_t_9)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_8, function);
    }
  }
  __pyx_t_4 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_8, __pyx_t_9, __pyx_t_7) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_8, __pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  if (unlikely(!__pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 180, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_7, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 180, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_max);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 180, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = __pyx_memoryview_fromslice(__pyx_v_model-&gt;agentStates, 1, (PyObject *(*)(char *)) __pyx_memview_get_long, (int (*)(char *, PyObject *)) __pyx_memview_set_long, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 180, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_10 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_9))) {
    __pyx_t_10 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_9);
    if (likely(__pyx_t_10)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_9);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_9, function);
    }
  }
  __pyx_t_8 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_9, __pyx_t_10, __pyx_t_7) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_9, __pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  if (unlikely(!__pyx_t_8)) <span class='error_goto'>__PYX_ERR(0, 180, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_nBins);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 180, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  __pyx_t_7 = NULL;
  __pyx_t_6 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
    __pyx_t_7 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
    if (likely(__pyx_t_7)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
      __pyx_t_6 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_5)) {
    PyObject *__pyx_temp[4] = {__pyx_t_7, __pyx_t_4, __pyx_t_8, __pyx_t_9};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_5, __pyx_temp+1-__pyx_t_6, 3+__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 180, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_5)) {
    PyObject *__pyx_temp[4] = {__pyx_t_7, __pyx_t_4, __pyx_t_8, __pyx_t_9};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_5, __pyx_temp+1-__pyx_t_6, 3+__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 180, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  } else
  #endif
  {
    __pyx_t_10 = <span class='py_c_api'>PyTuple_New</span>(3+__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 180, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    if (__pyx_t_7) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 0, __pyx_t_7); __pyx_t_7 = NULL;
    }
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 0+__pyx_t_6, __pyx_t_4);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 1+__pyx_t_6, __pyx_t_8);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 2+__pyx_t_6, __pyx_t_9);
    __pyx_t_4 = 0;
    __pyx_t_8 = 0;
    __pyx_t_9 = 0;
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_5, __pyx_t_10, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 180, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dc_double</span>(__pyx_t_3, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 180, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_bins = __pyx_t_11;
  __pyx_t_11.memview = NULL;
  __pyx_t_11.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">181</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">182</span>:         unordered_map[long, vector[long]] allNeighbours_G, allNeighbours_idx</pre>
<pre class="cython line score-0">&#xA0;<span class="">183</span>: </pre>
<pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">184</span>:     node = model.mapping[node]</pre>
<pre class='cython code score-13 '>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(((PyObject *)__pyx_v_model), __pyx_n_s_mapping);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 184, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_3, __pyx_v_node, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 184, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_5); if (unlikely((__pyx_t_12 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 184, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_v_node = __pyx_t_12;
</pre><pre class="cython line score-17" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">185</span>:     allNeighbours_G, allNeighbours_idx = model.neighboursAtDist(node, maxDist)</pre>
<pre class='cython code score-17 '>  __pyx_t_5 = ((struct __pyx_vtabstruct_6Models_6models_Model *)__pyx_v_model-&gt;__pyx_vtab)-&gt;neighboursAtDist(__pyx_v_model, __pyx_v_node, __pyx_v_maxDist, 0);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 185, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  if (likely(__pyx_t_5 != Py_None)) {
    PyObject* sequence = __pyx_t_5;
    Py_ssize_t size = <span class='pyx_c_api'>__Pyx_PySequence_SIZE</span>(sequence);
    if (unlikely(size != 2)) {
      if (size &gt; 2) <span class='pyx_c_api'>__Pyx_RaiseTooManyValuesError</span>(2);
      else if (size &gt;= 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(size);
      <span class='error_goto'>__PYX_ERR(0, 185, __pyx_L1_error)</span>
    }
    #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
    __pyx_t_3 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 0); 
    __pyx_t_10 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 1); 
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
    #else
    __pyx_t_3 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 185, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_10 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 1);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 185, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    #endif
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  } else {
    <span class='pyx_c_api'>__Pyx_RaiseNoneNotIterableError</span>(); <span class='error_goto'>__PYX_ERR(0, 185, __pyx_L1_error)</span>
  }
  __pyx_t_13 = __pyx_convert_unordered_map_from_py_long__and_std_3a__3a_vector_3c_long_3e___(__pyx_t_3);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 185, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_14 = __pyx_convert_unordered_map_from_py_long__and_std_3a__3a_vector_3c_long_3e___(__pyx_t_10);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 185, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_v_allNeighbours_G = __pyx_t_13;
  __pyx_v_allNeighbours_idx = __pyx_t_14;
</pre><pre class="cython line score-0">&#xA0;<span class="">186</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">187</span>:     for rep in range(nThreads):</pre>
<pre class='cython code score-0 '>  __pyx_t_6 = __pyx_v_nThreads;
  __pyx_t_15 = __pyx_t_6;
  for (__pyx_t_16 = 0; __pyx_t_16 &lt; __pyx_t_15; __pyx_t_16+=1) {
    __pyx_v_rep = __pyx_t_16;
</pre><pre class="cython line score-20" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">188</span>:         tmp = copy.deepcopy(model)</pre>
<pre class='cython code score-20 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_10, __pyx_n_s_copy);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 188, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_10, __pyx_n_s_deepcopy);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 188, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_10 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
      __pyx_t_10 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
      if (likely(__pyx_t_10)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
      }
    }
    __pyx_t_5 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_10, ((PyObject *)__pyx_v_model)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, ((PyObject *)__pyx_v_model));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 188, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_tmp, __pyx_t_5);
    __pyx_t_5 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">189</span>:         models_.push_back(PyObjectHolder(&lt;PyObject *&gt; tmp))</pre>
<pre class='cython code score-0 '>    try {
      __pyx_v_models_.push_back(PyObjectHolder(((PyObject *)__pyx_v_tmp)));
    } catch(...) {
      __Pyx_CppExn2PyErr();
      <span class='error_goto'>__PYX_ERR(0, 189, __pyx_L1_error)</span>
    }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">190</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">191</span>:     while True:</pre>
<pre class='cython code score-0 '>  while (1) {
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">192</span>:         for sample in prange(nSamples, nogil = True, schedule = 'static', num_threads = nThreads):</pre>
<pre class='cython code score-6 '>    {
        #ifdef WITH_THREAD
        PyThreadState *_save;
        Py_UNBLOCK_THREADS
        <span class='pyx_c_api'>__Pyx_FastGIL_Remember</span>();
        #endif
        /*try:*/ {
          __pyx_t_12 = __pyx_v_nSamples;
          if (1 == 0) abort();
          {
              #if ((defined(__APPLE__) || defined(__OSX__)) &amp;&amp; (defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 2 || (__GNUC__ == 2 &amp;&amp; (__GNUC_MINOR__ &gt; 95)))))
                  #undef likely
                  #undef unlikely
                  #define likely(x)   (x)
                  #define unlikely(x) (x)
              #endif
              __pyx_t_18 = (__pyx_t_12 - 0 + 1 - 1/abs(1)) / 1;
              if (__pyx_t_18 &gt; 0)
              {
                  #ifdef _OPENMP
                  #pragma omp parallel
                  #endif /* _OPENMP */
                  {
                      #ifdef _OPENMP
                      #pragma omp for lastprivate(__pyx_v_avg) lastprivate(__pyx_v_d) lastprivate(__pyx_v_nodeSpin) firstprivate(__pyx_v_sample) lastprivate(__pyx_v_sample) lastprivate(__pyx_v_state) lastprivate(__pyx_v_tid) schedule(static)          __pyx_t_12 = __pyx_v_nSamples;
          if (1 == 0) abort();
          {
              #if ((defined(__APPLE__) || defined(__OSX__)) &amp;&amp; (defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 2 || (__GNUC__ == 2 &amp;&amp; (__GNUC_MINOR__ &gt; 95)))))
                  #undef likely
                  #undef unlikely
                  #define likely(x)   (x)
                  #define unlikely(x) (x)
              #endif
              __pyx_t_18 = (__pyx_t_12 - 0 + 1 - 1/abs(1)) / 1;
              if (__pyx_t_18 &gt; 0)
              {
                  #ifdef _OPENMP
                  #pragma omp parallel
                  #endif /* _OPENMP */
                  {
                      #ifdef _OPENMP
                      #pragma omp for lastprivate(__pyx_v_avg) lastprivate(__pyx_v_d) lastprivate(__pyx_v_nodeSpin) firstprivate(__pyx_v_sample) lastprivate(__pyx_v_sample) lastprivate(__pyx_v_state) lastprivate(__pyx_v_tid) schedule(static) num_threads(__pyx_v_nThreads)
                      #endif /* _OPENMP */
                      for (__pyx_t_17 = 0; __pyx_t_17 &lt; __pyx_t_18; __pyx_t_17++){
                          {
                              __pyx_v_sample = (long)(0 + 1 * __pyx_t_17);
                              /* Initialize private variables to invalid values */
                              __pyx_v_avg = ((int)0xbad0bad0);
                              __pyx_v_d = ((long)0xbad0bad0);
                              __pyx_v_nodeSpin = ((int)0xbad0bad0);
                              __pyx_v_tid = ((int)0xbad0bad0);
/* … */
        /*finally:*/ {
          /*normal exit:*/{
            #ifdef WITH_THREAD
            <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
            Py_BLOCK_THREADS
            #endif
            goto __pyx_L11;
          }
          __pyx_L10_error: {
            #ifdef WITH_THREAD
            <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
            Py_BLOCK_THREADS
            #endif
            goto __pyx_L1_error;
          }
          __pyx_L11:;
        }
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">193</span>:             tid = threadid()</pre>
<pre class='cython code score-0 '>                              #ifdef _OPENMP
                              __pyx_t_6 = omp_get_thread_num();
                              #else
                              __pyx_t_6 = 0;
                              #endif
                              __pyx_v_tid = __pyx_t_6;
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">194</span>:             with gil:</pre>
<pre class='cython code score-6 '>                              {
                                  #ifdef WITH_THREAD
                                  PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                                  #endif
                                  /*try:*/ {
/* … */
                                  /*finally:*/ {
                                    /*normal exit:*/{
                                      #ifdef WITH_THREAD
                                      <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                                      #endif
                                      goto __pyx_L20;
                                    }
                                    __pyx_L19_error: {
                                      #ifdef WITH_THREAD
                                      <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                                      #endif
                                      goto __pyx_L14_error;
                                    }
                                    __pyx_L20:;
                                  }
                              }
</pre><pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">195</span>:                 (&lt;Model&gt;models_[tid].ptr).seed += sample # enforce different seeds</pre>
<pre class='cython code score-16 '>                                    __pyx_t_19 = (__pyx_v_models_[__pyx_v_tid]).ptr;
                                    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)((struct __pyx_obj_6Models_6models_Model *)__pyx_t_19)));
                                    __pyx_t_20 = ((struct __pyx_obj_6Models_6models_Model *)__pyx_t_19);
                                    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(((PyObject *)__pyx_t_20), __pyx_n_s_seed);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 195, __pyx_L19_error)</span>
                                    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
                                    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_sample);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 195, __pyx_L19_error)</span>
                                    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
                                    __pyx_t_10 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_5, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 195, __pyx_L19_error)</span>
                                    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
                                    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
                                    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
                                    if (<span class='pyx_c_api'>__Pyx_PyObject_SetAttrStr</span>(((PyObject *)__pyx_t_20), __pyx_n_s_seed, __pyx_t_10) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 195, __pyx_L19_error)</span>
                                    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
                                    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_20)); __pyx_t_20 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">196</span>:                 (&lt;Model&gt;models_[tid].ptr).reset()</pre>
<pre class='cython code score-0 '>                                    __pyx_t_19 = (__pyx_v_models_[__pyx_v_tid]).ptr;
                                    ((struct __pyx_vtabstruct_6Models_6models_Model *)((struct __pyx_obj_6Models_6models_Model *)__pyx_t_19)-&gt;__pyx_vtab)-&gt;reset(((struct __pyx_obj_6Models_6models_Model *)__pyx_t_19), 0);
                                  }
</pre><pre class="cython line score-0">&#xA0;<span class="">197</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">198</span>:             (&lt;Model&gt;models_[tid].ptr).simulateNSteps(burninSamples)</pre>
<pre class='cython code score-0 '>                              __pyx_t_19 = (__pyx_v_models_[__pyx_v_tid]).ptr;
                              __pyx_t_21 = ((struct __pyx_vtabstruct_6Models_6models_Model *)((struct __pyx_obj_6Models_6models_Model *)__pyx_t_19)-&gt;__pyx_vtab)-&gt;simulateNSteps(((struct __pyx_obj_6Models_6models_Model *)__pyx_t_19), __pyx_v_burninSamples);<span class='error_goto'> if (unlikely(!__pyx_t_21.memview)) __PYX_ERR(0, 198, __pyx_L14_error)</span>
                              __PYX_XDEC_MEMVIEW(&amp;__pyx_t_21, 0);
                              __pyx_t_21.memview = NULL;
                              __pyx_t_21.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">199</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">200</span>:             nodeSpin = (&lt;Model&gt; models_[tid].ptr)._states[node]</pre>
<pre class='cython code score-0 '>                              __pyx_t_19 = (__pyx_v_models_[__pyx_v_tid]).ptr;
                              __pyx_t_22 = __pyx_v_node;
                              __pyx_v_nodeSpin = (*((long *) ( /* dim=0 */ ((char *) (((long *) ((struct __pyx_obj_6Models_6models_Model *)__pyx_t_19)-&gt;_states.data) + __pyx_t_22)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">201</span>:             for d in range(maxDist):</pre>
<pre class='cython code score-0 '>                              __pyx_t_6 = __pyx_v_maxDist;
                              __pyx_t_15 = __pyx_t_6;
                              for (__pyx_t_23 = 0; __pyx_t_23 &lt; __pyx_t_15; __pyx_t_23+=1) {
                                __pyx_v_d = __pyx_t_23;
</pre><pre class="cython line score-9" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">202</span>:                 with gil: state = (&lt;Model&gt; models_[tid].ptr).encodeStateToString(allNeighbours_idx[d+1])</pre>
<pre class='cython code score-9 '>                                {
                                    #ifdef WITH_THREAD
                                    PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                                    #endif
                                    /*try:*/ {
                                      __pyx_t_19 = (__pyx_v_models_[__pyx_v_tid]).ptr;
                                      __pyx_t_10 = ((struct __pyx_vtabstruct_6Models_6models_Model *)((struct __pyx_obj_6Models_6models_Model *)__pyx_t_19)-&gt;__pyx_vtab)-&gt;encodeStateToString(((struct __pyx_obj_6Models_6models_Model *)__pyx_t_19), (__pyx_v_allNeighbours_idx[(__pyx_v_d + 1)]), 0);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 202, __pyx_L26_error)</span>
                                      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
                                      __pyx_t_24 = <span class='pyx_c_api'>__pyx_convert_string_from_py_std__in_string</span>(__pyx_t_10);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 202, __pyx_L26_error)</span>
                                      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
                                      __pyx_v_state = __pyx_t_24;
                                    }
                                    /*finally:*/ {
                                      /*normal exit:*/{
                                        #ifdef WITH_THREAD
                                        <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                                        #endif
                                        goto __pyx_L27;
                                      }
                                      __pyx_L26_error: {
                                        #ifdef WITH_THREAD
                                        <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                                        #endif
                                        goto __pyx_L14_error;
                                      }
                                      __pyx_L27:;
                                    }
                                }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">203</span>:                 avg = (&lt;Model&gt; models_[tid].ptr).encodeStateToAvg(allNeighbours_idx[d+1], bins)</pre>
<pre class='cython code score-0 '>                                __pyx_t_19 = (__pyx_v_models_[__pyx_v_tid]).ptr;
                                __pyx_v_avg = ((struct __pyx_vtabstruct_6Models_6models_Model *)((struct __pyx_obj_6Models_6models_Model *)__pyx_t_19)-&gt;__pyx_vtab)-&gt;encodeStateToAvg(((struct __pyx_obj_6Models_6models_Model *)__pyx_t_19), (__pyx_v_allNeighbours_idx[(__pyx_v_d + 1)]), __pyx_v_bins);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">204</span>:                 snapshots[d][nodeSpin][state] += 1</pre>
<pre class='cython code score-0 '>                                __pyx_t_25 = __pyx_v_d;
                                __pyx_t_16 = __pyx_v_nodeSpin;
                                __pyx_t_24 = __pyx_v_state;
                                (((__pyx_v_snapshots[__pyx_t_25])[__pyx_t_16])[__pyx_t_24]) = ((((__pyx_v_snapshots[__pyx_t_25])[__pyx_t_16])[__pyx_t_24]) + 1.0);
</pre><pre class="cython line score-20" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">205</span>:                 avgSnapshots[d][nodeSpin][avg] +=1</pre>
<pre class='cython code score-20 '>                                __pyx_t_25 = __pyx_v_d;
                                __pyx_t_16 = __pyx_v_nodeSpin;
                                __pyx_t_26 = __pyx_v_avg;
                                (((__pyx_v_avgSnapshots[__pyx_t_25])[__pyx_t_16])[__pyx_t_26]) = ((((__pyx_v_avgSnapshots[__pyx_t_25])[__pyx_t_16])[__pyx_t_26]) + 1.0);
                              }
                              goto __pyx_L29;
                              __pyx_L14_error:;
                              {
                                  #ifdef WITH_THREAD
                                  PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                                  #endif
                                  #ifdef _OPENMP
                                  #pragma omp flush(__pyx_parallel_exc_type)
                                  #endif /* _OPENMP */
                                  if (!__pyx_parallel_exc_type) {
                                    <span class='pyx_c_api'>__Pyx_ErrFetchWithState</span>(&amp;__pyx_parallel_exc_type, &amp;__pyx_parallel_exc_value, &amp;__pyx_parallel_exc_tb);
                                    __pyx_parallel_filename = __pyx_filename; __pyx_parallel_lineno = __pyx_lineno; __pyx_parallel_clineno = __pyx_clineno;
                                    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_parallel_exc_type);
                                  }
                                  #ifdef WITH_THREAD
                                  <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                                  #endif
                              }
                              __pyx_parallel_why = 4;
                              goto __pyx_L28;
                              __pyx_L28:;
                              #ifdef _OPENMP
                              #pragma omp critical(__pyx_parallel_lastprivates1)
                              #endif /* _OPENMP */
                              {
                                  __pyx_parallel_temp0 = __pyx_v_avg;
                                  __pyx_parallel_temp1 = __pyx_v_d;
                                  __pyx_parallel_temp2 = __pyx_v_nodeSpin;
                                  __pyx_parallel_temp3 = __pyx_v_sample;
                                  __pyx_parallel_temp4 = __pyx_v_state;
                                  __pyx_parallel_temp5 = __pyx_v_tid;
                              }
                              __pyx_L29:;
                              #ifdef _OPENMP
                              #pragma omp flush(__pyx_parallel_why)
                              #endif /* _OPENMP */
                          }
                      }
                      #ifdef _OPENMP
                      Py_END_ALLOW_THREADS
                      #else
{
#ifdef WITH_THREAD
                      PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                      #endif
                      #endif /* _OPENMP */
                      /* Clean up any temporaries */
                      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
                      __pyx_t_10 = NULL;
                      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_t_20));
                      __pyx_t_20 = NULL;
                      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_21, 0);
                      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
                      __pyx_t_3 = NULL;
                      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
                      __pyx_t_5 = NULL;
                      #ifdef WITH_THREAD
                      <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                      #endif
                      #ifndef _OPENMP
}
#endif /* _OPENMP */
                  }
              }
              if (__pyx_parallel_exc_type) {
                /* This may have been overridden by a continue, break or return in another thread. Prefer the error. */
                __pyx_parallel_why = 4;
              }
              if (__pyx_parallel_why) {
                __pyx_v_avg = __pyx_parallel_temp0;
                __pyx_v_d = __pyx_parallel_temp1;
                __pyx_v_nodeSpin = __pyx_parallel_temp2;
                __pyx_v_sample = __pyx_parallel_temp3;
                __pyx_v_state = __pyx_parallel_temp4;
                __pyx_v_tid = __pyx_parallel_temp5;
                switch (__pyx_parallel_why) {
                      case 4:
                  {
                      #ifdef WITH_THREAD
                      PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                      #endif
                      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_parallel_exc_type);
                      <span class='pyx_c_api'>__Pyx_ErrRestoreWithState</span>(__pyx_parallel_exc_type, __pyx_parallel_exc_value, __pyx_parallel_exc_tb);
                      __pyx_filename = __pyx_parallel_filename; __pyx_lineno = __pyx_parallel_lineno; __pyx_clineno = __pyx_parallel_clineno;
                      #ifdef WITH_THREAD
                      <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                      #endif
                  }
                  goto __pyx_L10_error;
                }
              }
          }
          #if ((defined(__APPLE__) || defined(__OSX__)) &amp;&amp; (defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 2 || (__GNUC__ == 2 &amp;&amp; (__GNUC_MINOR__ &gt; 95)))))
              #undef likely
              #undef unlikely
              #define likely(x)   __builtin_expect(!!(x), 1)
              #define unlikely(x) __builtin_expect(!!(x), 0)
          #endif
        }
</pre><pre class="cython line score-0">&#xA0;<span class="">206</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">207</span>:         if Z &gt; 0:</pre>
<pre class='cython code score-0 '>    __pyx_t_27 = ((__pyx_v_Z &gt; 0.0) != 0);
    if (__pyx_t_27) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">208</span>:             for d in range(maxDist):</pre>
<pre class='cython code score-0 '>      __pyx_t_6 = __pyx_v_maxDist;
      __pyx_t_15 = __pyx_t_6;
      for (__pyx_t_18 = 0; __pyx_t_18 &lt; __pyx_t_15; __pyx_t_18+=1) {
        __pyx_v_d = __pyx_t_18;
</pre><pre class="cython line score-103" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">209</span>:                 pNew = np.array([avgSnapshots[d][s][k]/(Z+nSamples) for s in model.agentStates for k in dict(avgSnapshots[d][s])])</pre>
<pre class='cython code score-103 '>        <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 209, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
        __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 209, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        { /* enter inner scope */
          __pyx_t_3 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 209, __pyx_L35_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
          __pyx_t_9 = __pyx_memoryview_fromslice(__pyx_v_model-&gt;agentStates, 1, (PyObject *(*)(char *)) __pyx_memview_get_long, (int (*)(char *, PyObject *)) __pyx_memview_set_long, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 209, __pyx_L35_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
          if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_9)) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_9)) {
            __pyx_t_8 = __pyx_t_9; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8); __pyx_t_28 = 0;
            __pyx_t_29 = NULL;
          } else {
            __pyx_t_28 = -1; __pyx_t_8 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 209, __pyx_L35_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
            __pyx_t_29 = Py_TYPE(__pyx_t_8)-&gt;tp_iternext;<span class='error_goto'> if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 209, __pyx_L35_error)</span>
          }
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
          for (;;) {
            if (likely(!__pyx_t_29)) {
              if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_8))) {
                if (__pyx_t_28 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_8)) break;
                #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
                __pyx_t_9 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_8, __pyx_t_28); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9); __pyx_t_28++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 209, __pyx_L35_error)</span>
                #else
                __pyx_t_9 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_8, __pyx_t_28); __pyx_t_28++;<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 209, __pyx_L35_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
                #endif
              } else {
                if (__pyx_t_28 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_8)) break;
                #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
                __pyx_t_9 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_8, __pyx_t_28); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9); __pyx_t_28++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 209, __pyx_L35_error)</span>
                #else
                __pyx_t_9 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_8, __pyx_t_28); __pyx_t_28++;<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 209, __pyx_L35_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
                #endif
              }
            } else {
              __pyx_t_9 = __pyx_t_29(__pyx_t_8);
              if (unlikely(!__pyx_t_9)) {
                PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
                if (exc_type) {
                  if (likely(<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
                  else <span class='error_goto'>__PYX_ERR(0, 209, __pyx_L35_error)</span>
                }
                break;
              }
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
            }
            __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_9); if (unlikely((__pyx_t_16 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 209, __pyx_L35_error)</span>
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
            __pyx_7genexpr__pyx_v_s = __pyx_t_16;
            __pyx_t_30 = 0;
            __pyx_t_4 = <span class='pyx_c_api'>__pyx_convert_unordered_map_to_py_int____double</span>(((__pyx_v_avgSnapshots[__pyx_v_d])[__pyx_7genexpr__pyx_v_s]));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 209, __pyx_L35_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
            __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(((PyObject *)(&amp;PyDict_Type)), __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 209, __pyx_L35_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
            __pyx_t_4 = __Pyx_dict_iterator(__pyx_t_7, 1, ((PyObject *)NULL), (&amp;__pyx_t_31), (&amp;__pyx_t_16));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 209, __pyx_L35_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
            __pyx_t_9 = __pyx_t_4;
            __pyx_t_4 = 0;
            while (1) {
              __pyx_t_26 = __Pyx_dict_iter_next(__pyx_t_9, __pyx_t_31, &amp;__pyx_t_30, &amp;__pyx_t_4, NULL, NULL, __pyx_t_16);
              if (unlikely(__pyx_t_26 == 0)) break;
              if (unlikely(__pyx_t_26 == -1)) <span class='error_goto'>__PYX_ERR(0, 209, __pyx_L35_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
              <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_7genexpr__pyx_v_k, __pyx_t_4);
              __pyx_t_4 = 0;
              __pyx_t_26 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_7genexpr__pyx_v_k); if (unlikely((__pyx_t_26 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 209, __pyx_L35_error)</span>
              __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>((((double)(((__pyx_v_avgSnapshots[__pyx_v_d])[__pyx_7genexpr__pyx_v_s])[__pyx_t_26])) / (__pyx_v_Z + __pyx_v_nSamples)));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 209, __pyx_L35_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
              if (unlikely(<span class='pyx_c_api'>__Pyx_ListComp_Append</span>(__pyx_t_3, (PyObject*)__pyx_t_4))) <span class='error_goto'>__PYX_ERR(0, 209, __pyx_L35_error)</span>
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
            }
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
          }
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_7genexpr__pyx_v_k); __pyx_7genexpr__pyx_v_k = 0;
          goto __pyx_L40_exit_scope;
          __pyx_L35_error:;
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_7genexpr__pyx_v_k); __pyx_7genexpr__pyx_v_k = 0;
          goto __pyx_L1_error;
          __pyx_L40_exit_scope:;
        } /* exit inner scope */
        __pyx_t_8 = NULL;
        if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
          __pyx_t_8 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
          if (likely(__pyx_t_8)) {
            PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
            <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
          }
        }
        __pyx_t_10 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_8, __pyx_t_3) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_5, __pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        if (unlikely(!__pyx_t_10)) <span class='error_goto'>__PYX_ERR(0, 209, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_pNew, __pyx_t_10);
        __pyx_t_10 = 0;
</pre><pre class="cython line score-112" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">210</span>:                 pOld = np.array([oldAvgSnapshots[d][s][k]/Z if k in dict(oldAvgSnapshots[d][s]) else 0 for s in model.agentStates for k in dict(avgSnapshots[d][s])])</pre>
<pre class='cython code score-112 '>        <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 210, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
        __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 210, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        { /* enter inner scope */
          __pyx_t_5 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 210, __pyx_L43_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          __pyx_t_8 = __pyx_memoryview_fromslice(__pyx_v_model-&gt;agentStates, 1, (PyObject *(*)(char *)) __pyx_memview_get_long, (int (*)(char *, PyObject *)) __pyx_memview_set_long, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 210, __pyx_L43_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_8)) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_8)) {
            __pyx_t_9 = __pyx_t_8; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9); __pyx_t_28 = 0;
            __pyx_t_29 = NULL;
          } else {
            __pyx_t_28 = -1; __pyx_t_9 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 210, __pyx_L43_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
            __pyx_t_29 = Py_TYPE(__pyx_t_9)-&gt;tp_iternext;<span class='error_goto'> if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 210, __pyx_L43_error)</span>
          }
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
          for (;;) {
            if (likely(!__pyx_t_29)) {
              if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_9))) {
                if (__pyx_t_28 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_9)) break;
                #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
                __pyx_t_8 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_9, __pyx_t_28); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8); __pyx_t_28++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 210, __pyx_L43_error)</span>
                #else
                __pyx_t_8 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_9, __pyx_t_28); __pyx_t_28++;<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 210, __pyx_L43_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
                #endif
              } else {
                if (__pyx_t_28 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_9)) break;
                #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
                __pyx_t_8 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_9, __pyx_t_28); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8); __pyx_t_28++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 210, __pyx_L43_error)</span>
                #else
                __pyx_t_8 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_9, __pyx_t_28); __pyx_t_28++;<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 210, __pyx_L43_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
                #endif
              }
            } else {
              __pyx_t_8 = __pyx_t_29(__pyx_t_9);
              if (unlikely(!__pyx_t_8)) {
                PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
                if (exc_type) {
                  if (likely(<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
                  else <span class='error_goto'>__PYX_ERR(0, 210, __pyx_L43_error)</span>
                }
                break;
              }
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
            }
            __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_8); if (unlikely((__pyx_t_16 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 210, __pyx_L43_error)</span>
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
            __pyx_8genexpr1__pyx_v_s = __pyx_t_16;
            __pyx_t_31 = 0;
            __pyx_t_4 = <span class='pyx_c_api'>__pyx_convert_unordered_map_to_py_int____double</span>(((__pyx_v_avgSnapshots[__pyx_v_d])[__pyx_8genexpr1__pyx_v_s]));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 210, __pyx_L43_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
            __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(((PyObject *)(&amp;PyDict_Type)), __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 210, __pyx_L43_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
            __pyx_t_4 = __Pyx_dict_iterator(__pyx_t_7, 1, ((PyObject *)NULL), (&amp;__pyx_t_30), (&amp;__pyx_t_16));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 210, __pyx_L43_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
            __pyx_t_8 = __pyx_t_4;
            __pyx_t_4 = 0;
            while (1) {
              __pyx_t_26 = __Pyx_dict_iter_next(__pyx_t_8, __pyx_t_30, &amp;__pyx_t_31, &amp;__pyx_t_4, NULL, NULL, __pyx_t_16);
              if (unlikely(__pyx_t_26 == 0)) break;
              if (unlikely(__pyx_t_26 == -1)) <span class='error_goto'>__PYX_ERR(0, 210, __pyx_L43_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
              <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_8genexpr1__pyx_v_k, __pyx_t_4);
              __pyx_t_4 = 0;
              __pyx_t_7 = <span class='pyx_c_api'>__pyx_convert_unordered_map_to_py_int____double</span>(((__pyx_v_oldAvgSnapshots[__pyx_v_d])[__pyx_8genexpr1__pyx_v_s]));<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 210, __pyx_L43_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
              __pyx_t_32 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(((PyObject *)(&amp;PyDict_Type)), __pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_32)) __PYX_ERR(0, 210, __pyx_L43_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_32);
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
              __pyx_t_27 = (<span class='pyx_c_api'>__Pyx_PyDict_ContainsTF</span>(__pyx_8genexpr1__pyx_v_k, __pyx_t_32, Py_EQ)); if (unlikely(__pyx_t_27 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 210, __pyx_L43_error)</span>
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_32); __pyx_t_32 = 0;
              if ((__pyx_t_27 != 0)) {
                __pyx_t_26 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_8genexpr1__pyx_v_k); if (unlikely((__pyx_t_26 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 210, __pyx_L43_error)</span>
                __pyx_t_32 = <span class='py_c_api'>PyFloat_FromDouble</span>((((double)(((__pyx_v_oldAvgSnapshots[__pyx_v_d])[__pyx_8genexpr1__pyx_v_s])[__pyx_t_26])) / __pyx_v_Z));<span class='error_goto'> if (unlikely(!__pyx_t_32)) __PYX_ERR(0, 210, __pyx_L43_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_32);
                __pyx_t_4 = __pyx_t_32;
                __pyx_t_32 = 0;
              } else {
                <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
                __pyx_t_4 = __pyx_int_0;
              }
              if (unlikely(<span class='pyx_c_api'>__Pyx_ListComp_Append</span>(__pyx_t_5, (PyObject*)__pyx_t_4))) <span class='error_goto'>__PYX_ERR(0, 210, __pyx_L43_error)</span>
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
            }
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
          }
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_8genexpr1__pyx_v_k); __pyx_8genexpr1__pyx_v_k = 0;
          goto __pyx_L48_exit_scope;
          __pyx_L43_error:;
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_8genexpr1__pyx_v_k); __pyx_8genexpr1__pyx_v_k = 0;
          goto __pyx_L1_error;
          __pyx_L48_exit_scope:;
        } /* exit inner scope */
        __pyx_t_9 = NULL;
        if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
          __pyx_t_9 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
          if (likely(__pyx_t_9)) {
            PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
            <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
          }
        }
        __pyx_t_10 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_9, __pyx_t_5) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        if (unlikely(!__pyx_t_10)) <span class='error_goto'>__PYX_ERR(0, 210, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_pOld, __pyx_t_10);
        __pyx_t_10 = 0;
</pre><pre class="cython line score-40" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">211</span>:                 KL_d = scipy.stats.entropy(pOld, pNew, base=2) # computes the Kullback-Leibler divergence: information gain if pNew is used instead of pOld</pre>
<pre class='cython code score-40 '>        <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_10, __pyx_n_s_scipy);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 211, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
        __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_10, __pyx_n_s_stats);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 211, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
        __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_entropy);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 211, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 211, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_pOld);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_pOld);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_v_pOld);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_pNew);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_pNew);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1, __pyx_v_pNew);
        __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 211, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
        if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_base, __pyx_int_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 211, __pyx_L1_error)</span>
        __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_10, __pyx_t_3, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 211, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_33 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_9); if (unlikely((__pyx_t_33 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 211, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
        __pyx_v_KL_d = __pyx_t_33;
</pre><pre class="cython line score-0">&#xA0;<span class="">212</span>:                 #differences = np.array([(oldSnapshots[d][s][k]/Z - snapshots[d][s][k]/(Z+nSamples)) if k in dict(oldSnapshots[d][s]) \</pre>
<pre class="cython line score-0">&#xA0;<span class="">213</span>:                 #                        else snapshots[d][s][k]/(Z+nSamples) for s in model.agentStates for k in dict(snapshots[d][s])])</pre>
<pre class="cython line score-0">&#xA0;<span class="">214</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">215</span>:                 #mse[d] = np.sum(np.power(differences, 2))</pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">216</span>:                 KL[d] = KL_d</pre>
<pre class='cython code score-8 '>        __pyx_t_9 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_KL_d);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 216, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
        if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(((PyObject *)__pyx_v_KL), __pyx_v_d, __pyx_t_9, long, 1, __Pyx_PyInt_From_long, 0, 0, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 216, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">217</span>:         oldAvgSnapshots = avgSnapshots</pre>
<pre class='cython code score-0 '>    __pyx_v_oldAvgSnapshots = __pyx_v_avgSnapshots;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">218</span>:         Z += nSamples</pre>
<pre class='cython code score-0 '>    __pyx_v_Z = (__pyx_v_Z + __pyx_v_nSamples);
</pre><pre class="cython line score-9" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">219</span>:         print(f'KL = {KL}')</pre>
<pre class='cython code score-9 '>    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_FormatSimple</span>(((PyObject *)__pyx_v_KL), __pyx_empty_unicode);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 219, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyUnicode_Concat</span>(__pyx_kp_u_KL, __pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 219, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_builtin_print, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 219, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
</pre><pre class="cython line score-34" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">220</span>:         if np.all(KL &lt; threshold):</pre>
<pre class='cython code score-34 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 220, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_all);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 220, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_threshold);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 220, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_10 = <span class='py_c_api'>PyObject_RichCompare</span>(((PyObject *)__pyx_v_KL), __pyx_t_5, Py_LT); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 220, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
      __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
      if (likely(__pyx_t_5)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
      }
    }
    __pyx_t_9 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_5, __pyx_t_10) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_10);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    if (unlikely(!__pyx_t_9)) <span class='error_goto'>__PYX_ERR(0, 220, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_27 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_9); if (unlikely(__pyx_t_27 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 220, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    if (__pyx_t_27) {
/* … */
    }
  }
  __pyx_L6_break:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">221</span>:             break</pre>
<pre class='cython code score-0 '>      goto __pyx_L6_break;
</pre><pre class="cython line score-0">&#xA0;<span class="">222</span>: </pre>
<pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">223</span>:     return snapshots, avgSnapshots, Z</pre>
<pre class='cython code score-14 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_9 = __pyx_convert_vector_to_py_std_3a__3a_unordered_map_3c_int_2c_std_3a__3a_unordered_map_3c_std_3a__3a_string_2c_double_3e____3e___(__pyx_v_snapshots);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 223, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  __pyx_t_3 = __pyx_convert_vector_to_py_std_3a__3a_unordered_map_3c_int_2c_std_3a__3a_unordered_map_3c_int_2c_double_3e____3e___(__pyx_v_avgSnapshots);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 223, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_10 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_Z);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 223, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 223, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_9);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1, __pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_10);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 2, __pyx_t_10);
  __pyx_t_9 = 0;
  __pyx_t_3 = 0;
  __pyx_t_10 = 0;
  __pyx_r = ((PyObject*)__pyx_t_5);
  __pyx_t_5 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">224</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">225</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">226</span>: </pre>
<pre class="cython line score-79" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">227</span>: cpdef np.ndarray monteCarloFixedNeighbours(Model model, string snapshot, long node, \</pre>
<pre class='cython code score-79 '>static PyObject *__pyx_pw_7Toolbox_8infcyIDL_7monteCarloFixedNeighbours(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyArrayObject *__pyx_f_7Toolbox_8infcyIDL_monteCarloFixedNeighbours(struct __pyx_obj_6Models_6models_Model *__pyx_v_model, std::string __pyx_v_snapshot, long __pyx_v_node, std::vector&lt;long&gt;  __pyx_v_neighbours, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_7Toolbox_8infcyIDL_monteCarloFixedNeighbours *__pyx_optional_args) {
  long __pyx_v_nSamples = ((long)10);
  long __pyx_v_distSamples = ((long)10);
  PyArrayObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("monteCarloFixedNeighbours", 0);
  if (__pyx_optional_args) {
    if (__pyx_optional_args-&gt;__pyx_n &gt; 0) {
      __pyx_v_nSamples = __pyx_optional_args-&gt;nSamples;
      if (__pyx_optional_args-&gt;__pyx_n &gt; 1) {
        __pyx_v_distSamples = __pyx_optional_args-&gt;distSamples;
      }
    }
  }
/* … */
  /* function exit code */
  __pyx_L1_error:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.monteCarloFixedNeighbours", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>((PyObject *)__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_7Toolbox_8infcyIDL_7monteCarloFixedNeighbours(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_7Toolbox_8infcyIDL_7monteCarloFixedNeighbours(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_6Models_6models_Model *__pyx_v_model = 0;
  std::string __pyx_v_snapshot;
  long __pyx_v_node;
  std::vector&lt;long&gt;  __pyx_v_neighbours;
  long __pyx_v_nSamples;
  long __pyx_v_distSamples;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("monteCarloFixedNeighbours (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_model,&amp;__pyx_n_s_snapshot,&amp;__pyx_n_s_node,&amp;__pyx_n_s_neighbours,&amp;__pyx_n_s_nSamples,&amp;__pyx_n_s_distSamples,0};
    PyObject* values[6] = {0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_model)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_snapshot)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("monteCarloFixedNeighbours", 0, 4, 6, 1); <span class='error_goto'>__PYX_ERR(0, 227, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_node)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("monteCarloFixedNeighbours", 0, 4, 6, 2); <span class='error_goto'>__PYX_ERR(0, 227, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_neighbours)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("monteCarloFixedNeighbours", 0, 4, 6, 3); <span class='error_goto'>__PYX_ERR(0, 227, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_nSamples);
          if (value) { values[4] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_distSamples);
          if (value) { values[5] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "monteCarloFixedNeighbours") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 227, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_model = ((struct __pyx_obj_6Models_6models_Model *)values[0]);
    __pyx_v_snapshot = <span class='pyx_c_api'>__pyx_convert_string_from_py_std__in_string</span>(values[1]);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 227, __pyx_L3_error)</span>
    __pyx_v_node = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[2]); if (unlikely((__pyx_v_node == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 227, __pyx_L3_error)</span>
    __pyx_v_neighbours = <span class='pyx_c_api'>__pyx_convert_vector_from_py_long</span>(values[3]);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 228, __pyx_L3_error)</span>
    if (values[4]) {
      __pyx_v_nSamples = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[4]); if (unlikely((__pyx_v_nSamples == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 229, __pyx_L3_error)</span>
    } else {
      __pyx_v_nSamples = ((long)10);
    }
    if (values[5]) {
      __pyx_v_distSamples = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[5]); if (unlikely((__pyx_v_distSamples == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 229, __pyx_L3_error)</span>
    } else {
      __pyx_v_distSamples = ((long)10);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("monteCarloFixedNeighbours", 0, 4, 6, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 227, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.monteCarloFixedNeighbours", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_model), __pyx_ptype_6Models_6models_Model, 1, "model", 0))) <span class='error_goto'>__PYX_ERR(0, 227, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_7Toolbox_8infcyIDL_6monteCarloFixedNeighbours(__pyx_self, __pyx_v_model, __pyx_v_snapshot, __pyx_v_node, __pyx_v_neighbours, __pyx_v_nSamples, __pyx_v_distSamples);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_7Toolbox_8infcyIDL_6monteCarloFixedNeighbours(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6Models_6models_Model *__pyx_v_model, std::string __pyx_v_snapshot, long __pyx_v_node, std::vector&lt;long&gt;  __pyx_v_neighbours, long __pyx_v_nSamples, long __pyx_v_distSamples) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("monteCarloFixedNeighbours", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_2.__pyx_n = 2;
  __pyx_t_2.nSamples = __pyx_v_nSamples;
  __pyx_t_2.distSamples = __pyx_v_distSamples;
  __pyx_t_1 = ((PyObject *)__pyx_f_7Toolbox_8infcyIDL_monteCarloFixedNeighbours(__pyx_v_model, __pyx_v_snapshot, __pyx_v_node, __pyx_v_neighbours, 0, &amp;__pyx_t_2));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 227, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.monteCarloFixedNeighbours", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
struct __pyx_opt_args_7Toolbox_8infcyIDL_monteCarloFixedNeighbours {
  int __pyx_n;
  long nSamples;
  long distSamples;
};
</pre><pre class="cython line score-0">&#xA0;<span class="">228</span>:                vector[long] neighbours, \</pre>
<pre class="cython line score-0">&#xA0;<span class="">229</span>:                long nSamples = 10, long distSamples = 10):</pre>
<pre class="cython line score-0">&#xA0;<span class="">230</span>: </pre>
<pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">231</span>:       return _monteCarloFixedNeighbours(model, snapshot, node, \</pre>
<pre class='cython code score-1 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
/* … */
  __pyx_t_2.__pyx_n = 2;
  __pyx_t_2.nSamples = __pyx_v_nSamples;
  __pyx_t_2.distSamples = __pyx_v_distSamples;
  __pyx_t_1 = __pyx_f_7Toolbox_8infcyIDL__monteCarloFixedNeighbours(__pyx_v_model, __pyx_v_snapshot, __pyx_v_node, __pyx_v_neighbours, &amp;__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 231, __pyx_L1_error)</span>
/* … */
  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_t_1, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 231, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 1);
  __pyx_t_1.memview = NULL;
  __pyx_t_1.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">232</span>:                      neighbours, \</pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">233</span>:                      nSamples, distSamples).base</pre>
<pre class='cython code score-5 '>  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_base);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 233, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 233, __pyx_L1_error)</span>
  __pyx_r = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">234</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">235</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">236</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">237</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">238</span>: @cython.wraparound(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">239</span>: @cython.nonecheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">240</span>: @cython.cdivision(True)</pre>
<pre class="cython line score-0">&#xA0;<span class="">241</span>: @cython.initializedcheck(False)</pre>
<pre class="cython line score-18" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">242</span>: cdef double[::1] _monteCarloFixedNeighbours(Model model, string snapshot, long node, \</pre>
<pre class='cython code score-18 '>static __Pyx_memviewslice __pyx_f_7Toolbox_8infcyIDL__monteCarloFixedNeighbours(struct __pyx_obj_6Models_6models_Model *__pyx_v_model, std::string __pyx_v_snapshot, long __pyx_v_node, std::vector&lt;long&gt;  __pyx_v_neighbours, struct __pyx_opt_args_7Toolbox_8infcyIDL__monteCarloFixedNeighbours *__pyx_optional_args) {
  long __pyx_v_nSamples = __pyx_k__6;
  long __pyx_v_distSamples = __pyx_k__7;
  double __pyx_v_Z;
  double __pyx_v_part;
  long __pyx_v_idx;
  CYTHON_UNUSED long __pyx_v_sample;
  CYTHON_UNUSED long __pyx_v_length;
  long __pyx_v_nodeState;
  std::unordered_map&lt;int,int&gt;  __pyx_v_idxer;
  __Pyx_memviewslice __pyx_v_probCondArr = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_decodedStates = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_r = { 0, 0, { 0 }, { 0 }, { 0 } };
  #ifdef WITH_THREAD
  PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
  #endif
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("_monteCarloFixedNeighbours", 0);
  if (__pyx_optional_args) {
    if (__pyx_optional_args-&gt;__pyx_n &gt; 0) {
      __pyx_v_nSamples = __pyx_optional_args-&gt;nSamples;
      if (__pyx_optional_args-&gt;__pyx_n &gt; 1) {
        __pyx_v_distSamples = __pyx_optional_args-&gt;distSamples;
      }
    }
  }
  #ifdef WITH_THREAD
  <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
  #endif
/* … */
  /* function exit code */
  __Pyx_pretend_to_initialize(&amp;__pyx_r);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_10, 0);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_11, 0);
  __pyx_r.data = NULL;
  __pyx_r.memview = NULL;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL._monteCarloFixedNeighbours", __pyx_clineno, __pyx_lineno, __pyx_filename);
  goto __pyx_L2;
  __pyx_L0:;
  if (unlikely(!__pyx_r.memview)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "Memoryview return value is not initialized");
  }
  __pyx_L2:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_probCondArr, 0);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_decodedStates, 0);
  #ifdef WITH_THREAD
  <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
  #endif
  return __pyx_r;
}
/* … */
struct __pyx_opt_args_7Toolbox_8infcyIDL__monteCarloFixedNeighbours {
  int __pyx_n;
  long nSamples;
  long distSamples;
};
</pre><pre class="cython line score-0">&#xA0;<span class="">243</span>:                vector[long] neighbours, \</pre>
<pre class="cython line score-20" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">244</span>:                long nSamples = int(1e3), long distSamples = int(1e2)) nogil:</pre>
<pre class='cython code score-20 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyNumber_Int</span>(__pyx_float_1e3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 244, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_2); if (unlikely((__pyx_t_3 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 244, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_k__6 = __pyx_t_3;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyNumber_Int</span>(__pyx_float_1e2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 244, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_2); if (unlikely((__pyx_t_3 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 244, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_k__7 = __pyx_t_3;
</pre><pre class="cython line score-0">&#xA0;<span class="">245</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">246</span>: </pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">247</span>:     cdef:</pre>
<pre class='cython code score-4 '>  /*try:*/ {
/* … */
  /*finally:*/ {
    __pyx_L3_return: {
      #ifdef WITH_THREAD
      __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
      #endif
      goto __pyx_L0;
    }
    __pyx_L4_error: {
      #ifdef WITH_THREAD
      __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
      #endif
      goto __pyx_L1_error;
    }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">248</span>:        double Z = &lt;double&gt; nSamples</pre>
<pre class='cython code score-0 '>    __pyx_v_Z = ((double)__pyx_v_nSamples);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">249</span>:        double part = 1/Z</pre>
<pre class='cython code score-0 '>    __pyx_v_part = (1.0 / __pyx_v_Z);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">250</span>:        long idx, rep, sample, length = neighbours.size()</pre>
<pre class='cython code score-0 '>    __pyx_v_length = __pyx_v_neighbours.size();
</pre><pre class="cython line score-0">&#xA0;<span class="">251</span>:        long nodeState</pre>
<pre class="cython line score-0">&#xA0;<span class="">252</span>:        unordered_map[int, int] idxer</pre>
<pre class="cython line score-0">&#xA0;<span class="">253</span>:        double[::1] probCondArr</pre>
<pre class="cython line score-0">&#xA0;<span class="">254</span>:        long[::1] decodedStates</pre>
<pre class="cython line score-0">&#xA0;<span class="">255</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">256</span>:     for idx in range(model.agentStates.shape[0]):</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = (__pyx_v_model-&gt;agentStates.shape[0]);
    __pyx_t_2 = __pyx_t_1;
    for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
      __pyx_v_idx = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">257</span>:         idxer[model.agentStates[idx]] = idx</pre>
<pre class='cython code score-0 '>      __pyx_t_4 = __pyx_v_idx;
      (__pyx_v_idxer[(*((long *) ( /* dim=0 */ ((char *) (((long *) __pyx_v_model-&gt;agentStates.data) + __pyx_t_4)) )))]) = __pyx_v_idx;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">258</span>: </pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">259</span>:     with gil:</pre>
<pre class='cython code score-6 '>    {
        #ifdef WITH_THREAD
        PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
        #endif
        /*try:*/ {
/* … */
        /*finally:*/ {
          /*normal exit:*/{
            #ifdef WITH_THREAD
            <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
            #endif
            goto __pyx_L10;
          }
          __pyx_L9_error: {
            #ifdef WITH_THREAD
            <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
            #endif
            goto __pyx_L4_error;
          }
          __pyx_L10:;
        }
    }
</pre><pre class="cython line score-42" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">260</span>:         decodedStates = np.frombuffer(snapshot).astype(int)</pre>
<pre class='cython code score-42 '>          <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_7, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 260, __pyx_L9_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
          __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_frombuffer);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 260, __pyx_L9_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
          __pyx_t_7 = <span class='pyx_c_api'>__pyx_convert_PyBytes_string_to_py_std__in_string</span>(__pyx_v_snapshot);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 260, __pyx_L9_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
          __pyx_t_9 = NULL;
          if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_8))) {
            __pyx_t_9 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_8);
            if (likely(__pyx_t_9)) {
              PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_8);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
              <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_8, function);
            }
          }
          __pyx_t_6 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_8, __pyx_t_9, __pyx_t_7) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_8, __pyx_t_7);
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
          if (unlikely(!__pyx_t_6)) <span class='error_goto'>__PYX_ERR(0, 260, __pyx_L9_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
          __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_astype);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 260, __pyx_L9_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          __pyx_t_6 = NULL;
          if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_8))) {
            __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_8);
            if (likely(__pyx_t_6)) {
              PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_8);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
              <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_8, function);
            }
          }
          __pyx_t_5 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_8, __pyx_t_6, ((PyObject *)(&amp;PyInt_Type))) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_8, ((PyObject *)(&amp;PyInt_Type)));
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 260, __pyx_L9_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
          __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dc_long</span>(__pyx_t_5, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_10.memview)) __PYX_ERR(0, 260, __pyx_L9_error)</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_v_decodedStates = __pyx_t_10;
          __pyx_t_10.memview = NULL;
          __pyx_t_10.data = NULL;
</pre><pre class="cython line score-25" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">261</span>:         probCondArr = np.zeros(idxer.size())</pre>
<pre class='cython code score-25 '>          <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_8, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 261, __pyx_L9_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 261, __pyx_L9_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
          __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyInt_FromSize_t</span>(__pyx_v_idxer.size());<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 261, __pyx_L9_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          __pyx_t_7 = NULL;
          if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_6))) {
            __pyx_t_7 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_6);
            if (likely(__pyx_t_7)) {
              PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_6);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
              <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_6, function);
            }
          }
          __pyx_t_5 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_7, __pyx_t_8) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_6, __pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
          if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 261, __pyx_L9_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dc_double</span>(__pyx_t_5, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 261, __pyx_L9_error)</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_v_probCondArr = __pyx_t_11;
          __pyx_t_11.memview = NULL;
          __pyx_t_11.data = NULL;
        }
</pre><pre class="cython line score-0">&#xA0;<span class="">262</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">263</span>:     model._loadStatesFromString(decodedStates, neighbours) # keeps all other node states as they are</pre>
<pre class='cython code score-0 '>    ((struct __pyx_vtabstruct_6Models_6models_Model *)__pyx_v_model-&gt;__pyx_vtab)-&gt;_loadStatesFromString(__pyx_v_model, __pyx_v_decodedStates, __pyx_v_neighbours);
</pre><pre class="cython line score-0">&#xA0;<span class="">264</span>:     #model.simulateNSteps(burninSamples)</pre>
<pre class="cython line score-0">&#xA0;<span class="">265</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">266</span>:     for sample in range(nSamples):</pre>
<pre class='cython code score-0 '>    __pyx_t_3 = __pyx_v_nSamples;
    __pyx_t_12 = __pyx_t_3;
    for (__pyx_t_13 = 0; __pyx_t_13 &lt; __pyx_t_12; __pyx_t_13+=1) {
      __pyx_v_sample = __pyx_t_13;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">267</span>:         model.simulateNSteps(distSamples)</pre>
<pre class='cython code score-0 '>      __pyx_t_10 = ((struct __pyx_vtabstruct_6Models_6models_Model *)__pyx_v_model-&gt;__pyx_vtab)-&gt;simulateNSteps(__pyx_v_model, __pyx_v_distSamples);<span class='error_goto'> if (unlikely(!__pyx_t_10.memview)) __PYX_ERR(0, 267, __pyx_L4_error)</span>
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_10, 0);
      __pyx_t_10.memview = NULL;
      __pyx_t_10.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">268</span>:         nodeState = model._states[node]</pre>
<pre class='cython code score-0 '>      __pyx_t_14 = __pyx_v_node;
      __pyx_v_nodeState = (*((long *) ( /* dim=0 */ ((char *) (((long *) __pyx_v_model-&gt;_states.data) + __pyx_t_14)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">269</span>:         probCondArr[idxer[nodeState]] += part</pre>
<pre class='cython code score-0 '>      __pyx_t_15 = (__pyx_v_idxer[__pyx_v_nodeState]);
      *((double *) ( /* dim=0 */ ((char *) (((double *) __pyx_v_probCondArr.data) + __pyx_t_15)) )) += __pyx_v_part;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">270</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">271</span>:     return probCondArr</pre>
<pre class='cython code score-0 '>    __PYX_INC_MEMVIEW(&amp;__pyx_v_probCondArr, 1);
    __pyx_r = __pyx_v_probCondArr;
    goto __pyx_L3_return;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">272</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">273</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">274</span>: @cython.wraparound(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">275</span>: @cython.nonecheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">276</span>: @cython.cdivision(True)</pre>
<pre class="cython line score-0">&#xA0;<span class="">277</span>: @cython.initializedcheck(False)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">278</span>: cdef double entropyFromProbs(double[::1] probs) nogil:</pre>
<pre class='cython code score-0 '>static double __pyx_f_7Toolbox_8infcyIDL_entropyFromProbs(__Pyx_memviewslice __pyx_v_probs) {
  double __pyx_v_p;
  double __pyx_v_H;
  long __pyx_v_i;
  long __pyx_v_n;
  double __pyx_r;
/* … */
  /* function exit code */
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">279</span>:     cdef:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">280</span>:         double p, H = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_H = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">281</span>:         long i, n = probs.shape[0]</pre>
<pre class='cython code score-0 '>  __pyx_v_n = (__pyx_v_probs.shape[0]);
</pre><pre class="cython line score-0">&#xA0;<span class="">282</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">283</span>:     for i in range(n):</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_n;
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">284</span>:         p = probs[i]</pre>
<pre class='cython code score-0 '>    __pyx_t_4 = __pyx_v_i;
    __pyx_v_p = (*((double *) ( /* dim=0 */ ((char *) (((double *) __pyx_v_probs.data) + __pyx_t_4)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">285</span>:         if p &gt; 0:</pre>
<pre class='cython code score-0 '>    __pyx_t_5 = ((__pyx_v_p &gt; 0.0) != 0);
    if (__pyx_t_5) {
/* … */
    }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">286</span>:             H = H - p * log2(p)</pre>
<pre class='cython code score-0 '>      __pyx_v_H = (__pyx_v_H - (__pyx_v_p * log2(__pyx_v_p)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">287</span>:     return H</pre>
<pre class='cython code score-0 '>  __pyx_r = __pyx_v_H;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">288</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">289</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">290</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">291</span>: @cython.wraparound(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">292</span>: @cython.nonecheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">293</span>: @cython.cdivision(True)</pre>
<pre class="cython line score-0">&#xA0;<span class="">294</span>: @cython.initializedcheck(False)</pre>
<pre class="cython line score-89" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">295</span>: cpdef tuple neighbourhoodMI(Model model, long node, vector[long] neighbours, unordered_map[string, double] snapshots, \</pre>
<pre class='cython code score-89 '>static PyObject *__pyx_pw_7Toolbox_8infcyIDL_9neighbourhoodMI(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_7Toolbox_8infcyIDL_neighbourhoodMI(struct __pyx_obj_6Models_6models_Model *__pyx_v_model, long __pyx_v_node, std::vector&lt;long&gt;  __pyx_v_neighbours, std::unordered_map&lt;std::string,double&gt;  __pyx_v_snapshots, long __pyx_v_nSamples, long __pyx_v_distSamples, CYTHON_UNUSED int __pyx_skip_dispatch) {
  struct __pyx_obj_6Models_6models_Model *__pyx_v_tmp = 0;
  std::vector&lt;PyObjectHolder&gt;  __pyx_v_models_;
  int __pyx_v_tid;
  int __pyx_v_nThreads;
  long __pyx_v_n;
  long __pyx_v_idx;
  long __pyx_v_nNeighbours;
  __Pyx_memviewslice __pyx_v_pX = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_HXgiveny;
  double __pyx_v_HXgivenY;
  double __pyx_v_MI;
  PyObject *__pyx_v_snapshotsDict = 0;
  std::vector&lt;std::string&gt;  __pyx_v_keys;
  __Pyx_memviewslice __pyx_v_probs = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_container = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_v_pbar = NULL;
  std::string __pyx_8genexpr2__pyx_v_k;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("neighbourhoodMI", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_14);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_15, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_16);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_17, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_23, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_25);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_26);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.neighbourhoodMI", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_tmp);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_pX, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_snapshotsDict);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_probs, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_container, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_pbar);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_7Toolbox_8infcyIDL_9neighbourhoodMI(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_7Toolbox_8infcyIDL_9neighbourhoodMI(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_6Models_6models_Model *__pyx_v_model = 0;
  long __pyx_v_node;
  std::vector&lt;long&gt;  __pyx_v_neighbours;
  std::unordered_map&lt;std::string,double&gt;  __pyx_v_snapshots;
  long __pyx_v_nSamples;
  long __pyx_v_distSamples;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("neighbourhoodMI (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_model,&amp;__pyx_n_s_node,&amp;__pyx_n_s_neighbours,&amp;__pyx_n_s_snapshots,&amp;__pyx_n_s_nSamples,&amp;__pyx_n_s_distSamples,0};
    PyObject* values[6] = {0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_model)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_node)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("neighbourhoodMI", 1, 6, 6, 1); <span class='error_goto'>__PYX_ERR(0, 295, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_neighbours)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("neighbourhoodMI", 1, 6, 6, 2); <span class='error_goto'>__PYX_ERR(0, 295, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_snapshots)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("neighbourhoodMI", 1, 6, 6, 3); <span class='error_goto'>__PYX_ERR(0, 295, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_nSamples)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("neighbourhoodMI", 1, 6, 6, 4); <span class='error_goto'>__PYX_ERR(0, 295, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_distSamples)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("neighbourhoodMI", 1, 6, 6, 5); <span class='error_goto'>__PYX_ERR(0, 295, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "neighbourhoodMI") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 295, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 6) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
      values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
    }
    __pyx_v_model = ((struct __pyx_obj_6Models_6models_Model *)values[0]);
    __pyx_v_node = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[1]); if (unlikely((__pyx_v_node == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 295, __pyx_L3_error)</span>
    __pyx_v_neighbours = <span class='pyx_c_api'>__pyx_convert_vector_from_py_long</span>(values[2]);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 295, __pyx_L3_error)</span>
    __pyx_v_snapshots = __pyx_convert_unordered_map_from_py_std_3a__3a_string__and_double(values[3]);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 295, __pyx_L3_error)</span>
    __pyx_v_nSamples = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[4]); if (unlikely((__pyx_v_nSamples == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 296, __pyx_L3_error)</span>
    __pyx_v_distSamples = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[5]); if (unlikely((__pyx_v_distSamples == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 296, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("neighbourhoodMI", 1, 6, 6, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 295, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.neighbourhoodMI", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_model), __pyx_ptype_6Models_6models_Model, 1, "model", 0))) <span class='error_goto'>__PYX_ERR(0, 295, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_7Toolbox_8infcyIDL_8neighbourhoodMI(__pyx_self, __pyx_v_model, __pyx_v_node, __pyx_v_neighbours, __pyx_v_snapshots, __pyx_v_nSamples, __pyx_v_distSamples);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_7Toolbox_8infcyIDL_8neighbourhoodMI(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6Models_6models_Model *__pyx_v_model, long __pyx_v_node, std::vector&lt;long&gt;  __pyx_v_neighbours, std::unordered_map&lt;std::string,double&gt;  __pyx_v_snapshots, long __pyx_v_nSamples, long __pyx_v_distSamples) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("neighbourhoodMI", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = __pyx_f_7Toolbox_8infcyIDL_neighbourhoodMI(__pyx_v_model, __pyx_v_node, __pyx_v_neighbours, __pyx_v_snapshots, __pyx_v_nSamples, __pyx_v_distSamples, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 295, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.neighbourhoodMI", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">296</span>:               long nSamples, long distSamples):</pre>
<pre class="cython line score-0">&#xA0;<span class="">297</span>:     cdef:</pre>
<pre class="cython line score-0">&#xA0;<span class="">298</span>:         Model tmp</pre>
<pre class="cython line score-0">&#xA0;<span class="">299</span>:         vector[PyObjectHolder] models_</pre>
<pre class="cython line score-29" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">300</span>:         int tid, nThreads = mp.cpu_count()</pre>
<pre class='cython code score-29 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_mp);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 300, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_cpu_count);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 300, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_2) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_2) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 300, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_1); if (unlikely((__pyx_t_4 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 300, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_nThreads = __pyx_t_4;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">301</span>:         long n, sample, idx, nNeighbours = neighbours.size()</pre>
<pre class='cython code score-0 '>  __pyx_v_nNeighbours = __pyx_v_neighbours.size();
</pre><pre class="cython line score-0">&#xA0;<span class="">302</span>:         string state</pre>
<pre class="cython line score-0">&#xA0;<span class="">303</span>:         double[::1] pY, pX</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">304</span>:         double HXgiveny, HXgivenY = 0, MI = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_HXgivenY = 0.0;
  __pyx_v_MI = 0.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">305</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">306</span>:     for idx in range(nNeighbours):</pre>
<pre class='cython code score-0 '>  __pyx_t_5 = __pyx_v_nNeighbours;
  __pyx_t_6 = __pyx_t_5;
  for (__pyx_t_7 = 0; __pyx_t_7 &lt; __pyx_t_6; __pyx_t_7+=1) {
    __pyx_v_idx = __pyx_t_7;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">307</span>:         n = neighbours[idx]</pre>
<pre class='cython code score-0 '>    __pyx_v_n = (__pyx_v_neighbours[__pyx_v_idx]);
</pre><pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">308</span>:         neighbours[idx] = model.mapping[n] # map from graph to model index</pre>
<pre class='cython code score-13 '>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(((PyObject *)__pyx_v_model), __pyx_n_s_mapping);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 308, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_1, __pyx_v_n, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 308, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_3); if (unlikely((__pyx_t_8 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 308, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    (__pyx_v_neighbours[__pyx_v_idx]) = __pyx_t_8;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">309</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">310</span>:     for tid in range(nThreads):</pre>
<pre class='cython code score-0 '>  __pyx_t_4 = __pyx_v_nThreads;
  __pyx_t_9 = __pyx_t_4;
  for (__pyx_t_10 = 0; __pyx_t_10 &lt; __pyx_t_9; __pyx_t_10+=1) {
    __pyx_v_tid = __pyx_t_10;
</pre><pre class="cython line score-22" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">311</span>:        tmp = copy.deepcopy(model)</pre>
<pre class='cython code score-22 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_copy);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 311, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_deepcopy);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 311, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
      __pyx_t_1 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
      if (likely(__pyx_t_1)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
      }
    }
    __pyx_t_3 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_1, ((PyObject *)__pyx_v_model)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, ((PyObject *)__pyx_v_model));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 311, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_6Models_6models_Model))))) <span class='error_goto'>__PYX_ERR(0, 311, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_tmp, ((struct __pyx_obj_6Models_6models_Model *)__pyx_t_3));
    __pyx_t_3 = 0;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">312</span>:        tmp.fixedNodes = neighbours</pre>
<pre class='cython code score-5 '>    __pyx_t_3 = <span class='pyx_c_api'>__pyx_convert_vector_to_py_long</span>(__pyx_v_neighbours);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 312, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    if (<span class='pyx_c_api'>__Pyx_PyObject_SetAttrStr</span>(((PyObject *)__pyx_v_tmp), __pyx_n_s_fixedNodes, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 312, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">313</span>:        models_.push_back(PyObjectHolder(&lt;PyObject *&gt; tmp))</pre>
<pre class='cython code score-0 '>    try {
      __pyx_v_models_.push_back(PyObjectHolder(((PyObject *)__pyx_v_tmp)));
    } catch(...) {
      __Pyx_CppExn2PyErr();
      <span class='error_goto'>__PYX_ERR(0, 313, __pyx_L1_error)</span>
    }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">314</span>: </pre>
<pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">315</span>:     node = model.mapping[node]</pre>
<pre class='cython code score-13 '>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(((PyObject *)__pyx_v_model), __pyx_n_s_mapping);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 315, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_3, __pyx_v_node, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 315, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_2); if (unlikely((__pyx_t_5 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 315, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_node = __pyx_t_5;
</pre><pre class="cython line score-0">&#xA0;<span class="">316</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">317</span>:     cdef:</pre>
<pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">318</span>:         dict snapshotsDict = snapshots</pre>
<pre class='cython code score-10 '>  __pyx_t_2 = __pyx_convert_unordered_map_to_py_std_3a__3a_string____double(__pyx_v_snapshots);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 318, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (!(likely(<span class='py_c_api'>PyDict_CheckExact</span>(__pyx_t_2))||(<span class='py_c_api'>PyErr_Format</span>(PyExc_TypeError, "Expected %.16s, got %.200s", "dict", Py_TYPE(__pyx_t_2)-&gt;tp_name), 0))) <span class='error_goto'>__PYX_ERR(0, 318, __pyx_L1_error)</span>
  __pyx_v_snapshotsDict = ((PyObject*)__pyx_t_2);
  __pyx_t_2 = 0;
</pre><pre class="cython line score-9" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">319</span>:         vector[string] keys = list(snapshotsDict.keys())</pre>
<pre class='cython code score-9 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyDict_Keys</span>(__pyx_v_snapshotsDict);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 319, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PySequence_List</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 319, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_11 = __pyx_convert_vector_from_py_std_3a__3a_string(__pyx_t_3);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 319, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_keys = __pyx_t_11;
</pre><pre class="cython line score-36" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">320</span>:         double[::1] probs = np.array([snapshots[k] for k in keys])</pre>
<pre class='cython code score-36 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 320, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 320, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  { /* enter inner scope */
    __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 320, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_12 = __pyx_v_keys.begin();
    for (;;) {
      if (!(__pyx_t_12 != __pyx_v_keys.end())) break;
      __pyx_t_13 = *__pyx_t_12;
      ++__pyx_t_12;
      __pyx_8genexpr2__pyx_v_k = __pyx_t_13;
      __pyx_t_14 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_snapshots[__pyx_8genexpr2__pyx_v_k]));<span class='error_goto'> if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 320, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
      if (unlikely(<span class='pyx_c_api'>__Pyx_ListComp_Append</span>(__pyx_t_2, (PyObject*)__pyx_t_14))) <span class='error_goto'>__PYX_ERR(0, 320, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
    }
  } /* exit inner scope */
  __pyx_t_14 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
    __pyx_t_14 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
    if (likely(__pyx_t_14)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_14);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
    }
  }
  __pyx_t_3 = (__pyx_t_14) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_14, __pyx_t_2) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, __pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 320, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dc_double</span>(__pyx_t_3, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 320, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_probs = __pyx_t_15;
  __pyx_t_15.memview = NULL;
  __pyx_t_15.data = NULL;
</pre><pre class="cython line score-37" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">321</span>:         double[:,::1] container = np.zeros((keys.size(), model.agentStates.shape[0]))</pre>
<pre class='cython code score-37 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 321, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 321, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_FromSize_t</span>(__pyx_v_keys.size());<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 321, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_14 = <span class='py_c_api'>PyInt_FromSsize_t</span>((__pyx_v_model-&gt;agentStates.shape[0]));<span class='error_goto'> if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 321, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
  __pyx_t_16 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 321, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_16, 0, __pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_14);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_16, 1, __pyx_t_14);
  __pyx_t_1 = 0;
  __pyx_t_14 = 0;
  __pyx_t_14 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_14 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_14)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_14);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
    }
  }
  __pyx_t_3 = (__pyx_t_14) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_14, __pyx_t_16) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_t_16);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
  if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 321, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_d_dc_double</span>(__pyx_t_3, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_17.memview)) __PYX_ERR(0, 321, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_container = __pyx_t_17;
  __pyx_t_17.memview = NULL;
  __pyx_t_17.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">322</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">323</span>:     # determine conditional probabilities</pre>
<pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">324</span>:     pbar = tqdm(total = keys.size())</pre>
<pre class='cython code score-16 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_tqdm);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 324, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 324, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyInt_FromSize_t</span>(__pyx_v_keys.size());<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 324, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_2, __pyx_n_s_total, __pyx_t_16) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 324, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
  __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_empty_tuple, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 324, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_pbar = __pyx_t_16;
  __pyx_t_16 = 0;
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">325</span>:     for idx in prange(keys.size(), nogil = True, schedule = 'dynamic', num_threads = nThreads):</pre>
<pre class='cython code score-6 '>  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      <span class='pyx_c_api'>__Pyx_FastGIL_Remember</span>();
      #endif
      /*try:*/ {
        __pyx_t_18 = __pyx_v_keys.size();
        if (1 == 0) abort();
        {
            #if ((defined(__APPLE__) || defined(__OSX__)) &amp;&amp; (defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 2 || (__GNUC__ == 2 &amp;&amp; (__GNUC_MINOR__ &gt; 95)))))
                #undef likely
                #undef unlikely
                #define likely(x)   (x)
                #define unlikely(x) (x)
            #endif
            __pyx_t_20 = (__pyx_t_18 - 0 + 1 - 1/abs(1)) / 1;
            if (__pyx_t_20 &gt; 0)
            {
                #ifdef _OPENMP
                #pragma omp parallel
                #endif /* _OPENMP */
                {
                    #ifdef _OPENMP
                    #pragma omp for reduction(-:__pyx_v_HXgivenY) lastprivate(__pyx_v_HXgiveny) firstprivate(__pyx_v_idx) lastprivate(__pyx_v_idx) lastprivate(__pyx_v_tid) schedule(dynamic)        __pyx_t_18 = __pyx_v_keys.size();
        if (1 == 0) abort();
        {
            #if ((defined(__APPLE__) || defined(__OSX__)) &amp;&amp; (defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 2 || (__GNUC__ == 2 &amp;&amp; (__GNUC_MINOR__ &gt; 95)))))
                #undef likely
                #undef unlikely
                #define likely(x)   (x)
                #define unlikely(x) (x)
            #endif
            __pyx_t_20 = (__pyx_t_18 - 0 + 1 - 1/abs(1)) / 1;
            if (__pyx_t_20 &gt; 0)
            {
                #ifdef _OPENMP
                #pragma omp parallel
                #endif /* _OPENMP */
                {
                    #ifdef _OPENMP
                    #pragma omp for reduction(-:__pyx_v_HXgivenY) lastprivate(__pyx_v_HXgiveny) firstprivate(__pyx_v_idx) lastprivate(__pyx_v_idx) lastprivate(__pyx_v_tid) schedule(dynamic) num_threads(__pyx_v_nThreads)
                    #endif /* _OPENMP */
                    for (__pyx_t_19 = 0; __pyx_t_19 &lt; __pyx_t_20; __pyx_t_19++){
                        {
                            __pyx_v_idx = (long)(0 + 1 * __pyx_t_19);
                            /* Initialize private variables to invalid values */
                            __pyx_v_HXgiveny = ((double)__PYX_NAN());
                            __pyx_v_tid = ((int)0xbad0bad0);
/* … */
      /*finally:*/ {
        /*normal exit:*/{
          #ifdef WITH_THREAD
          <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L11;
        }
        __pyx_L10_error: {
          #ifdef WITH_THREAD
          <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L1_error;
        }
        __pyx_L11:;
      }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">326</span>:         tid = threadid()</pre>
<pre class='cython code score-0 '>                            #ifdef _OPENMP
                            __pyx_t_4 = omp_get_thread_num();
                            #else
                            __pyx_t_4 = 0;
                            #endif
                            __pyx_v_tid = __pyx_t_4;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">327</span>:         container[idx] = _monteCarloFixedNeighbours((&lt;Model&gt;models_[tid].ptr), \</pre>
<pre class='cython code score-0 '>                            __pyx_t_21 = (__pyx_v_models_[__pyx_v_tid]).ptr;
/* … */
                            __pyx_t_22.__pyx_n = 2;
                            __pyx_t_22.nSamples = __pyx_v_nSamples;
                            __pyx_t_22.distSamples = __pyx_v_distSamples;
                            __pyx_t_15 = __pyx_f_7Toolbox_8infcyIDL__monteCarloFixedNeighbours(((struct __pyx_obj_6Models_6models_Model *)__pyx_t_21), (__pyx_v_keys[__pyx_v_idx]), __pyx_v_node, __pyx_v_neighbours, &amp;__pyx_t_22);<span class='error_goto'> if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 327, __pyx_L14_error)</span>
/* … */
                            __pyx_t_23.data = __pyx_v_container.data;
                            __pyx_t_23.memview = __pyx_v_container.memview;
                            __PYX_INC_MEMVIEW(&amp;__pyx_t_23, 0);
                            {
    Py_ssize_t __pyx_tmp_idx = __pyx_v_idx;
    Py_ssize_t __pyx_tmp_stride = __pyx_v_container.strides[0];
        if ((0)) <span class='error_goto'>__PYX_ERR(0, 327, __pyx_L14_error)</span>
        __pyx_t_23.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_23.shape[0] = __pyx_v_container.shape[1];
__pyx_t_23.strides[0] = __pyx_v_container.strides[1];
    __pyx_t_23.suboffsets[0] = -1;

if (unlikely(__pyx_memoryview_copy_contents(__pyx_t_15, __pyx_t_23, 1, 1, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 327, __pyx_L14_error)</span>
                            __PYX_XDEC_MEMVIEW(&amp;__pyx_t_23, 0);
                            __pyx_t_23.memview = NULL;
                            __pyx_t_23.data = NULL;
                            __PYX_XDEC_MEMVIEW(&amp;__pyx_t_15, 0);
                            __pyx_t_15.memview = NULL;
                            __pyx_t_15.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">328</span>:                         keys[idx], node, neighbours, nSamples, distSamples)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">329</span>:         HXgiveny = entropyFromProbs(container[idx])</pre>
<pre class='cython code score-0 '>                            __pyx_t_15.data = __pyx_v_container.data;
                            __pyx_t_15.memview = __pyx_v_container.memview;
                            __PYX_INC_MEMVIEW(&amp;__pyx_t_15, 0);
                            {
    Py_ssize_t __pyx_tmp_idx = __pyx_v_idx;
    Py_ssize_t __pyx_tmp_stride = __pyx_v_container.strides[0];
        if ((0)) <span class='error_goto'>__PYX_ERR(0, 329, __pyx_L14_error)</span>
        __pyx_t_15.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_15.shape[0] = __pyx_v_container.shape[1];
__pyx_t_15.strides[0] = __pyx_v_container.strides[1];
    __pyx_t_15.suboffsets[0] = -1;

__pyx_v_HXgiveny = __pyx_f_7Toolbox_8infcyIDL_entropyFromProbs(__pyx_t_15);
                            __PYX_XDEC_MEMVIEW(&amp;__pyx_t_15, 0);
                            __pyx_t_15.memview = NULL;
                            __pyx_t_15.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">330</span>:         HXgivenY -= probs[idx] * HXgiveny</pre>
<pre class='cython code score-0 '>                            __pyx_t_24 = __pyx_v_idx;
                            __pyx_v_HXgivenY = (__pyx_v_HXgivenY - ((*((double *) ( /* dim=0 */ ((char *) (((double *) __pyx_v_probs.data) + __pyx_t_24)) ))) * __pyx_v_HXgiveny));
</pre><pre class="cython line score-0">&#xA0;<span class="">331</span>: </pre>
<pre class="cython line score-42" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">332</span>:         with gil: pbar.update(1)</pre>
<pre class='cython code score-42 '>                            {
                                #ifdef WITH_THREAD
                                PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                                #endif
                                /*try:*/ {
                                  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_pbar, __pyx_n_s_update);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 332, __pyx_L19_error)</span>
                                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
                                  __pyx_t_3 = NULL;
                                  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
                                    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
                                    if (likely(__pyx_t_3)) {
                                      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
                                      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
                                      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
                                      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
                                    }
                                  }
                                  __pyx_t_16 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_int_1) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_int_1);
                                  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
                                  if (unlikely(!__pyx_t_16)) <span class='error_goto'>__PYX_ERR(0, 332, __pyx_L19_error)</span>
                                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
                                  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
                                  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
                                }
                                /*finally:*/ {
                                  /*normal exit:*/{
                                    #ifdef WITH_THREAD
                                    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                                    #endif
                                    goto __pyx_L20;
                                  }
                                  __pyx_L19_error: {
                                    #ifdef WITH_THREAD
                                    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                                    #endif
                                    goto __pyx_L14_error;
                                  }
                                  __pyx_L20:;
                                }
                            }
                            goto __pyx_L22;
                            __pyx_L14_error:;
                            {
                                #ifdef WITH_THREAD
                                PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                                #endif
                                #ifdef _OPENMP
                                #pragma omp flush(__pyx_parallel_exc_type)
                                #endif /* _OPENMP */
                                if (!__pyx_parallel_exc_type) {
                                  <span class='pyx_c_api'>__Pyx_ErrFetchWithState</span>(&amp;__pyx_parallel_exc_type, &amp;__pyx_parallel_exc_value, &amp;__pyx_parallel_exc_tb);
                                  __pyx_parallel_filename = __pyx_filename; __pyx_parallel_lineno = __pyx_lineno; __pyx_parallel_clineno = __pyx_clineno;
                                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_parallel_exc_type);
                                }
                                #ifdef WITH_THREAD
                                <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                                #endif
                            }
                            __pyx_parallel_why = 4;
                            goto __pyx_L21;
                            __pyx_L21:;
                            #ifdef _OPENMP
                            #pragma omp critical(__pyx_parallel_lastprivates2)
                            #endif /* _OPENMP */
                            {
                                __pyx_parallel_temp0 = __pyx_v_HXgivenY;
                                __pyx_parallel_temp1 = __pyx_v_HXgiveny;
                                __pyx_parallel_temp2 = __pyx_v_idx;
                                __pyx_parallel_temp3 = __pyx_v_tid;
                            }
                            __pyx_L22:;
                            #ifdef _OPENMP
                            #pragma omp flush(__pyx_parallel_why)
                            #endif /* _OPENMP */
                        }
                    }
                    #ifdef _OPENMP
                    Py_END_ALLOW_THREADS
                    #else
{
#ifdef WITH_THREAD
                    PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                    #endif
                    #endif /* _OPENMP */
                    /* Clean up any temporaries */
                    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_15, 0);
                    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_16);
                    __pyx_t_16 = NULL;
                    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
                    __pyx_t_2 = NULL;
                    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_23, 0);
                    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
                    __pyx_t_3 = NULL;
                    #ifdef WITH_THREAD
                    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                    #endif
                    #ifndef _OPENMP
}
#endif /* _OPENMP */
                }
            }
            if (__pyx_parallel_exc_type) {
              /* This may have been overridden by a continue, break or return in another thread. Prefer the error. */
              __pyx_parallel_why = 4;
            }
            if (__pyx_parallel_why) {
              __pyx_v_HXgivenY = __pyx_parallel_temp0;
              __pyx_v_HXgiveny = __pyx_parallel_temp1;
              __pyx_v_idx = __pyx_parallel_temp2;
              __pyx_v_tid = __pyx_parallel_temp3;
              switch (__pyx_parallel_why) {
                    case 4:
                {
                    #ifdef WITH_THREAD
                    PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                    #endif
                    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_parallel_exc_type);
                    <span class='pyx_c_api'>__Pyx_ErrRestoreWithState</span>(__pyx_parallel_exc_type, __pyx_parallel_exc_value, __pyx_parallel_exc_tb);
                    __pyx_filename = __pyx_parallel_filename; __pyx_lineno = __pyx_parallel_lineno; __pyx_clineno = __pyx_parallel_clineno;
                    #ifdef WITH_THREAD
                    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                    #endif
                }
                goto __pyx_L10_error;
              }
            }
        }
        #if ((defined(__APPLE__) || defined(__OSX__)) &amp;&amp; (defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 2 || (__GNUC__ == 2 &amp;&amp; (__GNUC_MINOR__ &gt; 95)))))
            #undef likely
            #undef unlikely
            #define likely(x)   __builtin_expect(!!(x), 1)
            #define unlikely(x) __builtin_expect(!!(x), 0)
        #endif
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">333</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">334</span>:     # compute MI based on conditional probabilities</pre>
<pre class="cython line score-95" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">335</span>:     pX = np.sum(np.multiply(probs.base, container.base.transpose()), axis=1)</pre>
<pre class='cython code score-95 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_16, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 335, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_16, __pyx_n_s_sum);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 335, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 335, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_multiply);<span class='error_goto'> if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 335, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_probs, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 335, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_base);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 335, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_25 = __pyx_memoryview_fromslice(__pyx_v_container, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_25)) __PYX_ERR(0, 335, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_25);
  __pyx_t_26 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_25, __pyx_n_s_base);<span class='error_goto'> if (unlikely(!__pyx_t_26)) __PYX_ERR(0, 335, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_26);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_25); __pyx_t_25 = 0;
  __pyx_t_25 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_26, __pyx_n_s_transpose);<span class='error_goto'> if (unlikely(!__pyx_t_25)) __PYX_ERR(0, 335, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_25);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_26); __pyx_t_26 = 0;
  __pyx_t_26 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_25))) {
    __pyx_t_26 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_25);
    if (likely(__pyx_t_26)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_25);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_26);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_25, function);
    }
  }
  __pyx_t_3 = (__pyx_t_26) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_25, __pyx_t_26) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_25);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_26); __pyx_t_26 = 0;
  if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 335, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_25); __pyx_t_25 = 0;
  __pyx_t_25 = NULL;
  __pyx_t_4 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_14))) {
    __pyx_t_25 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_14);
    if (likely(__pyx_t_25)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_14);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_25);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_14, function);
      __pyx_t_4 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_14)) {
    PyObject *__pyx_temp[3] = {__pyx_t_25, __pyx_t_1, __pyx_t_3};
    __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_14, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 335, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_25); __pyx_t_25 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_14)) {
    PyObject *__pyx_temp[3] = {__pyx_t_25, __pyx_t_1, __pyx_t_3};
    __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_14, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 335, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_25); __pyx_t_25 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  } else
  #endif
  {
    __pyx_t_26 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_26)) __PYX_ERR(0, 335, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_26);
    if (__pyx_t_25) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_25); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_26, 0, __pyx_t_25); __pyx_t_25 = NULL;
    }
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_26, 0+__pyx_t_4, __pyx_t_1);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_26, 1+__pyx_t_4, __pyx_t_3);
    __pyx_t_1 = 0;
    __pyx_t_3 = 0;
    __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_14, __pyx_t_26, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 335, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_26); __pyx_t_26 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
  __pyx_t_14 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 335, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_16);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 0, __pyx_t_16);
  __pyx_t_16 = 0;
  __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 335, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_16, __pyx_n_s_axis, __pyx_int_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 335, __pyx_L1_error)</span>
  __pyx_t_26 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_14, __pyx_t_16);<span class='error_goto'> if (unlikely(!__pyx_t_26)) __PYX_ERR(0, 335, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_26);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
  __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dc_double</span>(__pyx_t_26, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 335, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_26); __pyx_t_26 = 0;
  __pyx_v_pX = __pyx_t_15;
  __pyx_t_15.memview = NULL;
  __pyx_t_15.data = NULL;
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">336</span>:     print(pX.base)</pre>
<pre class='cython code score-7 '>  __pyx_t_26 = __pyx_memoryview_fromslice(__pyx_v_pX, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_26)) __PYX_ERR(0, 336, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_26);
  __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_26, __pyx_n_s_base);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 336, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_26); __pyx_t_26 = 0;
  __pyx_t_26 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_builtin_print, __pyx_t_16);<span class='error_goto'> if (unlikely(!__pyx_t_26)) __PYX_ERR(0, 336, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_26);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_26); __pyx_t_26 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">337</span>:     MI = HXgivenY + entropyFromProbs(pX)</pre>
<pre class='cython code score-0 '>  __pyx_v_MI = (__pyx_v_HXgivenY + __pyx_f_7Toolbox_8infcyIDL_entropyFromProbs(__pyx_v_pX));
</pre><pre class="cython line score-0">&#xA0;<span class="">338</span>: </pre>
<pre class="cython line score-15" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">339</span>:     print(f'MI= {MI}')</pre>
<pre class='cython code score-15 '>  __pyx_t_26 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_MI);<span class='error_goto'> if (unlikely(!__pyx_t_26)) __PYX_ERR(0, 339, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_26);
  __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyObject_FormatSimple</span>(__pyx_t_26, __pyx_empty_unicode);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 339, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_26); __pyx_t_26 = 0;
  __pyx_t_26 = <span class='pyx_c_api'>__Pyx_PyUnicode_Concat</span>(__pyx_kp_u_MI, __pyx_t_16);<span class='error_goto'> if (unlikely(!__pyx_t_26)) __PYX_ERR(0, 339, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_26);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
  __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_builtin_print, __pyx_t_26);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 339, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_26); __pyx_t_26 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">340</span>: </pre>
<pre class="cython line score-18" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">341</span>:     return snapshotsDict, container.base, MI</pre>
<pre class='cython code score-18 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_16 = __pyx_memoryview_fromslice(__pyx_v_container, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 341, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
  __pyx_t_26 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_16, __pyx_n_s_base);<span class='error_goto'> if (unlikely(!__pyx_t_26)) __PYX_ERR(0, 341, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_26);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
  __pyx_t_16 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_MI);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 341, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
  __pyx_t_14 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 341, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_snapshotsDict);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_snapshotsDict);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 0, __pyx_v_snapshotsDict);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_26);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 1, __pyx_t_26);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_16);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 2, __pyx_t_16);
  __pyx_t_26 = 0;
  __pyx_t_16 = 0;
  __pyx_r = ((PyObject*)__pyx_t_14);
  __pyx_t_14 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">342</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">343</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">344</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">345</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">346</span>: @cython.wraparound(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">347</span>: @cython.nonecheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">348</span>: @cython.cdivision(True)</pre>
<pre class="cython line score-0">&#xA0;<span class="">349</span>: @cython.initializedcheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">350</span>: @cython.overflowcheck(False)</pre>
<pre class="cython line score-91" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">351</span>: cpdef long[:,::1] equilibriumSampling(Model model, long repeats, long burninSamples, long nSamples, long distSamples):</pre>
<pre class='cython code score-91 '>static PyObject *__pyx_pw_7Toolbox_8infcyIDL_11equilibriumSampling(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static __Pyx_memviewslice __pyx_f_7Toolbox_8infcyIDL_equilibriumSampling(struct __pyx_obj_6Models_6models_Model *__pyx_v_model, long __pyx_v_repeats, long __pyx_v_burninSamples, long __pyx_v_nSamples, long __pyx_v_distSamples, CYTHON_UNUSED int __pyx_skip_dispatch) {
  std::vector&lt;PyObjectHolder&gt;  __pyx_v_models_;
  struct __pyx_obj_6Models_6models_Model *__pyx_v_tmp = 0;
  long __pyx_v_start;
  long __pyx_v_sample;
  long __pyx_v_rep;
  int __pyx_v_tid;
  int __pyx_v_nThreads;
  __Pyx_memviewslice __pyx_v_snapshots = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_v_pbar = NULL;
  __Pyx_memviewslice __pyx_r = { 0, 0, { 0 }, { 0 }, { 0 } };
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("equilibriumSampling", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_7, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_t_14));
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_15, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_19, 1);
  __pyx_r.data = NULL;
  __pyx_r.memview = NULL;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.equilibriumSampling", __pyx_clineno, __pyx_lineno, __pyx_filename);
  goto __pyx_L2;
  __pyx_L0:;
  if (unlikely(!__pyx_r.memview)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "Memoryview return value is not initialized");
  }
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_tmp);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_snapshots, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_pbar);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_7Toolbox_8infcyIDL_11equilibriumSampling(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_7Toolbox_8infcyIDL_11equilibriumSampling(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_6Models_6models_Model *__pyx_v_model = 0;
  long __pyx_v_repeats;
  long __pyx_v_burninSamples;
  long __pyx_v_nSamples;
  long __pyx_v_distSamples;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("equilibriumSampling (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_model,&amp;__pyx_n_s_repeats,&amp;__pyx_n_s_burninSamples,&amp;__pyx_n_s_nSamples,&amp;__pyx_n_s_distSamples,0};
    PyObject* values[5] = {0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_model)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_repeats)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("equilibriumSampling", 1, 5, 5, 1); <span class='error_goto'>__PYX_ERR(0, 351, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_burninSamples)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("equilibriumSampling", 1, 5, 5, 2); <span class='error_goto'>__PYX_ERR(0, 351, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_nSamples)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("equilibriumSampling", 1, 5, 5, 3); <span class='error_goto'>__PYX_ERR(0, 351, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_distSamples)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("equilibriumSampling", 1, 5, 5, 4); <span class='error_goto'>__PYX_ERR(0, 351, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "equilibriumSampling") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 351, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 5) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
    }
    __pyx_v_model = ((struct __pyx_obj_6Models_6models_Model *)values[0]);
    __pyx_v_repeats = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[1]); if (unlikely((__pyx_v_repeats == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 351, __pyx_L3_error)</span>
    __pyx_v_burninSamples = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[2]); if (unlikely((__pyx_v_burninSamples == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 351, __pyx_L3_error)</span>
    __pyx_v_nSamples = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[3]); if (unlikely((__pyx_v_nSamples == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 351, __pyx_L3_error)</span>
    __pyx_v_distSamples = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[4]); if (unlikely((__pyx_v_distSamples == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 351, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("equilibriumSampling", 1, 5, 5, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 351, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.equilibriumSampling", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_model), __pyx_ptype_6Models_6models_Model, 1, "model", 0))) <span class='error_goto'>__PYX_ERR(0, 351, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_7Toolbox_8infcyIDL_10equilibriumSampling(__pyx_self, __pyx_v_model, __pyx_v_repeats, __pyx_v_burninSamples, __pyx_v_nSamples, __pyx_v_distSamples);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_7Toolbox_8infcyIDL_10equilibriumSampling(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6Models_6models_Model *__pyx_v_model, long __pyx_v_repeats, long __pyx_v_burninSamples, long __pyx_v_nSamples, long __pyx_v_distSamples) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("equilibriumSampling", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = __pyx_f_7Toolbox_8infcyIDL_equilibriumSampling(__pyx_v_model, __pyx_v_repeats, __pyx_v_burninSamples, __pyx_v_nSamples, __pyx_v_distSamples, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 351, __pyx_L1_error)</span>
  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_t_1, 2, (PyObject *(*)(char *)) __pyx_memview_get_long, (int (*)(char *, PyObject *)) __pyx_memview_set_long, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 351, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 1);
  __pyx_t_1.memview = NULL;
  __pyx_t_1.data = NULL;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.equilibriumSampling", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">352</span>:     cdef:</pre>
<pre class="cython line score-0">&#xA0;<span class="">353</span>:         vector[PyObjectHolder] models_</pre>
<pre class="cython line score-0">&#xA0;<span class="">354</span>:         Model tmp</pre>
<pre class="cython line score-0">&#xA0;<span class="">355</span>:         long start, sample, idx, step, rep</pre>
<pre class="cython line score-29" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">356</span>:         int tid, nThreads = mp.cpu_count()</pre>
<pre class='cython code score-29 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_mp);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 356, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_cpu_count);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 356, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_2) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_2) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 356, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_1); if (unlikely((__pyx_t_4 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 356, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_nThreads = __pyx_t_4;
</pre><pre class="cython line score-57" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">357</span>:         long[:,::1] snapshots = np.zeros((repeats * nSamples, model._nNodes), int) #np.intc)</pre>
<pre class='cython code score-57 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 357, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 357, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((__pyx_v_repeats * __pyx_v_nSamples));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 357, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_model-&gt;_nNodes);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 357, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 357, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 1, __pyx_t_5);
  __pyx_t_3 = 0;
  __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  __pyx_t_4 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_5)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
      __pyx_t_4 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_6, ((PyObject *)(&amp;PyInt_Type))};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 357, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_6, ((PyObject *)(&amp;PyInt_Type))};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 357, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  } else
  #endif
  {
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 357, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    if (__pyx_t_5) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_5); __pyx_t_5 = NULL;
    }
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0+__pyx_t_4, __pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)(&amp;PyInt_Type)));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)(&amp;PyInt_Type)));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1+__pyx_t_4, ((PyObject *)(&amp;PyInt_Type)));
    __pyx_t_6 = 0;
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_3, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 357, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_d_dc_long</span>(__pyx_t_1, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 357, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_snapshots = __pyx_t_7;
  __pyx_t_7.memview = NULL;
  __pyx_t_7.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">358</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">359</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">360</span>:     for tid in range(nThreads):</pre>
<pre class='cython code score-0 '>  __pyx_t_4 = __pyx_v_nThreads;
  __pyx_t_8 = __pyx_t_4;
  for (__pyx_t_9 = 0; __pyx_t_9 &lt; __pyx_t_8; __pyx_t_9+=1) {
    __pyx_v_tid = __pyx_t_9;
</pre><pre class="cython line score-22" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">361</span>:         tmp = copy.deepcopy(model)</pre>
<pre class='cython code score-22 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_copy);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 361, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_deepcopy);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 361, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
      __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
      if (likely(__pyx_t_2)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
      }
    }
    __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, ((PyObject *)__pyx_v_model)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, ((PyObject *)__pyx_v_model));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 361, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_6Models_6models_Model))))) <span class='error_goto'>__PYX_ERR(0, 361, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_tmp, ((struct __pyx_obj_6Models_6models_Model *)__pyx_t_1));
    __pyx_t_1 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">362</span>:         models_.push_back(PyObjectHolder(&lt;PyObject *&gt; tmp))</pre>
<pre class='cython code score-0 '>    try {
      __pyx_v_models_.push_back(PyObjectHolder(((PyObject *)__pyx_v_tmp)));
    } catch(...) {
      __Pyx_CppExn2PyErr();
      <span class='error_goto'>__PYX_ERR(0, 362, __pyx_L1_error)</span>
    }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">363</span>: </pre>
<pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">364</span>:     pbar = tqdm(total = repeats) # init  progbar</pre>
<pre class='cython code score-16 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_tqdm);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 364, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 364, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_repeats);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 364, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_n_s_total, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 364, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_empty_tuple, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 364, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_pbar = __pyx_t_2;
  __pyx_t_2 = 0;
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">365</span>:     for rep in prange(repeats, nogil = True, schedule = 'dynamic', num_threads = nThreads):</pre>
<pre class='cython code score-6 '>  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      <span class='pyx_c_api'>__Pyx_FastGIL_Remember</span>();
      #endif
      /*try:*/ {
        __pyx_t_10 = __pyx_v_repeats;
        if (1 == 0) abort();
        {
            #if ((defined(__APPLE__) || defined(__OSX__)) &amp;&amp; (defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 2 || (__GNUC__ == 2 &amp;&amp; (__GNUC_MINOR__ &gt; 95)))))
                #undef likely
                #undef unlikely
                #define likely(x)   (x)
                #define unlikely(x) (x)
            #endif
            __pyx_t_12 = (__pyx_t_10 - 0 + 1 - 1/abs(1)) / 1;
            if (__pyx_t_12 &gt; 0)
            {
                #ifdef _OPENMP
                #pragma omp parallel
                #endif /* _OPENMP */
                {
                    #ifdef _OPENMP
                    #pragma omp for firstprivate(__pyx_v_rep) lastprivate(__pyx_v_rep) lastprivate(__pyx_v_sample) lastprivate(__pyx_v_start) lastprivate(__pyx_v_tid) schedule(dynamic)        __pyx_t_10 = __pyx_v_repeats;
        if (1 == 0) abort();
        {
            #if ((defined(__APPLE__) || defined(__OSX__)) &amp;&amp; (defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 2 || (__GNUC__ == 2 &amp;&amp; (__GNUC_MINOR__ &gt; 95)))))
                #undef likely
                #undef unlikely
                #define likely(x)   (x)
                #define unlikely(x) (x)
            #endif
            __pyx_t_12 = (__pyx_t_10 - 0 + 1 - 1/abs(1)) / 1;
            if (__pyx_t_12 &gt; 0)
            {
                #ifdef _OPENMP
                #pragma omp parallel
                #endif /* _OPENMP */
                {
                    #ifdef _OPENMP
                    #pragma omp for firstprivate(__pyx_v_rep) lastprivate(__pyx_v_rep) lastprivate(__pyx_v_sample) lastprivate(__pyx_v_start) lastprivate(__pyx_v_tid) schedule(dynamic) num_threads(__pyx_v_nThreads)
                    #endif /* _OPENMP */
                    for (__pyx_t_11 = 0; __pyx_t_11 &lt; __pyx_t_12; __pyx_t_11++){
                        {
                            __pyx_v_rep = (long)(0 + 1 * __pyx_t_11);
                            /* Initialize private variables to invalid values */
                            __pyx_v_sample = ((long)0xbad0bad0);
                            __pyx_v_start = ((long)0xbad0bad0);
                            __pyx_v_tid = ((int)0xbad0bad0);
/* … */
      /*finally:*/ {
        /*normal exit:*/{
          #ifdef WITH_THREAD
          <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L7;
        }
        __pyx_L6_error: {
          #ifdef WITH_THREAD
          <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L1_error;
        }
        __pyx_L7:;
      }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">366</span>:         tid = threadid()</pre>
<pre class='cython code score-0 '>                            #ifdef _OPENMP
                            __pyx_t_4 = omp_get_thread_num();
                            #else
                            __pyx_t_4 = 0;
                            #endif
                            __pyx_v_tid = __pyx_t_4;
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">367</span>:         with gil:</pre>
<pre class='cython code score-6 '>                            {
                                #ifdef WITH_THREAD
                                PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                                #endif
                                /*try:*/ {
/* … */
                                /*finally:*/ {
                                  /*normal exit:*/{
                                    #ifdef WITH_THREAD
                                    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                                    #endif
                                    goto __pyx_L16;
                                  }
                                  __pyx_L15_error: {
                                    #ifdef WITH_THREAD
                                    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                                    #endif
                                    goto __pyx_L10_error;
                                  }
                                  __pyx_L16:;
                                }
                            }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">368</span>:             (&lt;Model&gt;models_[tid].ptr).reset()</pre>
<pre class='cython code score-0 '>                                  __pyx_t_13 = (__pyx_v_models_[__pyx_v_tid]).ptr;
                                  ((struct __pyx_vtabstruct_6Models_6models_Model *)((struct __pyx_obj_6Models_6models_Model *)__pyx_t_13)-&gt;__pyx_vtab)-&gt;reset(((struct __pyx_obj_6Models_6models_Model *)__pyx_t_13), 0);
</pre><pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">369</span>:             (&lt;Model&gt;models_[tid].ptr).seed += rep # enforce different seeds</pre>
<pre class='cython code score-16 '>                                  __pyx_t_13 = (__pyx_v_models_[__pyx_v_tid]).ptr;
                                  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)((struct __pyx_obj_6Models_6models_Model *)__pyx_t_13)));
                                  __pyx_t_14 = ((struct __pyx_obj_6Models_6models_Model *)__pyx_t_13);
                                  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(((PyObject *)__pyx_t_14), __pyx_n_s_seed);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 369, __pyx_L15_error)</span>
                                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
                                  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_rep);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 369, __pyx_L15_error)</span>
                                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
                                  __pyx_t_1 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_2, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 369, __pyx_L15_error)</span>
                                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
                                  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
                                  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
                                  if (<span class='pyx_c_api'>__Pyx_PyObject_SetAttrStr</span>(((PyObject *)__pyx_t_14), __pyx_n_s_seed, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 369, __pyx_L15_error)</span>
                                  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
                                  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_14)); __pyx_t_14 = 0;
                                }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">370</span>:         (&lt;Model&gt;models_[tid].ptr).simulateNSteps(burninSamples)</pre>
<pre class='cython code score-0 '>                            __pyx_t_13 = (__pyx_v_models_[__pyx_v_tid]).ptr;
                            __pyx_t_15 = ((struct __pyx_vtabstruct_6Models_6models_Model *)((struct __pyx_obj_6Models_6models_Model *)__pyx_t_13)-&gt;__pyx_vtab)-&gt;simulateNSteps(((struct __pyx_obj_6Models_6models_Model *)__pyx_t_13), __pyx_v_burninSamples);<span class='error_goto'> if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 370, __pyx_L10_error)</span>
                            __PYX_XDEC_MEMVIEW(&amp;__pyx_t_15, 0);
                            __pyx_t_15.memview = NULL;
                            __pyx_t_15.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">371</span>:         start = rep * nSamples</pre>
<pre class='cython code score-0 '>                            __pyx_v_start = (__pyx_v_rep * __pyx_v_nSamples);
</pre><pre class="cython line score-0">&#xA0;<span class="">372</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">373</span>:         for sample in range(nSamples):</pre>
<pre class='cython code score-0 '>                            __pyx_t_16 = __pyx_v_nSamples;
                            __pyx_t_17 = __pyx_t_16;
                            for (__pyx_t_18 = 0; __pyx_t_18 &lt; __pyx_t_17; __pyx_t_18+=1) {
                              __pyx_v_sample = __pyx_t_18;
</pre><pre class="cython line score-0">&#xA0;<span class="">374</span>:             # raw system states are stored, because for large systems encoding of snapshots does not work (overflow)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">375</span>:             snapshots[start + sample] = (&lt;Model&gt;models_[tid].ptr).simulateNSteps(distSamples)</pre>
<pre class='cython code score-0 '>                              __pyx_t_13 = (__pyx_v_models_[__pyx_v_tid]).ptr;
                              __pyx_t_15 = ((struct __pyx_vtabstruct_6Models_6models_Model *)((struct __pyx_obj_6Models_6models_Model *)__pyx_t_13)-&gt;__pyx_vtab)-&gt;simulateNSteps(((struct __pyx_obj_6Models_6models_Model *)__pyx_t_13), __pyx_v_distSamples);<span class='error_goto'> if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 375, __pyx_L10_error)</span>
                              __pyx_t_19.data = __pyx_v_snapshots.data;
                              __pyx_t_19.memview = __pyx_v_snapshots.memview;
                              __PYX_INC_MEMVIEW(&amp;__pyx_t_19, 0);
                              {
    Py_ssize_t __pyx_tmp_idx = (__pyx_v_start + __pyx_v_sample);
    Py_ssize_t __pyx_tmp_stride = __pyx_v_snapshots.strides[0];
        if ((0)) <span class='error_goto'>__PYX_ERR(0, 375, __pyx_L10_error)</span>
        __pyx_t_19.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_19.shape[0] = __pyx_v_snapshots.shape[1];
__pyx_t_19.strides[0] = __pyx_v_snapshots.strides[1];
    __pyx_t_19.suboffsets[0] = -1;

if (unlikely(__pyx_memoryview_copy_contents(__pyx_t_15, __pyx_t_19, 1, 1, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 375, __pyx_L10_error)</span>
                              __PYX_XDEC_MEMVIEW(&amp;__pyx_t_19, 0);
                              __pyx_t_19.memview = NULL;
                              __pyx_t_19.data = NULL;
                              __PYX_XDEC_MEMVIEW(&amp;__pyx_t_15, 0);
                              __pyx_t_15.memview = NULL;
                              __pyx_t_15.data = NULL;
                            }
</pre><pre class="cython line score-0">&#xA0;<span class="">376</span>: </pre>
<pre class="cython line score-26" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">377</span>:         with gil:</pre>
<pre class='cython code score-26 '>                            {
                                #ifdef WITH_THREAD
                                PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                                #endif
                                /*try:*/ {
/* … */
                                /*finally:*/ {
                                  /*normal exit:*/{
                                    #ifdef WITH_THREAD
                                    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                                    #endif
                                    goto __pyx_L23;
                                  }
                                  __pyx_L22_error: {
                                    #ifdef WITH_THREAD
                                    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                                    #endif
                                    goto __pyx_L10_error;
                                  }
                                  __pyx_L23:;
                                }
                            }
                            goto __pyx_L25;
                            __pyx_L10_error:;
                            {
                                #ifdef WITH_THREAD
                                PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                                #endif
                                #ifdef _OPENMP
                                #pragma omp flush(__pyx_parallel_exc_type)
                                #endif /* _OPENMP */
                                if (!__pyx_parallel_exc_type) {
                                  <span class='pyx_c_api'>__Pyx_ErrFetchWithState</span>(&amp;__pyx_parallel_exc_type, &amp;__pyx_parallel_exc_value, &amp;__pyx_parallel_exc_tb);
                                  __pyx_parallel_filename = __pyx_filename; __pyx_parallel_lineno = __pyx_lineno; __pyx_parallel_clineno = __pyx_clineno;
                                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_parallel_exc_type);
                                }
                                #ifdef WITH_THREAD
                                <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                                #endif
                            }
                            __pyx_parallel_why = 4;
                            goto __pyx_L24;
                            __pyx_L24:;
                            #ifdef _OPENMP
                            #pragma omp critical(__pyx_parallel_lastprivates3)
                            #endif /* _OPENMP */
                            {
                                __pyx_parallel_temp0 = __pyx_v_rep;
                                __pyx_parallel_temp1 = __pyx_v_sample;
                                __pyx_parallel_temp2 = __pyx_v_start;
                                __pyx_parallel_temp3 = __pyx_v_tid;
                            }
                            __pyx_L25:;
                            #ifdef _OPENMP
                            #pragma omp flush(__pyx_parallel_why)
                            #endif /* _OPENMP */
                        }
                    }
                    #ifdef _OPENMP
                    Py_END_ALLOW_THREADS
                    #else
{
#ifdef WITH_THREAD
                    PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                    #endif
                    #endif /* _OPENMP */
                    /* Clean up any temporaries */
                    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
                    __pyx_t_1 = NULL;
                    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_t_14));
                    __pyx_t_14 = NULL;
                    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_15, 0);
                    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_19, 0);
                    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
                    __pyx_t_2 = NULL;
                    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
                    __pyx_t_3 = NULL;
                    #ifdef WITH_THREAD
                    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                    #endif
                    #ifndef _OPENMP
}
#endif /* _OPENMP */
                }
            }
            if (__pyx_parallel_exc_type) {
              /* This may have been overridden by a continue, break or return in another thread. Prefer the error. */
              __pyx_parallel_why = 4;
            }
            if (__pyx_parallel_why) {
              __pyx_v_rep = __pyx_parallel_temp0;
              __pyx_v_sample = __pyx_parallel_temp1;
              __pyx_v_start = __pyx_parallel_temp2;
              __pyx_v_tid = __pyx_parallel_temp3;
              switch (__pyx_parallel_why) {
                    case 4:
                {
                    #ifdef WITH_THREAD
                    PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                    #endif
                    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_parallel_exc_type);
                    <span class='pyx_c_api'>__Pyx_ErrRestoreWithState</span>(__pyx_parallel_exc_type, __pyx_parallel_exc_value, __pyx_parallel_exc_tb);
                    __pyx_filename = __pyx_parallel_filename; __pyx_lineno = __pyx_parallel_lineno; __pyx_clineno = __pyx_parallel_clineno;
                    #ifdef WITH_THREAD
                    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                    #endif
                }
                goto __pyx_L6_error;
              }
            }
        }
        #if ((defined(__APPLE__) || defined(__OSX__)) &amp;&amp; (defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 2 || (__GNUC__ == 2 &amp;&amp; (__GNUC_MINOR__ &gt; 95)))))
            #undef likely
            #undef unlikely
            #define likely(x)   __builtin_expect(!!(x), 1)
            #define unlikely(x) __builtin_expect(!!(x), 0)
        #endif
      }
</pre><pre class="cython line score-17" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">378</span>:             pbar.update(1)</pre>
<pre class='cython code score-17 '>                                  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_pbar, __pyx_n_s_update);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 378, __pyx_L22_error)</span>
                                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
                                  __pyx_t_2 = NULL;
                                  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
                                    __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
                                    if (likely(__pyx_t_2)) {
                                      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
                                      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
                                      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
                                      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
                                    }
                                  }
                                  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_int_1) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_int_1);
                                  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
                                  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 378, __pyx_L22_error)</span>
                                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
                                  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
                                  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
                                }
</pre><pre class="cython line score-0">&#xA0;<span class="">379</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">380</span>:     return snapshots</pre>
<pre class='cython code score-0 '>  __PYX_INC_MEMVIEW(&amp;__pyx_v_snapshots, 0);
  __pyx_r = __pyx_v_snapshots;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">381</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">382</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">383</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">384</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">385</span>: @cython.wraparound(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">386</span>: @cython.nonecheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">387</span>: @cython.cdivision(True)</pre>
<pre class="cython line score-0">&#xA0;<span class="">388</span>: @cython.initializedcheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">389</span>: @cython.overflowcheck(False)</pre>
<pre class="cython line score-116" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">390</span>: cpdef long[:,::1] equilibriumSamplingMagThreshold(Model model, long repeats, \</pre>
<pre class='cython code score-116 '>static PyObject *__pyx_pw_7Toolbox_8infcyIDL_13equilibriumSamplingMagThreshold(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static __Pyx_memviewslice __pyx_f_7Toolbox_8infcyIDL_equilibriumSamplingMagThreshold(struct __pyx_obj_6Models_6models_Model *__pyx_v_model, long __pyx_v_repeats, long __pyx_v_burninSamples, long __pyx_v_nSamples, long __pyx_v_distSamples, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_7Toolbox_8infcyIDL_equilibriumSamplingMagThreshold *__pyx_optional_args) {
  int __pyx_v_switch = ((int)1);
  double __pyx_v_threshold = ((double)0.05);
  std::vector&lt;PyObjectHolder&gt;  __pyx_v_models_;
  struct __pyx_obj_6Models_6models_Model *__pyx_v_tmp = 0;
  long __pyx_v_start;
  long __pyx_v_sample;
  long __pyx_v_rep;
  long __pyx_v_nNodes;
  int __pyx_v_tid;
  int __pyx_v_nThreads;
  double __pyx_v_mu;
  __Pyx_memviewslice __pyx_v_snapshots = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_v_pbar = NULL;
  __Pyx_memviewslice __pyx_r = { 0, 0, { 0 }, { 0 }, { 0 } };
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("equilibriumSamplingMagThreshold", 0);
  if (__pyx_optional_args) {
    if (__pyx_optional_args-&gt;__pyx_n &gt; 0) {
      __pyx_v_switch = __pyx_optional_args-&gt;__pyx_switch;
      if (__pyx_optional_args-&gt;__pyx_n &gt; 1) {
        __pyx_v_threshold = __pyx_optional_args-&gt;threshold;
      }
    }
  }
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_7, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_t_14));
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_15, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_23, 1);
  __pyx_r.data = NULL;
  __pyx_r.memview = NULL;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.equilibriumSamplingMagThreshold", __pyx_clineno, __pyx_lineno, __pyx_filename);
  goto __pyx_L2;
  __pyx_L0:;
  if (unlikely(!__pyx_r.memview)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "Memoryview return value is not initialized");
  }
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_tmp);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_snapshots, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_pbar);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_7Toolbox_8infcyIDL_13equilibriumSamplingMagThreshold(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_7Toolbox_8infcyIDL_13equilibriumSamplingMagThreshold(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_6Models_6models_Model *__pyx_v_model = 0;
  long __pyx_v_repeats;
  long __pyx_v_burninSamples;
  long __pyx_v_nSamples;
  long __pyx_v_distSamples;
  int __pyx_v_switch;
  double __pyx_v_threshold;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("equilibriumSamplingMagThreshold (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_model,&amp;__pyx_n_s_repeats,&amp;__pyx_n_s_burninSamples,&amp;__pyx_n_s_nSamples,&amp;__pyx_n_s_distSamples,&amp;__pyx_n_s_switch,&amp;__pyx_n_s_threshold,0};
    PyObject* values[7] = {0,0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_model)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_repeats)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("equilibriumSamplingMagThreshold", 0, 5, 7, 1); <span class='error_goto'>__PYX_ERR(0, 390, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_burninSamples)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("equilibriumSamplingMagThreshold", 0, 5, 7, 2); <span class='error_goto'>__PYX_ERR(0, 390, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_nSamples)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("equilibriumSamplingMagThreshold", 0, 5, 7, 3); <span class='error_goto'>__PYX_ERR(0, 390, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_distSamples)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("equilibriumSamplingMagThreshold", 0, 5, 7, 4); <span class='error_goto'>__PYX_ERR(0, 390, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_switch);
          if (value) { values[5] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_threshold);
          if (value) { values[6] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "equilibriumSamplingMagThreshold") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 390, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_model = ((struct __pyx_obj_6Models_6models_Model *)values[0]);
    __pyx_v_repeats = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[1]); if (unlikely((__pyx_v_repeats == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 390, __pyx_L3_error)</span>
    __pyx_v_burninSamples = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[2]); if (unlikely((__pyx_v_burninSamples == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 391, __pyx_L3_error)</span>
    __pyx_v_nSamples = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[3]); if (unlikely((__pyx_v_nSamples == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 391, __pyx_L3_error)</span>
    __pyx_v_distSamples = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[4]); if (unlikely((__pyx_v_distSamples == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 391, __pyx_L3_error)</span>
    if (values[5]) {
      __pyx_v_switch = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[5]); if (unlikely((__pyx_v_switch == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
    } else {
      __pyx_v_switch = ((int)1);
    }
    if (values[6]) {
      __pyx_v_threshold = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[6]); if (unlikely((__pyx_v_threshold == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
    } else {
      __pyx_v_threshold = ((double)0.05);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("equilibriumSamplingMagThreshold", 0, 5, 7, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 390, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.equilibriumSamplingMagThreshold", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_model), __pyx_ptype_6Models_6models_Model, 1, "model", 0))) <span class='error_goto'>__PYX_ERR(0, 390, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_7Toolbox_8infcyIDL_12equilibriumSamplingMagThreshold(__pyx_self, __pyx_v_model, __pyx_v_repeats, __pyx_v_burninSamples, __pyx_v_nSamples, __pyx_v_distSamples, __pyx_v_switch, __pyx_v_threshold);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_7Toolbox_8infcyIDL_12equilibriumSamplingMagThreshold(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6Models_6models_Model *__pyx_v_model, long __pyx_v_repeats, long __pyx_v_burninSamples, long __pyx_v_nSamples, long __pyx_v_distSamples, int __pyx_v_switch, double __pyx_v_threshold) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("equilibriumSamplingMagThreshold", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_2.__pyx_n = 2;
  __pyx_t_2.__pyx_switch = __pyx_v_switch;
  __pyx_t_2.threshold = __pyx_v_threshold;
  __pyx_t_1 = __pyx_f_7Toolbox_8infcyIDL_equilibriumSamplingMagThreshold(__pyx_v_model, __pyx_v_repeats, __pyx_v_burninSamples, __pyx_v_nSamples, __pyx_v_distSamples, 0, &amp;__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 390, __pyx_L1_error)</span>
  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_t_1, 2, (PyObject *(*)(char *)) __pyx_memview_get_long, (int (*)(char *, PyObject *)) __pyx_memview_set_long, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 390, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 1);
  __pyx_t_1.memview = NULL;
  __pyx_t_1.data = NULL;
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.equilibriumSamplingMagThreshold", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
struct __pyx_opt_args_7Toolbox_8infcyIDL_equilibriumSamplingMagThreshold {
  int __pyx_n;
  int __pyx_switch;
  double threshold;
};
</pre><pre class="cython line score-0">&#xA0;<span class="">391</span>:                       long burninSamples, long nSamples, long distSamples, \</pre>
<pre class="cython line score-0">&#xA0;<span class="">392</span>:                       int switch=1, double threshold=0.05):</pre>
<pre class="cython line score-0">&#xA0;<span class="">393</span>:     cdef:</pre>
<pre class="cython line score-0">&#xA0;<span class="">394</span>:         vector[PyObjectHolder] models_</pre>
<pre class="cython line score-0">&#xA0;<span class="">395</span>:         Model tmp</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">396</span>:         long start, sample = 0, idx, step, rep, nNodes = model._nNodes</pre>
<pre class='cython code score-0 '>  __pyx_v_sample = 0;
  __pyx_t_1 = __pyx_v_model-&gt;_nNodes;
  __pyx_v_nNodes = __pyx_t_1;
</pre><pre class="cython line score-29" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">397</span>:         int tid, nThreads = mp.cpu_count()</pre>
<pre class='cython code score-29 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_mp);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 397, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_cpu_count);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 397, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
    }
  }
  __pyx_t_2 = (__pyx_t_3) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, __pyx_t_3) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 397, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_2); if (unlikely((__pyx_t_1 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 397, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_nThreads = __pyx_t_1;
</pre><pre class="cython line score-0">&#xA0;<span class="">398</span>:         double mu</pre>
<pre class="cython line score-57" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">399</span>:         long[:,::1] snapshots = np.zeros((repeats * nSamples, nNodes), int) #np.intc)</pre>
<pre class='cython code score-57 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 399, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 399, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((__pyx_v_repeats * __pyx_v_nSamples));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 399, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_nNodes);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 399, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 399, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 1, __pyx_t_5);
  __pyx_t_4 = 0;
  __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  __pyx_t_1 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_5)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
      __pyx_t_1 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_3)) {
    PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_6, ((PyObject *)(&amp;PyInt_Type))};
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-__pyx_t_1, 2+__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 399, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_3)) {
    PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_6, ((PyObject *)(&amp;PyInt_Type))};
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-__pyx_t_1, 2+__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 399, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  } else
  #endif
  {
    __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 399, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    if (__pyx_t_5) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_5); __pyx_t_5 = NULL;
    }
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0+__pyx_t_1, __pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)(&amp;PyInt_Type)));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)(&amp;PyInt_Type)));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1+__pyx_t_1, ((PyObject *)(&amp;PyInt_Type)));
    __pyx_t_6 = 0;
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_4, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 399, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_d_dc_long</span>(__pyx_t_2, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 399, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_snapshots = __pyx_t_7;
  __pyx_t_7.memview = NULL;
  __pyx_t_7.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">400</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">401</span>:     for tid in range(nThreads):</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_nThreads;
  __pyx_t_8 = __pyx_t_1;
  for (__pyx_t_9 = 0; __pyx_t_9 &lt; __pyx_t_8; __pyx_t_9+=1) {
    __pyx_v_tid = __pyx_t_9;
</pre><pre class="cython line score-22" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">402</span>:         tmp = copy.deepcopy(model)</pre>
<pre class='cython code score-22 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_copy);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 402, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_deepcopy);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 402, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
      __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
      if (likely(__pyx_t_3)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
      }
    }
    __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_3, ((PyObject *)__pyx_v_model)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, ((PyObject *)__pyx_v_model));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 402, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_6Models_6models_Model))))) <span class='error_goto'>__PYX_ERR(0, 402, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_tmp, ((struct __pyx_obj_6Models_6models_Model *)__pyx_t_2));
    __pyx_t_2 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">403</span>:         models_.push_back(PyObjectHolder(&lt;PyObject *&gt; tmp))</pre>
<pre class='cython code score-0 '>    try {
      __pyx_v_models_.push_back(PyObjectHolder(((PyObject *)__pyx_v_tmp)));
    } catch(...) {
      __Pyx_CppExn2PyErr();
      <span class='error_goto'>__PYX_ERR(0, 403, __pyx_L1_error)</span>
    }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">404</span>: </pre>
<pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">405</span>:     pbar = tqdm(total = repeats) # init  progbar</pre>
<pre class='cython code score-16 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_tqdm);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 405, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 405, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_repeats);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 405, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_total, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 405, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_empty_tuple, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 405, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_pbar = __pyx_t_3;
  __pyx_t_3 = 0;
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">406</span>:     for rep in prange(repeats, nogil = True, schedule = 'dynamic', num_threads = nThreads):</pre>
<pre class='cython code score-6 '>  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      <span class='pyx_c_api'>__Pyx_FastGIL_Remember</span>();
      #endif
      /*try:*/ {
        __pyx_t_10 = __pyx_v_repeats;
        if (1 == 0) abort();
        {
            #if ((defined(__APPLE__) || defined(__OSX__)) &amp;&amp; (defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 2 || (__GNUC__ == 2 &amp;&amp; (__GNUC_MINOR__ &gt; 95)))))
                #undef likely
                #undef unlikely
                #define likely(x)   (x)
                #define unlikely(x) (x)
            #endif
            __pyx_t_12 = (__pyx_t_10 - 0 + 1 - 1/abs(1)) / 1;
            if (__pyx_t_12 &gt; 0)
            {
                #ifdef _OPENMP
                #pragma omp parallel
                #endif /* _OPENMP */
                {
                    #ifdef _OPENMP
                    #pragma omp for lastprivate(__pyx_v_mu) firstprivate(__pyx_v_rep) lastprivate(__pyx_v_rep) lastprivate(__pyx_v_sample) lastprivate(__pyx_v_start) lastprivate(__pyx_v_tid) schedule(dynamic)        __pyx_t_10 = __pyx_v_repeats;
        if (1 == 0) abort();
        {
            #if ((defined(__APPLE__) || defined(__OSX__)) &amp;&amp; (defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 2 || (__GNUC__ == 2 &amp;&amp; (__GNUC_MINOR__ &gt; 95)))))
                #undef likely
                #undef unlikely
                #define likely(x)   (x)
                #define unlikely(x) (x)
            #endif
            __pyx_t_12 = (__pyx_t_10 - 0 + 1 - 1/abs(1)) / 1;
            if (__pyx_t_12 &gt; 0)
            {
                #ifdef _OPENMP
                #pragma omp parallel
                #endif /* _OPENMP */
                {
                    #ifdef _OPENMP
                    #pragma omp for lastprivate(__pyx_v_mu) firstprivate(__pyx_v_rep) lastprivate(__pyx_v_rep) lastprivate(__pyx_v_sample) lastprivate(__pyx_v_start) lastprivate(__pyx_v_tid) schedule(dynamic) num_threads(__pyx_v_nThreads)
                    #endif /* _OPENMP */
                    for (__pyx_t_11 = 0; __pyx_t_11 &lt; __pyx_t_12; __pyx_t_11++){
                        {
                            __pyx_v_rep = (long)(0 + 1 * __pyx_t_11);
                            /* Initialize private variables to invalid values */
                            __pyx_v_mu = ((double)__PYX_NAN());
                            __pyx_v_sample = ((long)0xbad0bad0);
                            __pyx_v_start = ((long)0xbad0bad0);
                            __pyx_v_tid = ((int)0xbad0bad0);
/* … */
      /*finally:*/ {
        /*normal exit:*/{
          #ifdef WITH_THREAD
          <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L7;
        }
        __pyx_L6_error: {
          #ifdef WITH_THREAD
          <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L1_error;
        }
        __pyx_L7:;
      }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">407</span>:         tid = threadid()</pre>
<pre class='cython code score-0 '>                            #ifdef _OPENMP
                            __pyx_t_1 = omp_get_thread_num();
                            #else
                            __pyx_t_1 = 0;
                            #endif
                            __pyx_v_tid = __pyx_t_1;
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">408</span>:         with gil:</pre>
<pre class='cython code score-6 '>                            {
                                #ifdef WITH_THREAD
                                PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                                #endif
                                /*try:*/ {
/* … */
                                /*finally:*/ {
                                  /*normal exit:*/{
                                    #ifdef WITH_THREAD
                                    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                                    #endif
                                    goto __pyx_L16;
                                  }
                                  __pyx_L15_error: {
                                    #ifdef WITH_THREAD
                                    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                                    #endif
                                    goto __pyx_L10_error;
                                  }
                                  __pyx_L16:;
                                }
                            }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">409</span>:             (&lt;Model&gt;models_[tid].ptr).reset()</pre>
<pre class='cython code score-0 '>                                  __pyx_t_13 = (__pyx_v_models_[__pyx_v_tid]).ptr;
                                  ((struct __pyx_vtabstruct_6Models_6models_Model *)((struct __pyx_obj_6Models_6models_Model *)__pyx_t_13)-&gt;__pyx_vtab)-&gt;reset(((struct __pyx_obj_6Models_6models_Model *)__pyx_t_13), 0);
</pre><pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">410</span>:             (&lt;Model&gt;models_[tid].ptr).seed += rep</pre>
<pre class='cython code score-16 '>                                  __pyx_t_13 = (__pyx_v_models_[__pyx_v_tid]).ptr;
                                  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)((struct __pyx_obj_6Models_6models_Model *)__pyx_t_13)));
                                  __pyx_t_14 = ((struct __pyx_obj_6Models_6models_Model *)__pyx_t_13);
                                  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(((PyObject *)__pyx_t_14), __pyx_n_s_seed);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 410, __pyx_L15_error)</span>
                                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
                                  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_rep);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 410, __pyx_L15_error)</span>
                                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
                                  __pyx_t_2 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_3, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 410, __pyx_L15_error)</span>
                                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
                                  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
                                  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
                                  if (<span class='pyx_c_api'>__Pyx_PyObject_SetAttrStr</span>(((PyObject *)__pyx_t_14), __pyx_n_s_seed, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 410, __pyx_L15_error)</span>
                                  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
                                  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_14)); __pyx_t_14 = 0;
                                }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">411</span>:         (&lt;Model&gt;models_[tid].ptr).simulateNSteps(burninSamples)</pre>
<pre class='cython code score-0 '>                            __pyx_t_13 = (__pyx_v_models_[__pyx_v_tid]).ptr;
                            __pyx_t_15 = ((struct __pyx_vtabstruct_6Models_6models_Model *)((struct __pyx_obj_6Models_6models_Model *)__pyx_t_13)-&gt;__pyx_vtab)-&gt;simulateNSteps(((struct __pyx_obj_6Models_6models_Model *)__pyx_t_13), __pyx_v_burninSamples);<span class='error_goto'> if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 411, __pyx_L10_error)</span>
                            __PYX_XDEC_MEMVIEW(&amp;__pyx_t_15, 0);
                            __pyx_t_15.memview = NULL;
                            __pyx_t_15.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">412</span>:         start = rep * nSamples</pre>
<pre class='cython code score-0 '>                            __pyx_v_start = (__pyx_v_rep * __pyx_v_nSamples);
</pre><pre class="cython line score-0">&#xA0;<span class="">413</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">414</span>:         for sample in range(nSamples):</pre>
<pre class='cython code score-0 '>                            __pyx_t_16 = __pyx_v_nSamples;
                            __pyx_t_17 = __pyx_t_16;
                            for (__pyx_t_18 = 0; __pyx_t_18 &lt; __pyx_t_17; __pyx_t_18+=1) {
                              __pyx_v_sample = __pyx_t_18;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">415</span>:             mu = mean((&lt;Model&gt;models_[tid].ptr).simulateNSteps(distSamples), nNodes, abs=1)</pre>
<pre class='cython code score-0 '>                              __pyx_t_13 = (__pyx_v_models_[__pyx_v_tid]).ptr;
                              __pyx_t_15 = ((struct __pyx_vtabstruct_6Models_6models_Model *)((struct __pyx_obj_6Models_6models_Model *)__pyx_t_13)-&gt;__pyx_vtab)-&gt;simulateNSteps(((struct __pyx_obj_6Models_6models_Model *)__pyx_t_13), __pyx_v_distSamples);<span class='error_goto'> if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 415, __pyx_L10_error)</span>
                              __pyx_t_20.__pyx_n = 1;
                              __pyx_t_20.abs = 1;
                              __pyx_t_19 = __pyx_f_7Toolbox_8infcyIDL_mean(__pyx_t_15, __pyx_v_nNodes, &amp;__pyx_t_20); 
                              __PYX_XDEC_MEMVIEW(&amp;__pyx_t_15, 0);
                              __pyx_t_15.memview = NULL;
                              __pyx_t_15.data = NULL;
                              __pyx_v_mu = __pyx_t_19;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">416</span>:             while ((switch and mu &gt;= threshold) and (not switch and mu &lt; threshold)):</pre>
<pre class='cython code score-0 '>                              while (1) {
                                __pyx_t_22 = (__pyx_v_switch != 0);
                                if (__pyx_t_22) {
                                } else {
                                  __pyx_t_21 = __pyx_t_22;
                                  goto __pyx_L21_bool_binop_done;
                                }
                                __pyx_t_22 = ((__pyx_v_mu &gt;= __pyx_v_threshold) != 0);
                                if (__pyx_t_22) {
                                } else {
                                  __pyx_t_21 = __pyx_t_22;
                                  goto __pyx_L21_bool_binop_done;
                                }
                                __pyx_t_22 = ((!(__pyx_v_switch != 0)) != 0);
                                if (__pyx_t_22) {
                                } else {
                                  __pyx_t_21 = __pyx_t_22;
                                  goto __pyx_L21_bool_binop_done;
                                }
                                __pyx_t_22 = ((__pyx_v_mu &lt; __pyx_v_threshold) != 0);
                                __pyx_t_21 = __pyx_t_22;
                                __pyx_L21_bool_binop_done:;
                                if (!__pyx_t_21) break;
</pre><pre class="cython line score-0">&#xA0;<span class="">417</span>:                 # continue simulating until system state reached where intended avg mag level is reached</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">418</span>:                 mu = mean((&lt;Model&gt;models_[tid].ptr).simulateNSteps(1), nNodes, abs=1)</pre>
<pre class='cython code score-0 '>                                __pyx_t_13 = (__pyx_v_models_[__pyx_v_tid]).ptr;
                                __pyx_t_15 = ((struct __pyx_vtabstruct_6Models_6models_Model *)((struct __pyx_obj_6Models_6models_Model *)__pyx_t_13)-&gt;__pyx_vtab)-&gt;simulateNSteps(((struct __pyx_obj_6Models_6models_Model *)__pyx_t_13), 1);<span class='error_goto'> if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 418, __pyx_L10_error)</span>
                                __pyx_t_20.__pyx_n = 1;
                                __pyx_t_20.abs = 1;
                                __pyx_t_19 = __pyx_f_7Toolbox_8infcyIDL_mean(__pyx_t_15, __pyx_v_nNodes, &amp;__pyx_t_20); 
                                __PYX_XDEC_MEMVIEW(&amp;__pyx_t_15, 0);
                                __pyx_t_15.memview = NULL;
                                __pyx_t_15.data = NULL;
                                __pyx_v_mu = __pyx_t_19;
                              }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">419</span>:             snapshots[start + sample] = (&lt;Model&gt;models_[tid].ptr)._states</pre>
<pre class='cython code score-0 '>                              __pyx_t_13 = (__pyx_v_models_[__pyx_v_tid]).ptr;
                              __pyx_t_15 = ((struct __pyx_obj_6Models_6models_Model *)__pyx_t_13)-&gt;_states;
                              __PYX_INC_MEMVIEW(&amp;__pyx_t_15, 0);
                              __pyx_t_23.data = __pyx_v_snapshots.data;
                              __pyx_t_23.memview = __pyx_v_snapshots.memview;
                              __PYX_INC_MEMVIEW(&amp;__pyx_t_23, 0);
                              {
    Py_ssize_t __pyx_tmp_idx = (__pyx_v_start + __pyx_v_sample);
    Py_ssize_t __pyx_tmp_stride = __pyx_v_snapshots.strides[0];
        if ((0)) <span class='error_goto'>__PYX_ERR(0, 419, __pyx_L10_error)</span>
        __pyx_t_23.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_23.shape[0] = __pyx_v_snapshots.shape[1];
__pyx_t_23.strides[0] = __pyx_v_snapshots.strides[1];
    __pyx_t_23.suboffsets[0] = -1;

if (unlikely(__pyx_memoryview_copy_contents(__pyx_t_15, __pyx_t_23, 1, 1, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 419, __pyx_L10_error)</span>
                              __PYX_XDEC_MEMVIEW(&amp;__pyx_t_23, 0);
                              __pyx_t_23.memview = NULL;
                              __pyx_t_23.data = NULL;
                              __PYX_XDEC_MEMVIEW(&amp;__pyx_t_15, 0);
                              __pyx_t_15.memview = NULL;
                              __pyx_t_15.data = NULL;
                            }
</pre><pre class="cython line score-0">&#xA0;<span class="">420</span>: </pre>
<pre class="cython line score-26" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">421</span>:         with gil:</pre>
<pre class='cython code score-26 '>                            {
                                #ifdef WITH_THREAD
                                PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                                #endif
                                /*try:*/ {
/* … */
                                /*finally:*/ {
                                  /*normal exit:*/{
                                    #ifdef WITH_THREAD
                                    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                                    #endif
                                    goto __pyx_L29;
                                  }
                                  __pyx_L28_error: {
                                    #ifdef WITH_THREAD
                                    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                                    #endif
                                    goto __pyx_L10_error;
                                  }
                                  __pyx_L29:;
                                }
                            }
                            goto __pyx_L31;
                            __pyx_L10_error:;
                            {
                                #ifdef WITH_THREAD
                                PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                                #endif
                                #ifdef _OPENMP
                                #pragma omp flush(__pyx_parallel_exc_type)
                                #endif /* _OPENMP */
                                if (!__pyx_parallel_exc_type) {
                                  <span class='pyx_c_api'>__Pyx_ErrFetchWithState</span>(&amp;__pyx_parallel_exc_type, &amp;__pyx_parallel_exc_value, &amp;__pyx_parallel_exc_tb);
                                  __pyx_parallel_filename = __pyx_filename; __pyx_parallel_lineno = __pyx_lineno; __pyx_parallel_clineno = __pyx_clineno;
                                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_parallel_exc_type);
                                }
                                #ifdef WITH_THREAD
                                <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                                #endif
                            }
                            __pyx_parallel_why = 4;
                            goto __pyx_L30;
                            __pyx_L30:;
                            #ifdef _OPENMP
                            #pragma omp critical(__pyx_parallel_lastprivates4)
                            #endif /* _OPENMP */
                            {
                                __pyx_parallel_temp0 = __pyx_v_mu;
                                __pyx_parallel_temp1 = __pyx_v_rep;
                                __pyx_parallel_temp2 = __pyx_v_sample;
                                __pyx_parallel_temp3 = __pyx_v_start;
                                __pyx_parallel_temp4 = __pyx_v_tid;
                            }
                            __pyx_L31:;
                            #ifdef _OPENMP
                            #pragma omp flush(__pyx_parallel_why)
                            #endif /* _OPENMP */
                        }
                    }
                    #ifdef _OPENMP
                    Py_END_ALLOW_THREADS
                    #else
{
#ifdef WITH_THREAD
                    PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                    #endif
                    #endif /* _OPENMP */
                    /* Clean up any temporaries */
                    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_t_14));
                    __pyx_t_14 = NULL;
                    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_15, 0);
                    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
                    __pyx_t_2 = NULL;
                    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_23, 0);
                    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
                    __pyx_t_3 = NULL;
                    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
                    __pyx_t_4 = NULL;
                    #ifdef WITH_THREAD
                    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                    #endif
                    #ifndef _OPENMP
}
#endif /* _OPENMP */
                }
            }
            if (__pyx_parallel_exc_type) {
              /* This may have been overridden by a continue, break or return in another thread. Prefer the error. */
              __pyx_parallel_why = 4;
            }
            if (__pyx_parallel_why) {
              __pyx_v_mu = __pyx_parallel_temp0;
              __pyx_v_rep = __pyx_parallel_temp1;
              __pyx_v_sample = __pyx_parallel_temp2;
              __pyx_v_start = __pyx_parallel_temp3;
              __pyx_v_tid = __pyx_parallel_temp4;
              switch (__pyx_parallel_why) {
                    case 4:
                {
                    #ifdef WITH_THREAD
                    PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                    #endif
                    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_parallel_exc_type);
                    <span class='pyx_c_api'>__Pyx_ErrRestoreWithState</span>(__pyx_parallel_exc_type, __pyx_parallel_exc_value, __pyx_parallel_exc_tb);
                    __pyx_filename = __pyx_parallel_filename; __pyx_lineno = __pyx_parallel_lineno; __pyx_clineno = __pyx_parallel_clineno;
                    #ifdef WITH_THREAD
                    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                    #endif
                }
                goto __pyx_L6_error;
              }
            }
        }
        #if ((defined(__APPLE__) || defined(__OSX__)) &amp;&amp; (defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 2 || (__GNUC__ == 2 &amp;&amp; (__GNUC_MINOR__ &gt; 95)))))
            #undef likely
            #undef unlikely
            #define likely(x)   __builtin_expect(!!(x), 1)
            #define unlikely(x) __builtin_expect(!!(x), 0)
        #endif
      }
</pre><pre class="cython line score-17" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">422</span>:             pbar.update(1)</pre>
<pre class='cython code score-17 '>                                  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_pbar, __pyx_n_s_update);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 422, __pyx_L28_error)</span>
                                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
                                  __pyx_t_3 = NULL;
                                  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
                                    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
                                    if (likely(__pyx_t_3)) {
                                      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
                                      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
                                      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
                                      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
                                    }
                                  }
                                  __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_3, __pyx_int_1) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, __pyx_int_1);
                                  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
                                  if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 422, __pyx_L28_error)</span>
                                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
                                  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
                                  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
                                }
</pre><pre class="cython line score-0">&#xA0;<span class="">423</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">424</span>:     return snapshots</pre>
<pre class='cython code score-0 '>  __PYX_INC_MEMVIEW(&amp;__pyx_v_snapshots, 0);
  __pyx_r = __pyx_v_snapshots;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">425</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">426</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">427</span>: @cython.wraparound(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">428</span>: @cython.nonecheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">429</span>: @cython.cdivision(True)</pre>
<pre class="cython line score-0">&#xA0;<span class="">430</span>: @cython.initializedcheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">431</span>: @cython.overflowcheck(False)</pre>
<pre class="cython line score-25" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">432</span>: cpdef double[::1] binaryEntropies(long[:,::1] snapshots):</pre>
<pre class='cython code score-25 '>static PyObject *__pyx_pw_7Toolbox_8infcyIDL_15binaryEntropies(PyObject *__pyx_self, PyObject *__pyx_arg_snapshots); /*proto*/
static __Pyx_memviewslice __pyx_f_7Toolbox_8infcyIDL_binaryEntropies(__Pyx_memviewslice __pyx_v_snapshots, CYTHON_UNUSED int __pyx_skip_dispatch) {
  PyArrayObject *__pyx_v_tmp = 0;
  PyArrayObject *__pyx_v_H = 0;
  long __pyx_v_length;
  __Pyx_memviewslice __pyx_v_cview_H = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_r = { 0, 0, { 0 }, { 0 }, { 0 } };
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("binaryEntropies", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_10, 1);
  __pyx_r.data = NULL;
  __pyx_r.memview = NULL;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.binaryEntropies", __pyx_clineno, __pyx_lineno, __pyx_filename);
  goto __pyx_L2;
  __pyx_L0:;
  if (unlikely(!__pyx_r.memview)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "Memoryview return value is not initialized");
  }
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_tmp);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_H);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_cview_H, 1);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_7Toolbox_8infcyIDL_15binaryEntropies(PyObject *__pyx_self, PyObject *__pyx_arg_snapshots); /*proto*/
static PyObject *__pyx_pw_7Toolbox_8infcyIDL_15binaryEntropies(PyObject *__pyx_self, PyObject *__pyx_arg_snapshots) {
  __Pyx_memviewslice __pyx_v_snapshots = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("binaryEntropies (wrapper)", 0);
  assert(__pyx_arg_snapshots); {
    __pyx_v_snapshots = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_d_dc_long</span>(__pyx_arg_snapshots, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_snapshots.memview)) __PYX_ERR(0, 432, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.binaryEntropies", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_7Toolbox_8infcyIDL_14binaryEntropies(__pyx_self, __pyx_v_snapshots);

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_7Toolbox_8infcyIDL_14binaryEntropies(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_snapshots) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("binaryEntropies", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = __pyx_f_7Toolbox_8infcyIDL_binaryEntropies(__pyx_v_snapshots, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 432, __pyx_L1_error)</span>
  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_t_1, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 432, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 1);
  __pyx_t_1.memview = NULL;
  __pyx_t_1.data = NULL;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.binaryEntropies", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_snapshots, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">433</span>:     cdef:</pre>
<pre class="cython line score-33" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">434</span>:         np.ndarray tmp, H = np.sum(snapshots.base, axis=0, dtype=float)</pre>
<pre class='cython code score-33 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 434, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_sum);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 434, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __pyx_memoryview_fromslice(__pyx_v_snapshots, 2, (PyObject *(*)(char *)) __pyx_memview_get_long, (int (*)(char *, PyObject *)) __pyx_memview_set_long, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 434, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_base);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 434, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 434, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 434, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_n_s_axis, __pyx_int_0) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 434, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_n_s_dtype, ((PyObject *)(&amp;PyFloat_Type))) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 434, __pyx_L1_error)</span>
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_1, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 434, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 434, __pyx_L1_error)</span>
  __pyx_v_H = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">435</span>:         long length = snapshots.shape[0]</pre>
<pre class='cython code score-0 '>  __pyx_v_length = (__pyx_v_snapshots.shape[0]);
</pre><pre class="cython line score-0">&#xA0;<span class="">436</span>:         double[::1] cview_H</pre>
<pre class="cython line score-0">&#xA0;<span class="">437</span>: </pre>
<pre class="cython line score-60" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">438</span>:     H = (length - np.abs(H))/2. + np.abs(H)</pre>
<pre class='cython code score-60 '>  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_length);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 438, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 438, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_abs);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 438, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_1 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_1)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
    }
  }
  __pyx_t_3 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_1, ((PyObject *)__pyx_v_H)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, ((PyObject *)__pyx_v_H));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 438, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_t_4, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 438, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyFloat_TrueDivideObjC</span>(__pyx_t_2, __pyx_float_2_, 2., 0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 438, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 438, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_abs);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 438, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
    }
  }
  __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_4, ((PyObject *)__pyx_v_H)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, ((PyObject *)__pyx_v_H));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 438, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_3, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 438, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 438, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_H, ((PyArrayObject *)__pyx_t_1));
  __pyx_t_1 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">439</span>:     H = H/length</pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_length);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 439, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyNumber_Divide</span>(((PyObject *)__pyx_v_H), __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 439, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 439, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_H, ((PyArrayObject *)__pyx_t_2));
  __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">440</span>: </pre>
<pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">441</span>:     tmp = 1-H</pre>
<pre class='cython code score-7 '>  __pyx_t_2 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_int_1, ((PyObject *)__pyx_v_H));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 441, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 441, __pyx_L1_error)</span>
  __pyx_v_tmp = ((PyArrayObject *)__pyx_t_2);
  __pyx_t_2 = 0;
</pre><pre class="cython line score-117" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">442</span>:     H = - H * np.log2(H) - tmp * np.log2(np.where(tmp==0, 1, tmp)) # compute entropy for each node (use 0*log(0) = 0)</pre>
<pre class='cython code score-117 '>  __pyx_t_2 = <span class='py_c_api'>PyNumber_Negative</span>(((PyObject *)__pyx_v_H));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 442, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 442, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_log2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 442, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_3, ((PyObject *)__pyx_v_H)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, ((PyObject *)__pyx_v_H));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 442, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_2, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 442, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 442, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_log2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 442, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 442, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_where);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 442, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyObject_RichCompare</span>(((PyObject *)__pyx_v_tmp), __pyx_int_0, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 442, __pyx_L1_error)</span>
  __pyx_t_7 = NULL;
  __pyx_t_8 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_6))) {
    __pyx_t_7 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_6);
    if (likely(__pyx_t_7)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_6, function);
      __pyx_t_8 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_6)) {
    PyObject *__pyx_temp[4] = {__pyx_t_7, __pyx_t_5, __pyx_int_1, ((PyObject *)__pyx_v_tmp)};
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_6, __pyx_temp+1-__pyx_t_8, 3+__pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 442, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_6)) {
    PyObject *__pyx_temp[4] = {__pyx_t_7, __pyx_t_5, __pyx_int_1, ((PyObject *)__pyx_v_tmp)};
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_6, __pyx_temp+1-__pyx_t_8, 3+__pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 442, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  } else
  #endif
  {
    __pyx_t_9 = <span class='py_c_api'>PyTuple_New</span>(3+__pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 442, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    if (__pyx_t_7) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0, __pyx_t_7); __pyx_t_7 = NULL;
    }
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0+__pyx_t_8, __pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_1);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_1);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 1+__pyx_t_8, __pyx_int_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_tmp));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_tmp));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 2+__pyx_t_8, ((PyObject *)__pyx_v_tmp));
    __pyx_t_5 = 0;
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_6, __pyx_t_9, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 442, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_6)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_6, __pyx_t_2) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 442, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyNumber_Multiply</span>(((PyObject *)__pyx_v_tmp), __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 442, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_t_4, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 442, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 442, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_H, ((PyArrayObject *)__pyx_t_1));
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">443</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">444</span>:     cview_H = H</pre>
<pre class='cython code score-2 '>  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dc_double</span>(((PyObject *)__pyx_v_H), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_10.memview)) __PYX_ERR(0, 444, __pyx_L1_error)</span>
  __pyx_v_cview_H = __pyx_t_10;
  __pyx_t_10.memview = NULL;
  __pyx_t_10.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">445</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">446</span>:     return cview_H</pre>
<pre class='cython code score-0 '>  __PYX_INC_MEMVIEW(&amp;__pyx_v_cview_H, 0);
  __pyx_r = __pyx_v_cview_H;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">447</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">448</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">449</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">450</span>: @cython.nonecheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">451</span>: @cython.initializedcheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">452</span>: @cython.overflowcheck(False)</pre>
<pre class="cython line score-67" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">453</span>: cpdef double mutualInformationIDL(long[:,::1] snapshots, double[::1] binEntropies, long node1, long node2) nogil:</pre>
<pre class='cython code score-67 '>static PyObject *__pyx_pw_7Toolbox_8infcyIDL_17mutualInformationIDL(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static double __pyx_f_7Toolbox_8infcyIDL_mutualInformationIDL(__Pyx_memviewslice __pyx_v_snapshots, __Pyx_memviewslice __pyx_v_binEntropies, long __pyx_v_node1, long __pyx_v_node2, CYTHON_UNUSED int __pyx_skip_dispatch) {
  long __pyx_v_idx;
  long __pyx_v_nSamples;
  std::vector&lt;long&gt;  __pyx_v_jointDistr;
  double __pyx_v_mi;
  double __pyx_v_jointEntropy;
  double __pyx_r;
  #ifdef WITH_THREAD
  PyGILState_STATE __pyx_gilstate_save;
  #endif
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("mutualInformationIDL", 1);
/* … */
  /* function exit code */
  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("Toolbox.infcyIDL.mutualInformationIDL", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 1);
  __pyx_r = 0;
  __pyx_L0:;
  #ifdef WITH_THREAD
  <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
  #endif
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_7Toolbox_8infcyIDL_17mutualInformationIDL(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_7Toolbox_8infcyIDL_17mutualInformationIDL(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_snapshots = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_binEntropies = { 0, 0, { 0 }, { 0 }, { 0 } };
  long __pyx_v_node1;
  long __pyx_v_node2;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("mutualInformationIDL (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_snapshots,&amp;__pyx_n_s_binEntropies,&amp;__pyx_n_s_node1,&amp;__pyx_n_s_node2,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_snapshots)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_binEntropies)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mutualInformationIDL", 1, 4, 4, 1); <span class='error_goto'>__PYX_ERR(0, 453, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_node1)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mutualInformationIDL", 1, 4, 4, 2); <span class='error_goto'>__PYX_ERR(0, 453, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_node2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mutualInformationIDL", 1, 4, 4, 3); <span class='error_goto'>__PYX_ERR(0, 453, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "mutualInformationIDL") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 453, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
    }
    __pyx_v_snapshots = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_d_dc_long</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_snapshots.memview)) __PYX_ERR(0, 453, __pyx_L3_error)</span>
    __pyx_v_binEntropies = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dc_double</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_binEntropies.memview)) __PYX_ERR(0, 453, __pyx_L3_error)</span>
    __pyx_v_node1 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[2]); if (unlikely((__pyx_v_node1 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 453, __pyx_L3_error)</span>
    __pyx_v_node2 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[3]); if (unlikely((__pyx_v_node2 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 453, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mutualInformationIDL", 1, 4, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 453, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.mutualInformationIDL", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_7Toolbox_8infcyIDL_16mutualInformationIDL(__pyx_self, __pyx_v_snapshots, __pyx_v_binEntropies, __pyx_v_node1, __pyx_v_node2);

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_7Toolbox_8infcyIDL_16mutualInformationIDL(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_snapshots, __Pyx_memviewslice __pyx_v_binEntropies, long __pyx_v_node1, long __pyx_v_node2) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("mutualInformationIDL", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_f_7Toolbox_8infcyIDL_mutualInformationIDL(__pyx_v_snapshots, __pyx_v_binEntropies, __pyx_v_node1, __pyx_v_node2, 0));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 453, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.mutualInformationIDL", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_snapshots, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_binEntropies, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">454</span>:     cdef:</pre>
<pre class='cython code score-4 '>  /*try:*/ {
/* … */
  /*finally:*/ {
    __pyx_L3_return: {
      #ifdef WITH_THREAD
      __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
      #endif
      goto __pyx_L0;
    }
    __pyx_L4_error: {
      #ifdef WITH_THREAD
      __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
      #endif
      goto __pyx_L1_error;
    }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">455</span>:         long idx, nSamples = snapshots.shape[0]</pre>
<pre class='cython code score-0 '>    __pyx_v_nSamples = (__pyx_v_snapshots.shape[0]);
</pre><pre class="cython line score-0">&#xA0;<span class="">456</span>:         vector[long] states</pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">457</span>:         vector[long] jointDistr = vector[long](nSamples, 0)</pre>
<pre class='cython code score-4 '>    try {
      __pyx_t_1 = std::vector&lt;long&gt; (__pyx_v_nSamples, 0);
    } catch(...) {
      #ifdef WITH_THREAD
      PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
      #endif
      __Pyx_CppExn2PyErr();
      #ifdef WITH_THREAD
      <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
      #endif
      <span class='error_goto'>__PYX_ERR(0, 457, __pyx_L4_error)</span>
    }
    __pyx_v_jointDistr = __pyx_t_1;
</pre><pre class="cython line score-0">&#xA0;<span class="">458</span>:         double mi, jointEntropy</pre>
<pre class="cython line score-0">&#xA0;<span class="">459</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">460</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">461</span>:     for idx in range(nSamples):</pre>
<pre class='cython code score-0 '>    __pyx_t_2 = __pyx_v_nSamples;
    __pyx_t_3 = __pyx_t_2;
    for (__pyx_t_4 = 0; __pyx_t_4 &lt; __pyx_t_3; __pyx_t_4+=1) {
      __pyx_v_idx = __pyx_t_4;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">462</span>:         jointDistr[idx] = snapshots[idx][node1] + snapshots[idx][node2]*2 # -3,-1,1,3 represent the 4 possible combinations of spins</pre>
<pre class='cython code score-0 '>      __pyx_t_5 = __pyx_v_idx;
      __pyx_t_6 = __pyx_v_node1;
      if (__pyx_t_5 &lt; 0) __pyx_t_5 += __pyx_v_snapshots.shape[0];
      if (__pyx_t_6 &lt; 0) __pyx_t_6 += __pyx_v_snapshots.shape[1];
      __pyx_t_7 = __pyx_v_idx;
      __pyx_t_8 = __pyx_v_node2;
      if (__pyx_t_7 &lt; 0) __pyx_t_7 += __pyx_v_snapshots.shape[0];
      if (__pyx_t_8 &lt; 0) __pyx_t_8 += __pyx_v_snapshots.shape[1];
      (__pyx_v_jointDistr[__pyx_v_idx]) = ((*((long *) ( /* dim=1 */ ((char *) (((long *) ( /* dim=0 */ (__pyx_v_snapshots.data + __pyx_t_5 * __pyx_v_snapshots.strides[0]) )) + __pyx_t_6)) ))) + ((*((long *) ( /* dim=1 */ ((char *) (((long *) ( /* dim=0 */ (__pyx_v_snapshots.data + __pyx_t_7 * __pyx_v_snapshots.strides[0]) )) + __pyx_t_8)) ))) * 2));
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">463</span>: </pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">464</span>:     with gil:</pre>
<pre class='cython code score-4 '>    {
        #ifdef WITH_THREAD
        PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
        #endif
        /*try:*/ {
/* … */
        /*finally:*/ {
          /*normal exit:*/{
            #ifdef WITH_THREAD
            <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
            #endif
            goto __pyx_L10;
          }
          __pyx_L10:;
        }
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">465</span>:         jointEntropy = entropy(jointDistr)</pre>
<pre class='cython code score-0 '>          __pyx_v_jointEntropy = __pyx_f_7Toolbox_8infcyIDL_entropy(__pyx_v_jointDistr, 0);
        }
</pre><pre class="cython line score-0">&#xA0;<span class="">466</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">467</span>:     mi = binEntropies[node1] + binEntropies[node2] - jointEntropy</pre>
<pre class='cython code score-0 '>    __pyx_t_9 = __pyx_v_node1;
    if (__pyx_t_9 &lt; 0) __pyx_t_9 += __pyx_v_binEntropies.shape[0];
    __pyx_t_10 = __pyx_v_node2;
    if (__pyx_t_10 &lt; 0) __pyx_t_10 += __pyx_v_binEntropies.shape[0];
    __pyx_v_mi = (((*((double *) ( /* dim=0 */ ((char *) (((double *) __pyx_v_binEntropies.data) + __pyx_t_9)) ))) + (*((double *) ( /* dim=0 */ ((char *) (((double *) __pyx_v_binEntropies.data) + __pyx_t_10)) )))) - __pyx_v_jointEntropy);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">468</span>:     return mi</pre>
<pre class='cython code score-0 '>    __pyx_r = __pyx_v_mi;
    goto __pyx_L3_return;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">469</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">470</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">471</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">472</span>: @cython.nonecheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">473</span>: @cython.cdivision(True)</pre>
<pre class="cython line score-0">&#xA0;<span class="">474</span>: @cython.initializedcheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">475</span>: @cython.overflowcheck(False)</pre>
<pre class="cython line score-25" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">476</span>: cpdef double entropy(vector[long] samples):</pre>
<pre class='cython code score-25 '>static PyObject *__pyx_pw_7Toolbox_8infcyIDL_19entropy(PyObject *__pyx_self, PyObject *__pyx_arg_samples); /*proto*/
static double __pyx_f_7Toolbox_8infcyIDL_entropy(std::vector&lt;long&gt;  __pyx_v_samples, CYTHON_UNUSED int __pyx_skip_dispatch) {
  __Pyx_memviewslice __pyx_v_counts = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_entropy;
  double __pyx_v_n;
  PyObject *__pyx_8genexpr3__pyx_v_c = NULL;
  double __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("entropy", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_5, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("Toolbox.infcyIDL.entropy", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
  __pyx_r = 0;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_counts, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_8genexpr3__pyx_v_c);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_7Toolbox_8infcyIDL_19entropy(PyObject *__pyx_self, PyObject *__pyx_arg_samples); /*proto*/
static PyObject *__pyx_pw_7Toolbox_8infcyIDL_19entropy(PyObject *__pyx_self, PyObject *__pyx_arg_samples) {
  std::vector&lt;long&gt;  __pyx_v_samples;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("entropy (wrapper)", 0);
  assert(__pyx_arg_samples); {
    __pyx_v_samples = <span class='pyx_c_api'>__pyx_convert_vector_from_py_long</span>(__pyx_arg_samples);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 476, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.entropy", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_7Toolbox_8infcyIDL_18entropy(__pyx_self, ((std::vector&lt;long&gt; )__pyx_v_samples));

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_7Toolbox_8infcyIDL_18entropy(CYTHON_UNUSED PyObject *__pyx_self, std::vector&lt;long&gt;  __pyx_v_samples) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("entropy", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_f_7Toolbox_8infcyIDL_entropy(__pyx_v_samples, 0));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 476, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.entropy", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">477</span>:     cdef:</pre>
<pre class="cython line score-31" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">478</span>:         long[::1] counts = np.unique(samples, return_counts=True)[1]</pre>
<pre class='cython code score-31 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 478, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_unique);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 478, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__pyx_convert_vector_to_py_long</span>(__pyx_v_samples);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 478, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 478, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 478, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_return_counts, Py_True) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 478, __pyx_L1_error)</span>
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_3, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 478, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_4, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 478, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dc_long</span>(__pyx_t_1, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_5.memview)) __PYX_ERR(0, 478, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_counts = __pyx_t_5;
  __pyx_t_5.memview = NULL;
  __pyx_t_5.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">479</span>:         double entropy, n = &lt;double&gt; samples.size()</pre>
<pre class='cython code score-0 '>  __pyx_v_n = ((double)__pyx_v_samples.size());
</pre><pre class="cython line score-0">&#xA0;<span class="">480</span>: </pre>
<pre class="cython line score-134" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">481</span>:     entropy = -np.sum([c/n * np.log2(c/n) for c in counts])</pre>
<pre class='cython code score-134 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 481, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_sum);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 481, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  { /* enter inner scope */
    __pyx_t_4 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 481, __pyx_L5_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_counts, 1, (PyObject *(*)(char *)) __pyx_memview_get_long, (int (*)(char *, PyObject *)) __pyx_memview_set_long, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 481, __pyx_L5_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_2)) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_2)) {
      __pyx_t_6 = __pyx_t_2; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6); __pyx_t_7 = 0;
      __pyx_t_8 = NULL;
    } else {
      __pyx_t_7 = -1; __pyx_t_6 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 481, __pyx_L5_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      __pyx_t_8 = Py_TYPE(__pyx_t_6)-&gt;tp_iternext;<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 481, __pyx_L5_error)</span>
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    for (;;) {
      if (likely(!__pyx_t_8)) {
        if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_6))) {
          if (__pyx_t_7 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_6)) break;
          #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_2 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_6, __pyx_t_7); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_7++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 481, __pyx_L5_error)</span>
          #else
          __pyx_t_2 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_6, __pyx_t_7); __pyx_t_7++;<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 481, __pyx_L5_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
          #endif
        } else {
          if (__pyx_t_7 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_6)) break;
          #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_2 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_6, __pyx_t_7); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_7++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 481, __pyx_L5_error)</span>
          #else
          __pyx_t_2 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_6, __pyx_t_7); __pyx_t_7++;<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 481, __pyx_L5_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
          #endif
        }
      } else {
        __pyx_t_2 = __pyx_t_8(__pyx_t_6);
        if (unlikely(!__pyx_t_2)) {
          PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
          if (exc_type) {
            if (likely(<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
            else <span class='error_goto'>__PYX_ERR(0, 481, __pyx_L5_error)</span>
          }
          break;
        }
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      }
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_8genexpr3__pyx_v_c, __pyx_t_2);
      __pyx_t_2 = 0;
      __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_n);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 481, __pyx_L5_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyNumber_Divide</span>(__pyx_8genexpr3__pyx_v_c, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 481, __pyx_L5_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_10, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 481, __pyx_L5_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
      __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_10, __pyx_n_s_log2);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 481, __pyx_L5_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_10 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_n);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 481, __pyx_L5_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
      __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyNumber_Divide</span>(__pyx_8genexpr3__pyx_v_c, __pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 481, __pyx_L5_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_10 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_11))) {
        __pyx_t_10 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_11);
        if (likely(__pyx_t_10)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_11);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_11, function);
        }
      }
      __pyx_t_2 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_11, __pyx_t_10, __pyx_t_12) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_11, __pyx_t_12);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
      if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 481, __pyx_L5_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      __pyx_t_11 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_9, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 481, __pyx_L5_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(<span class='pyx_c_api'>__Pyx_ListComp_Append</span>(__pyx_t_4, (PyObject*)__pyx_t_11))) <span class='error_goto'>__PYX_ERR(0, 481, __pyx_L5_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_8genexpr3__pyx_v_c); __pyx_8genexpr3__pyx_v_c = 0;
    goto __pyx_L8_exit_scope;
    __pyx_L5_error:;
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_8genexpr3__pyx_v_c); __pyx_8genexpr3__pyx_v_c = 0;
    goto __pyx_L1_error;
    __pyx_L8_exit_scope:;
  } /* exit inner scope */
  __pyx_t_6 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_6)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_6, __pyx_t_4) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 481, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyNumber_Negative</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 481, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_13 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_3); if (unlikely((__pyx_t_13 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 481, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_entropy = __pyx_t_13;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">482</span>:     return entropy</pre>
<pre class='cython code score-0 '>  __pyx_r = __pyx_v_entropy;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">483</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">484</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">485</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">486</span>: @cython.nonecheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">487</span>: @cython.cdivision(True)</pre>
<pre class="cython line score-0">&#xA0;<span class="">488</span>: @cython.initializedcheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">489</span>: @cython.overflowcheck(False)</pre>
<pre class="cython line score-80" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">490</span>: cpdef double[::1] MIAtDist(Model model, long[:,::1] snapshots, \</pre>
<pre class='cython code score-80 '>static PyObject *__pyx_pw_7Toolbox_8infcyIDL_21MIAtDist(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static __Pyx_memviewslice __pyx_f_7Toolbox_8infcyIDL_MIAtDist(struct __pyx_obj_6Models_6models_Model *__pyx_v_model, __Pyx_memviewslice __pyx_v_snapshots, __Pyx_memviewslice __pyx_v_entropies, long __pyx_v_node, std::vector&lt;long&gt;  __pyx_v_neighbours, CYTHON_UNUSED int __pyx_skip_dispatch) {
  long __pyx_v_idx;
  long __pyx_v_n;
  __Pyx_memviewslice __pyx_v_out = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_r = { 0, 0, { 0 }, { 0 }, { 0 } };
  #ifdef WITH_THREAD
  PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
  #endif
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("MIAtDist", 0);
  #ifdef WITH_THREAD
  <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
  #endif
/* … */
  /* function exit code */
  __Pyx_pretend_to_initialize(&amp;__pyx_r);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_8, 0);
  __pyx_r.data = NULL;
  __pyx_r.memview = NULL;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.MIAtDist", __pyx_clineno, __pyx_lineno, __pyx_filename);
  goto __pyx_L2;
  __pyx_L0:;
  if (unlikely(!__pyx_r.memview)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "Memoryview return value is not initialized");
  }
  __pyx_L2:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_out, 0);
  #ifdef WITH_THREAD
  <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
  #endif
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_7Toolbox_8infcyIDL_21MIAtDist(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_7Toolbox_8infcyIDL_21MIAtDist(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_6Models_6models_Model *__pyx_v_model = 0;
  __Pyx_memviewslice __pyx_v_snapshots = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_entropies = { 0, 0, { 0 }, { 0 }, { 0 } };
  long __pyx_v_node;
  std::vector&lt;long&gt;  __pyx_v_neighbours;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("MIAtDist (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_model,&amp;__pyx_n_s_snapshots,&amp;__pyx_n_s_entropies,&amp;__pyx_n_s_node,&amp;__pyx_n_s_neighbours,0};
    PyObject* values[5] = {0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_model)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_snapshots)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("MIAtDist", 1, 5, 5, 1); <span class='error_goto'>__PYX_ERR(0, 490, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_entropies)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("MIAtDist", 1, 5, 5, 2); <span class='error_goto'>__PYX_ERR(0, 490, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_node)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("MIAtDist", 1, 5, 5, 3); <span class='error_goto'>__PYX_ERR(0, 490, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_neighbours)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("MIAtDist", 1, 5, 5, 4); <span class='error_goto'>__PYX_ERR(0, 490, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "MIAtDist") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 490, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 5) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
    }
    __pyx_v_model = ((struct __pyx_obj_6Models_6models_Model *)values[0]);
    __pyx_v_snapshots = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_d_dc_long</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_snapshots.memview)) __PYX_ERR(0, 490, __pyx_L3_error)</span>
    __pyx_v_entropies = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dc_double</span>(values[2], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_entropies.memview)) __PYX_ERR(0, 491, __pyx_L3_error)</span>
    __pyx_v_node = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[3]); if (unlikely((__pyx_v_node == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 491, __pyx_L3_error)</span>
    __pyx_v_neighbours = <span class='pyx_c_api'>__pyx_convert_vector_from_py_long</span>(values[4]);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 491, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("MIAtDist", 1, 5, 5, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 490, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.MIAtDist", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_model), __pyx_ptype_6Models_6models_Model, 1, "model", 0))) <span class='error_goto'>__PYX_ERR(0, 490, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_7Toolbox_8infcyIDL_20MIAtDist(__pyx_self, __pyx_v_model, __pyx_v_snapshots, __pyx_v_entropies, __pyx_v_node, __pyx_v_neighbours);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_7Toolbox_8infcyIDL_20MIAtDist(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6Models_6models_Model *__pyx_v_model, __Pyx_memviewslice __pyx_v_snapshots, __Pyx_memviewslice __pyx_v_entropies, long __pyx_v_node, std::vector&lt;long&gt;  __pyx_v_neighbours) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("MIAtDist", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = __pyx_f_7Toolbox_8infcyIDL_MIAtDist(__pyx_v_model, __pyx_v_snapshots, __pyx_v_entropies, __pyx_v_node, __pyx_v_neighbours, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 490, __pyx_L1_error)</span>
  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_t_1, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 490, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 1);
  __pyx_t_1.memview = NULL;
  __pyx_t_1.data = NULL;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.MIAtDist", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_snapshots, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_entropies, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">491</span>:               double[::1] entropies, long node, vector[long] neighbours) nogil:</pre>
<pre class="cython line score-0">&#xA0;<span class="">492</span>: </pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">493</span>:     cdef:</pre>
<pre class='cython code score-4 '>  /*try:*/ {
/* … */
  /*finally:*/ {
    __pyx_L3_return: {
      #ifdef WITH_THREAD
      __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
      #endif
      goto __pyx_L0;
    }
    __pyx_L4_error: {
      #ifdef WITH_THREAD
      __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
      #endif
      goto __pyx_L1_error;
    }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">494</span>:         long idx, n = neighbours.size()</pre>
<pre class='cython code score-0 '>    __pyx_v_n = __pyx_v_neighbours.size();
</pre><pre class="cython line score-0">&#xA0;<span class="">495</span>:         double[::1] out</pre>
<pre class="cython line score-0">&#xA0;<span class="">496</span>: </pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">497</span>:     with gil: # TODO possible without GIL?</pre>
<pre class='cython code score-6 '>    {
        #ifdef WITH_THREAD
        PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
        #endif
        /*try:*/ {
/* … */
        /*finally:*/ {
          /*normal exit:*/{
            #ifdef WITH_THREAD
            <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
            #endif
            goto __pyx_L8;
          }
          __pyx_L7_error: {
            #ifdef WITH_THREAD
            <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
            #endif
            goto __pyx_L4_error;
          }
          __pyx_L8:;
        }
    }
</pre><pre class="cython line score-54" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">498</span>:         out = np.full(model._nNodes, np.nan)</pre>
<pre class='cython code score-54 '>          <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 498, __pyx_L7_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
          __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_full);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 498, __pyx_L7_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
          __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_model-&gt;_nNodes);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 498, __pyx_L7_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
          <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 498, __pyx_L7_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
          __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_nan);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 498, __pyx_L7_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_t_4 = NULL;
          __pyx_t_6 = 0;
          if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
            __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
            if (likely(__pyx_t_4)) {
              PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
              <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
              __pyx_t_6 = 1;
            }
          }
          #if CYTHON_FAST_PYCALL
          if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_3)) {
            PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_t_2, __pyx_t_5};
            __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 498, __pyx_L7_error)</span>
            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          } else
          #endif
          #if CYTHON_FAST_PYCCALL
          if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_3)) {
            PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_t_2, __pyx_t_5};
            __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 498, __pyx_L7_error)</span>
            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          } else
          #endif
          {
            __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 498, __pyx_L7_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
            if (__pyx_t_4) {
              <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0, __pyx_t_4); __pyx_t_4 = NULL;
            }
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0+__pyx_t_6, __pyx_t_2);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 1+__pyx_t_6, __pyx_t_5);
            __pyx_t_2 = 0;
            __pyx_t_5 = 0;
            __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_7, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 498, __pyx_L7_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
          }
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dc_double</span>(__pyx_t_1, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 498, __pyx_L7_error)</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_v_out = __pyx_t_8;
          __pyx_t_8.memview = NULL;
          __pyx_t_8.data = NULL;
        }
</pre><pre class="cython line score-0">&#xA0;<span class="">499</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">500</span>:     if n &gt; 0:</pre>
<pre class='cython code score-0 '>    __pyx_t_9 = ((__pyx_v_n &gt; 0) != 0);
    if (__pyx_t_9) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">501</span>:         for idx in range(n):</pre>
<pre class='cython code score-0 '>      __pyx_t_10 = __pyx_v_n;
      __pyx_t_11 = __pyx_t_10;
      for (__pyx_t_12 = 0; __pyx_t_12 &lt; __pyx_t_11; __pyx_t_12+=1) {
        __pyx_v_idx = __pyx_t_12;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">502</span>:             out[idx] = mutualInformationIDL(snapshots, entropies, node, neighbours[idx])</pre>
<pre class='cython code score-0 '>        __pyx_t_13 = __pyx_v_idx;
        if (__pyx_t_13 &lt; 0) __pyx_t_13 += __pyx_v_out.shape[0];
        *((double *) ( /* dim=0 */ ((char *) (((double *) __pyx_v_out.data) + __pyx_t_13)) )) = __pyx_f_7Toolbox_8infcyIDL_mutualInformationIDL(__pyx_v_snapshots, __pyx_v_entropies, __pyx_v_node, (__pyx_v_neighbours[__pyx_v_idx]), 0);
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">503</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">504</span>:     return out</pre>
<pre class='cython code score-0 '>    __PYX_INC_MEMVIEW(&amp;__pyx_v_out, 1);
    __pyx_r = __pyx_v_out;
    goto __pyx_L3_return;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">505</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">506</span>: </pre>
<pre class="cython line score-65" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">507</span>: cpdef np.ndarray magTimeSeries(Model model, long burninSamples, \</pre>
<pre class='cython code score-65 '>static PyObject *__pyx_pw_7Toolbox_8infcyIDL_23magTimeSeries(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyArrayObject *__pyx_f_7Toolbox_8infcyIDL_magTimeSeries(struct __pyx_obj_6Models_6models_Model *__pyx_v_model, long __pyx_v_burninSamples, long __pyx_v_nSamples, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_7Toolbox_8infcyIDL_magTimeSeries *__pyx_optional_args) {
  int __pyx_v_abs = ((int)0);
  PyArrayObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("magTimeSeries", 0);
  if (__pyx_optional_args) {
    if (__pyx_optional_args-&gt;__pyx_n &gt; 0) {
      __pyx_v_abs = __pyx_optional_args-&gt;abs;
    }
  }
/* … */
  /* function exit code */
  __pyx_L1_error:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.magTimeSeries", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>((PyObject *)__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_7Toolbox_8infcyIDL_23magTimeSeries(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_7Toolbox_8infcyIDL_23magTimeSeries(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_6Models_6models_Model *__pyx_v_model = 0;
  long __pyx_v_burninSamples;
  long __pyx_v_nSamples;
  int __pyx_v_abs;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("magTimeSeries (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_model,&amp;__pyx_n_s_burninSamples,&amp;__pyx_n_s_nSamples,&amp;__pyx_n_s_abs,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_model)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_burninSamples)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("magTimeSeries", 0, 3, 4, 1); <span class='error_goto'>__PYX_ERR(0, 507, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_nSamples)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("magTimeSeries", 0, 3, 4, 2); <span class='error_goto'>__PYX_ERR(0, 507, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_abs);
          if (value) { values[3] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "magTimeSeries") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 507, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_model = ((struct __pyx_obj_6Models_6models_Model *)values[0]);
    __pyx_v_burninSamples = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[1]); if (unlikely((__pyx_v_burninSamples == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 507, __pyx_L3_error)</span>
    __pyx_v_nSamples = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[2]); if (unlikely((__pyx_v_nSamples == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 508, __pyx_L3_error)</span>
    if (values[3]) {
      __pyx_v_abs = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[3]); if (unlikely((__pyx_v_abs == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 508, __pyx_L3_error)</span>
    } else {
      __pyx_v_abs = ((int)0);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("magTimeSeries", 0, 3, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 507, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.magTimeSeries", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_model), __pyx_ptype_6Models_6models_Model, 1, "model", 0))) <span class='error_goto'>__PYX_ERR(0, 507, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_7Toolbox_8infcyIDL_22magTimeSeries(__pyx_self, __pyx_v_model, __pyx_v_burninSamples, __pyx_v_nSamples, __pyx_v_abs);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_7Toolbox_8infcyIDL_22magTimeSeries(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6Models_6models_Model *__pyx_v_model, long __pyx_v_burninSamples, long __pyx_v_nSamples, int __pyx_v_abs) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("magTimeSeries", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_2.__pyx_n = 1;
  __pyx_t_2.abs = __pyx_v_abs;
  __pyx_t_1 = ((PyObject *)__pyx_f_7Toolbox_8infcyIDL_magTimeSeries(__pyx_v_model, __pyx_v_burninSamples, __pyx_v_nSamples, 0, &amp;__pyx_t_2));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 507, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.magTimeSeries", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
struct __pyx_opt_args_7Toolbox_8infcyIDL_magTimeSeries {
  int __pyx_n;
  int abs;
};
</pre><pre class="cython line score-0">&#xA0;<span class="">508</span>:                                 long nSamples, int abs=0):</pre>
<pre class="cython line score-0">&#xA0;<span class="">509</span>: </pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">510</span>:     return _magTimeSeries(model, burninSamples, nSamples, abs).base</pre>
<pre class='cython code score-6 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  __pyx_t_2.__pyx_n = 1;
  __pyx_t_2.abs = __pyx_v_abs;
  __pyx_t_1 = __pyx_f_7Toolbox_8infcyIDL__magTimeSeries(__pyx_v_model, __pyx_v_burninSamples, __pyx_v_nSamples, &amp;__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 510, __pyx_L1_error)</span>
  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_t_1, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 510, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 1);
  __pyx_t_1.memview = NULL;
  __pyx_t_1.data = NULL;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_base);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 510, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 510, __pyx_L1_error)</span>
  __pyx_r = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">511</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">512</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">513</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">514</span>: @cython.nonecheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">515</span>: @cython.cdivision(True)</pre>
<pre class="cython line score-0">&#xA0;<span class="">516</span>: @cython.initializedcheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">517</span>: @cython.overflowcheck(False)</pre>
<pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">518</span>: cdef double[::1] _magTimeSeries(Model model, long burninSamples, \</pre>
<pre class='cython code score-11 '>static __Pyx_memviewslice __pyx_f_7Toolbox_8infcyIDL__magTimeSeries(struct __pyx_obj_6Models_6models_Model *__pyx_v_model, long __pyx_v_burninSamples, long __pyx_v_nSamples, struct __pyx_opt_args_7Toolbox_8infcyIDL__magTimeSeries *__pyx_optional_args) {
  int __pyx_v_abs = ((int)0);
  __Pyx_memviewslice __pyx_v_mags = { 0, 0, { 0 }, { 0 }, { 0 } };
  long __pyx_v_sample;
  __Pyx_memviewslice __pyx_r = { 0, 0, { 0 }, { 0 }, { 0 } };
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("_magTimeSeries", 0);
  if (__pyx_optional_args) {
    if (__pyx_optional_args-&gt;__pyx_n &gt; 0) {
      __pyx_v_abs = __pyx_optional_args-&gt;abs;
    }
  }
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_5, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_6, 1);
  __pyx_r.data = NULL;
  __pyx_r.memview = NULL;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL._magTimeSeries", __pyx_clineno, __pyx_lineno, __pyx_filename);
  goto __pyx_L2;
  __pyx_L0:;
  if (unlikely(!__pyx_r.memview)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "Memoryview return value is not initialized");
  }
  __pyx_L2:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_mags, 1);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
struct __pyx_opt_args_7Toolbox_8infcyIDL__magTimeSeries {
  int __pyx_n;
  int abs;
};
</pre><pre class="cython line score-0">&#xA0;<span class="">519</span>:                                 long nSamples, int abs=0):</pre>
<pre class="cython line score-0">&#xA0;<span class="">520</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">521</span>:     cdef:</pre>
<pre class="cython line score-25" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">522</span>:         double[::1] mags = np.zeros(nSamples)</pre>
<pre class='cython code score-25 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 522, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 522, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_nSamples);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 522, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_t_2) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 522, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dc_double</span>(__pyx_t_1, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_5.memview)) __PYX_ERR(0, 522, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_mags = __pyx_t_5;
  __pyx_t_5.memview = NULL;
  __pyx_t_5.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">523</span>:         long sample</pre>
<pre class="cython line score-0">&#xA0;<span class="">524</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">525</span>:     model.simulateNSteps(burninSamples)</pre>
<pre class='cython code score-0 '>  __pyx_t_6 = ((struct __pyx_vtabstruct_6Models_6models_Model *)__pyx_v_model-&gt;__pyx_vtab)-&gt;simulateNSteps(__pyx_v_model, __pyx_v_burninSamples);<span class='error_goto'> if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 525, __pyx_L1_error)</span>
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_6, 1);
  __pyx_t_6.memview = NULL;
  __pyx_t_6.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">526</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">527</span>:     for sample in range(nSamples):</pre>
<pre class='cython code score-0 '>  __pyx_t_7 = __pyx_v_nSamples;
  __pyx_t_8 = __pyx_t_7;
  for (__pyx_t_9 = 0; __pyx_t_9 &lt; __pyx_t_8; __pyx_t_9+=1) {
    __pyx_v_sample = __pyx_t_9;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">528</span>:         mags[sample] = mean(model.simulateNSteps(1), model._nNodes, abs)</pre>
<pre class='cython code score-0 '>    __pyx_t_6 = ((struct __pyx_vtabstruct_6Models_6models_Model *)__pyx_v_model-&gt;__pyx_vtab)-&gt;simulateNSteps(__pyx_v_model, 1);<span class='error_goto'> if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 528, __pyx_L1_error)</span>
    __pyx_t_11.__pyx_n = 1;
    __pyx_t_11.abs = __pyx_v_abs;
    __pyx_t_10 = __pyx_f_7Toolbox_8infcyIDL_mean(__pyx_t_6, __pyx_v_model-&gt;_nNodes, &amp;__pyx_t_11); 
    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_6, 1);
    __pyx_t_6.memview = NULL;
    __pyx_t_6.data = NULL;
    __pyx_t_12 = __pyx_v_sample;
    if (__pyx_t_12 &lt; 0) __pyx_t_12 += __pyx_v_mags.shape[0];
    *((double *) ( /* dim=0 */ ((char *) (((double *) __pyx_v_mags.data) + __pyx_t_12)) )) = __pyx_t_10;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">529</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">530</span>:     return mags</pre>
<pre class='cython code score-0 '>  __PYX_INC_MEMVIEW(&amp;__pyx_v_mags, 0);
  __pyx_r = __pyx_v_mags;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">531</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">532</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">533</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">534</span>: @cython.nonecheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">535</span>: @cython.cdivision(True)</pre>
<pre class="cython line score-0">&#xA0;<span class="">536</span>: @cython.initializedcheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">537</span>: @cython.overflowcheck(False)</pre>
<pre class="cython line score-121" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">538</span>: cpdef tuple runMI(Model model, long repeats, long burninSamples, long nSamples, \</pre>
<pre class='cython code score-121 '>static PyObject *__pyx_pw_7Toolbox_8infcyIDL_25runMI(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_7Toolbox_8infcyIDL_runMI(struct __pyx_obj_6Models_6models_Model *__pyx_v_model, long __pyx_v_repeats, long __pyx_v_burninSamples, long __pyx_v_nSamples, long __pyx_v_distSamples, PyArrayObject *__pyx_v_nodes, int __pyx_v_distMax, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_7Toolbox_8infcyIDL_runMI *__pyx_optional_args) {
  double __pyx_v_magThreshold = ((double)0.0);
  CYTHON_UNUSED __Pyx_memviewslice __pyx_v_cv_nodes = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_snapshots = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_entropies = { 0, 0, { 0 }, { 0 }, { 0 } };
  long __pyx_v_n;
  long __pyx_v_d;
  long __pyx_v_nNodes;
  __Pyx_memviewslice __pyx_v_nodesIdx = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_MI = { 0, 0, { 0 }, { 0 }, { 0 } };
  CYTHON_UNUSED int __pyx_v_nThreads;
  std::unordered_map&lt;long,std::vector&lt;long&gt; &gt;  __pyx_v_allNeighbours;
  CYTHON_UNUSED PyObject *__pyx_v__ = NULL;
  PyObject *__pyx_v_degrees = NULL;
  long __pyx_8genexpr4__pyx_v_n;
  long __pyx_8genexpr5__pyx_v_n;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("runMI", 0);
  if (__pyx_optional_args) {
    if (__pyx_optional_args-&gt;__pyx_n &gt; 0) {
      __pyx_v_magThreshold = __pyx_optional_args-&gt;magThreshold;
    }
  }
/* … */
  /* function exit code */
  __pyx_L1_error:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_11, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_14, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_17, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_25, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.runMI", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_cv_nodes, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_snapshots, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_entropies, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_nodesIdx, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_MI, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v__);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_degrees);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_7Toolbox_8infcyIDL_25runMI(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_7Toolbox_8infcyIDL_25runMI(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_6Models_6models_Model *__pyx_v_model = 0;
  long __pyx_v_repeats;
  long __pyx_v_burninSamples;
  long __pyx_v_nSamples;
  long __pyx_v_distSamples;
  PyArrayObject *__pyx_v_nodes = 0;
  int __pyx_v_distMax;
  double __pyx_v_magThreshold;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("runMI (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_model,&amp;__pyx_n_s_repeats,&amp;__pyx_n_s_burninSamples,&amp;__pyx_n_s_nSamples,&amp;__pyx_n_s_distSamples,&amp;__pyx_n_s_nodes,&amp;__pyx_n_s_distMax,&amp;__pyx_n_s_magThreshold,0};
    PyObject* values[8] = {0,0,0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_model)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_repeats)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("runMI", 0, 7, 8, 1); <span class='error_goto'>__PYX_ERR(0, 538, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_burninSamples)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("runMI", 0, 7, 8, 2); <span class='error_goto'>__PYX_ERR(0, 538, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_nSamples)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("runMI", 0, 7, 8, 3); <span class='error_goto'>__PYX_ERR(0, 538, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_distSamples)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("runMI", 0, 7, 8, 4); <span class='error_goto'>__PYX_ERR(0, 538, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_nodes)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("runMI", 0, 7, 8, 5); <span class='error_goto'>__PYX_ERR(0, 538, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (likely((values[6] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_distMax)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("runMI", 0, 7, 8, 6); <span class='error_goto'>__PYX_ERR(0, 538, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_magThreshold);
          if (value) { values[7] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "runMI") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 538, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_model = ((struct __pyx_obj_6Models_6models_Model *)values[0]);
    __pyx_v_repeats = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[1]); if (unlikely((__pyx_v_repeats == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 538, __pyx_L3_error)</span>
    __pyx_v_burninSamples = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[2]); if (unlikely((__pyx_v_burninSamples == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 538, __pyx_L3_error)</span>
    __pyx_v_nSamples = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[3]); if (unlikely((__pyx_v_nSamples == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 538, __pyx_L3_error)</span>
    __pyx_v_distSamples = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[4]); if (unlikely((__pyx_v_distSamples == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 539, __pyx_L3_error)</span>
    __pyx_v_nodes = ((PyArrayObject *)values[5]);
    __pyx_v_distMax = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[6]); if (unlikely((__pyx_v_distMax == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 539, __pyx_L3_error)</span>
    if (values[7]) {
      __pyx_v_magThreshold = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[7]); if (unlikely((__pyx_v_magThreshold == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 540, __pyx_L3_error)</span>
    } else {
      __pyx_v_magThreshold = ((double)0.0);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("runMI", 0, 7, 8, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 538, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.runMI", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_model), __pyx_ptype_6Models_6models_Model, 1, "model", 0))) <span class='error_goto'>__PYX_ERR(0, 538, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_nodes), __pyx_ptype_5numpy_ndarray, 1, "nodes", 0))) <span class='error_goto'>__PYX_ERR(0, 539, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_7Toolbox_8infcyIDL_24runMI(__pyx_self, __pyx_v_model, __pyx_v_repeats, __pyx_v_burninSamples, __pyx_v_nSamples, __pyx_v_distSamples, __pyx_v_nodes, __pyx_v_distMax, __pyx_v_magThreshold);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_7Toolbox_8infcyIDL_24runMI(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6Models_6models_Model *__pyx_v_model, long __pyx_v_repeats, long __pyx_v_burninSamples, long __pyx_v_nSamples, long __pyx_v_distSamples, PyArrayObject *__pyx_v_nodes, int __pyx_v_distMax, double __pyx_v_magThreshold) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("runMI", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_2.__pyx_n = 1;
  __pyx_t_2.magThreshold = __pyx_v_magThreshold;
  __pyx_t_1 = __pyx_f_7Toolbox_8infcyIDL_runMI(__pyx_v_model, __pyx_v_repeats, __pyx_v_burninSamples, __pyx_v_nSamples, __pyx_v_distSamples, __pyx_v_nodes, __pyx_v_distMax, 0, &amp;__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 538, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.runMI", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
struct __pyx_opt_args_7Toolbox_8infcyIDL_runMI {
  int __pyx_n;
  double magThreshold;
};
</pre><pre class="cython line score-0">&#xA0;<span class="">539</span>:                   long distSamples, np.ndarray nodes, int distMax, \</pre>
<pre class="cython line score-0">&#xA0;<span class="">540</span>:                   double magThreshold=0):</pre>
<pre class="cython line score-0">&#xA0;<span class="">541</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">542</span>:     cdef:</pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">543</span>:         long[::1] cv_nodes = nodes</pre>
<pre class='cython code score-2 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dc_long</span>(((PyObject *)__pyx_v_nodes), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 543, __pyx_L1_error)</span>
  __pyx_v_cv_nodes = __pyx_t_1;
  __pyx_t_1.memview = NULL;
  __pyx_t_1.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">544</span>:         long[:,::1] snapshots</pre>
<pre class="cython line score-0">&#xA0;<span class="">545</span>:         double[::1] entropies</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">546</span>:         long n, d, nNodes = nodes.shape[0]</pre>
<pre class='cython code score-0 '>  __pyx_v_nNodes = (__pyx_v_nodes-&gt;dimensions[0]);
</pre><pre class="cython line score-86" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">547</span>:         long[::1] nodesIdx = np.array([model.mapping[n] for n in nodes])</pre>
<pre class='cython code score-86 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 547, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 547, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  { /* enter inner scope */
    __pyx_t_3 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 547, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    if (likely(<span class='py_c_api'>PyList_CheckExact</span>(((PyObject *)__pyx_v_nodes))) || <span class='py_c_api'>PyTuple_CheckExact</span>(((PyObject *)__pyx_v_nodes))) {
      __pyx_t_5 = ((PyObject *)__pyx_v_nodes); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_6 = 0;
      __pyx_t_7 = NULL;
    } else {
      __pyx_t_6 = -1; __pyx_t_5 = <span class='py_c_api'>PyObject_GetIter</span>(((PyObject *)__pyx_v_nodes));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 547, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      __pyx_t_7 = Py_TYPE(__pyx_t_5)-&gt;tp_iternext;<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 547, __pyx_L1_error)</span>
    }
    for (;;) {
      if (likely(!__pyx_t_7)) {
        if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_5))) {
          if (__pyx_t_6 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_5)) break;
          #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_8 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_5, __pyx_t_6); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8); __pyx_t_6++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 547, __pyx_L1_error)</span>
          #else
          __pyx_t_8 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_5, __pyx_t_6); __pyx_t_6++;<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 547, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          #endif
        } else {
          if (__pyx_t_6 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_5)) break;
          #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_8 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_5, __pyx_t_6); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8); __pyx_t_6++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 547, __pyx_L1_error)</span>
          #else
          __pyx_t_8 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_5, __pyx_t_6); __pyx_t_6++;<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 547, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          #endif
        }
      } else {
        __pyx_t_8 = __pyx_t_7(__pyx_t_5);
        if (unlikely(!__pyx_t_8)) {
          PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
          if (exc_type) {
            if (likely(<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
            else <span class='error_goto'>__PYX_ERR(0, 547, __pyx_L1_error)</span>
          }
          break;
        }
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      }
      __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_8); if (unlikely((__pyx_t_9 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 547, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_8genexpr4__pyx_v_n = __pyx_t_9;
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(((PyObject *)__pyx_v_model), __pyx_n_s_mapping);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 547, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      __pyx_t_10 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_8, __pyx_8genexpr4__pyx_v_n, long, 1, __Pyx_PyInt_From_long, 0, 1, 0);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 547, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      if (unlikely(<span class='pyx_c_api'>__Pyx_ListComp_Append</span>(__pyx_t_3, (PyObject*)__pyx_t_10))) <span class='error_goto'>__PYX_ERR(0, 547, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  } /* exit inner scope */
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
    __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
    }
  }
  __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_t_3) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, __pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 547, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dc_long</span>(__pyx_t_2, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 547, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_nodesIdx = __pyx_t_1;
  __pyx_t_1.memview = NULL;
  __pyx_t_1.data = NULL;
</pre><pre class="cython line score-37" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">548</span>:         double[:,:,::1] MI = np.zeros((nNodes, distMax, model._nNodes))</pre>
<pre class='cython code score-37 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 548, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 548, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_nNodes);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 548, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_distMax);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 548, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_model-&gt;_nNodes);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 548, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 548, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 1, __pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_10);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 2, __pyx_t_10);
  __pyx_t_4 = 0;
  __pyx_t_5 = 0;
  __pyx_t_10 = 0;
  __pyx_t_10 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_10 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_10)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  __pyx_t_2 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_10, __pyx_t_8) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 548, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_d_d_dc_double</span>(__pyx_t_2, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 548, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_MI = __pyx_t_11;
  __pyx_t_11.memview = NULL;
  __pyx_t_11.data = NULL;
</pre><pre class="cython line score-29" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">549</span>:         int nThreads = mp.cpu_count()</pre>
<pre class='cython code score-29 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_mp);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 549, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_cpu_count);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 549, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_8))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_8);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_8, function);
    }
  }
  __pyx_t_2 = (__pyx_t_3) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_8, __pyx_t_3) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 549, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_2); if (unlikely((__pyx_t_12 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 549, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_nThreads = __pyx_t_12;
</pre><pre class="cython line score-0">&#xA0;<span class="">550</span>:         unordered_map[long, vector[long]] allNeighbours</pre>
<pre class="cython line score-0">&#xA0;<span class="">551</span>:         int[::1] neighbours</pre>
<pre class="cython line score-0">&#xA0;<span class="">552</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">553</span>:     # run multiple MC chains in parallel and sample snapshots</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">554</span>:     if magThreshold == 0:</pre>
<pre class='cython code score-0 '>  __pyx_t_13 = ((__pyx_v_magThreshold == 0.0) != 0);
  if (__pyx_t_13) {
/* … */
    goto __pyx_L5;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">555</span>:         snapshots = equilibriumSampling(model, repeats, burninSamples, nSamples, distSamples)</pre>
<pre class='cython code score-0 '>    __pyx_t_14 = __pyx_f_7Toolbox_8infcyIDL_equilibriumSampling(__pyx_v_model, __pyx_v_repeats, __pyx_v_burninSamples, __pyx_v_nSamples, __pyx_v_distSamples, 0);<span class='error_goto'> if (unlikely(!__pyx_t_14.memview)) __PYX_ERR(0, 555, __pyx_L1_error)</span>
    __pyx_v_snapshots = __pyx_t_14;
    __pyx_t_14.memview = NULL;
    __pyx_t_14.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">556</span>:     elif magThreshold &gt; 0:</pre>
<pre class='cython code score-0 '>  __pyx_t_13 = ((__pyx_v_magThreshold &gt; 0.0) != 0);
  if (__pyx_t_13) {
/* … */
    goto __pyx_L5;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">557</span>:         # only sample snapshots with abs avg mag larger than magThreshold</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">558</span>:         snapshots = equilibriumSamplingMagThreshold(model, repeats, burninSamples, nSamples, distSamples, switch=0, threshold=magThreshold)</pre>
<pre class='cython code score-0 '>    __pyx_t_15.__pyx_n = 2;
    __pyx_t_15.__pyx_switch = 0;
    __pyx_t_15.threshold = __pyx_v_magThreshold;
    __pyx_t_14 = __pyx_f_7Toolbox_8infcyIDL_equilibriumSamplingMagThreshold(__pyx_v_model, __pyx_v_repeats, __pyx_v_burninSamples, __pyx_v_nSamples, __pyx_v_distSamples, 0, &amp;__pyx_t_15);<span class='error_goto'> if (unlikely(!__pyx_t_14.memview)) __PYX_ERR(0, 558, __pyx_L1_error)</span>
    __pyx_v_snapshots = __pyx_t_14;
    __pyx_t_14.memview = NULL;
    __pyx_t_14.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">559</span>:     else:</pre>
<pre class="cython line score-0">&#xA0;<span class="">560</span>:       # only sample snapshots with abs avg mag smaller than magThreshold</pre>
<pre class="cython line score-36" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">561</span>:         snapshots = equilibriumSamplingMagThreshold(model, repeats, burninSamples, nSamples, distSamples, switch=1, threshold=np.abs(magThreshold))</pre>
<pre class='cython code score-36 '>  /*else*/ {
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_8, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 561, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_abs);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 561, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_magThreshold);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 561, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    __pyx_t_10 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
      __pyx_t_10 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
      if (likely(__pyx_t_10)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
      }
    }
    __pyx_t_2 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_10, __pyx_t_8) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 561, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_16 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2); if (unlikely((__pyx_t_16 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 561, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_15.__pyx_n = 2;
    __pyx_t_15.__pyx_switch = 1;
    __pyx_t_15.threshold = __pyx_t_16;
    __pyx_t_14 = __pyx_f_7Toolbox_8infcyIDL_equilibriumSamplingMagThreshold(__pyx_v_model, __pyx_v_repeats, __pyx_v_burninSamples, __pyx_v_nSamples, __pyx_v_distSamples, 0, &amp;__pyx_t_15);<span class='error_goto'> if (unlikely(!__pyx_t_14.memview)) __PYX_ERR(0, 561, __pyx_L1_error)</span>
    __pyx_v_snapshots = __pyx_t_14;
    __pyx_t_14.memview = NULL;
    __pyx_t_14.data = NULL;
  }
  __pyx_L5:;
</pre><pre class="cython line score-0">&#xA0;<span class="">562</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">563</span>:     entropies = binaryEntropies(snapshots)</pre>
<pre class='cython code score-0 '>  __pyx_t_17 = __pyx_f_7Toolbox_8infcyIDL_binaryEntropies(__pyx_v_snapshots, 0);<span class='error_goto'> if (unlikely(!__pyx_t_17.memview)) __PYX_ERR(0, 563, __pyx_L1_error)</span>
  __pyx_v_entropies = __pyx_t_17;
  __pyx_t_17.memview = NULL;
  __pyx_t_17.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">564</span>: </pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">565</span>:     for n in prange(nNodes, nogil = True, \</pre>
<pre class='cython code score-6 '>  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      <span class='pyx_c_api'>__Pyx_FastGIL_Remember</span>();
      #endif
      /*try:*/ {
        __pyx_t_9 = __pyx_v_nNodes;
        if (1 == 0) abort();
        {
            #if ((defined(__APPLE__) || defined(__OSX__)) &amp;&amp; (defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 2 || (__GNUC__ == 2 &amp;&amp; (__GNUC_MINOR__ &gt; 95)))))
                #undef likely
                #undef unlikely
                #define likely(x)   (x)
                #define unlikely(x) (x)
            #endif
            __pyx_t_19 = (__pyx_t_9 - 0 + 1 - 1/abs(1)) / 1;
            if (__pyx_t_19 &gt; 0)
            {
                #ifdef _OPENMP
                #pragma omp parallel
                #endif /* _OPENMP */
                {
                    #ifdef _OPENMP
                    #pragma omp for lastprivate(__pyx_v_allNeighbours) lastprivate(__pyx_v_d) firstprivate(__pyx_v_n) lastprivate(__pyx_v_n) schedule(dynamic)        __pyx_t_9 = __pyx_v_nNodes;
        if (1 == 0) abort();
        {
            #if ((defined(__APPLE__) || defined(__OSX__)) &amp;&amp; (defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 2 || (__GNUC__ == 2 &amp;&amp; (__GNUC_MINOR__ &gt; 95)))))
                #undef likely
                #undef unlikely
                #define likely(x)   (x)
                #define unlikely(x) (x)
            #endif
            __pyx_t_19 = (__pyx_t_9 - 0 + 1 - 1/abs(1)) / 1;
            if (__pyx_t_19 &gt; 0)
            {
                #ifdef _OPENMP
                #pragma omp parallel
                #endif /* _OPENMP */
                {
                    #ifdef _OPENMP
                    #pragma omp for lastprivate(__pyx_v_allNeighbours) lastprivate(__pyx_v_d) firstprivate(__pyx_v_n) lastprivate(__pyx_v_n) schedule(dynamic) num_threads(__pyx_v_nThreads)
                    #endif /* _OPENMP */
                    for (__pyx_t_18 = 0; __pyx_t_18 &lt; __pyx_t_19; __pyx_t_18++){
                        {
                            __pyx_v_n = (long)(0 + 1 * __pyx_t_18);
                            /* Initialize private variables to invalid values */
                            __pyx_v_d = ((long)0xbad0bad0);
/* … */
      /*finally:*/ {
        /*normal exit:*/{
          #ifdef WITH_THREAD
          <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L8;
        }
        __pyx_L7_error: {
          #ifdef WITH_THREAD
          <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L1_error;
        }
        __pyx_L8:;
      }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">566</span>:                          schedule = 'dynamic', num_threads = nThreads):</pre>
<pre class="cython line score-0">&#xA0;<span class="">567</span>: </pre>
<pre class="cython line score-23" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">568</span>:         with gil: _, allNeighbours = model.neighboursAtDist(nodesIdx[n], distMax)</pre>
<pre class='cython code score-23 '>                            {
                                #ifdef WITH_THREAD
                                PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                                #endif
                                /*try:*/ {
                                  __pyx_t_20 = __pyx_v_n;
                                  if (__pyx_t_20 &lt; 0) __pyx_t_20 += __pyx_v_nodesIdx.shape[0];
                                  __pyx_t_2 = ((struct __pyx_vtabstruct_6Models_6models_Model *)__pyx_v_model-&gt;__pyx_vtab)-&gt;neighboursAtDist(__pyx_v_model, (*((long *) ( /* dim=0 */ ((char *) (((long *) __pyx_v_nodesIdx.data) + __pyx_t_20)) ))), __pyx_v_distMax, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 568, __pyx_L16_error)</span>
                                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
                                  if (likely(__pyx_t_2 != Py_None)) {
                                    PyObject* sequence = __pyx_t_2;
                                    Py_ssize_t size = <span class='pyx_c_api'>__Pyx_PySequence_SIZE</span>(sequence);
                                    if (unlikely(size != 2)) {
                                      if (size &gt; 2) <span class='pyx_c_api'>__Pyx_RaiseTooManyValuesError</span>(2);
                                      else if (size &gt;= 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(size);
                                      <span class='error_goto'>__PYX_ERR(0, 568, __pyx_L16_error)</span>
                                    }
                                    #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
                                    __pyx_t_3 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 0); 
                                    __pyx_t_8 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 1); 
                                    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
                                    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8);
                                    #else
                                    __pyx_t_3 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 568, __pyx_L16_error)</span>
                                    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
                                    __pyx_t_8 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 568, __pyx_L16_error)</span>
                                    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
                                    #endif
                                    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
                                  } else {
                                    <span class='pyx_c_api'>__Pyx_RaiseNoneNotIterableError</span>(); <span class='error_goto'>__PYX_ERR(0, 568, __pyx_L16_error)</span>
                                  }
                                  __pyx_t_21 = __pyx_convert_unordered_map_from_py_long__and_std_3a__3a_vector_3c_long_3e___(__pyx_t_8);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 568, __pyx_L16_error)</span>
                                  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
                                  <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v__, __pyx_t_3);
                                  __pyx_t_3 = 0;
                                  __pyx_v_allNeighbours = __pyx_t_21;
                                }
                                /*finally:*/ {
                                  /*normal exit:*/{
                                    #ifdef WITH_THREAD
                                    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                                    #endif
                                    goto __pyx_L17;
                                  }
                                  __pyx_L16_error: {
                                    #ifdef WITH_THREAD
                                    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                                    #endif
                                    goto __pyx_L11_error;
                                  }
                                  __pyx_L17:;
                                }
                            }
</pre><pre class="cython line score-0">&#xA0;<span class="">569</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">570</span>:         for d in range(distMax):</pre>
<pre class='cython code score-0 '>                            __pyx_t_12 = __pyx_v_distMax;
                            __pyx_t_22 = __pyx_t_12;
                            for (__pyx_t_23 = 0; __pyx_t_23 &lt; __pyx_t_22; __pyx_t_23+=1) {
                              __pyx_v_d = __pyx_t_23;
</pre><pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">571</span>:             MI[n][d] = MIAtDist(model, snapshots, entropies, nodesIdx[n], allNeighbours[d+1])</pre>
<pre class='cython code score-19 '>                              __pyx_t_24 = __pyx_v_n;
                              if (__pyx_t_24 &lt; 0) __pyx_t_24 += __pyx_v_nodesIdx.shape[0];
                              __pyx_t_17 = __pyx_f_7Toolbox_8infcyIDL_MIAtDist(__pyx_v_model, __pyx_v_snapshots, __pyx_v_entropies, (*((long *) ( /* dim=0 */ ((char *) (((long *) __pyx_v_nodesIdx.data) + __pyx_t_24)) ))), (__pyx_v_allNeighbours[(__pyx_v_d + 1)]), 0);<span class='error_goto'> if (unlikely(!__pyx_t_17.memview)) __PYX_ERR(0, 571, __pyx_L11_error)</span>
                              __pyx_t_25.data = __pyx_v_MI.data;
                              __pyx_t_25.memview = __pyx_v_MI.memview;
                              __PYX_INC_MEMVIEW(&amp;__pyx_t_25, 0);
                              {
    Py_ssize_t __pyx_tmp_idx = __pyx_v_n;
        Py_ssize_t __pyx_tmp_shape = __pyx_v_MI.shape[0];
    Py_ssize_t __pyx_tmp_stride = __pyx_v_MI.strides[0];
        if (__pyx_tmp_idx &lt; 0)
            __pyx_tmp_idx += __pyx_tmp_shape;
        if ((0)) <span class='error_goto'>__PYX_ERR(0, 571, __pyx_L11_error)</span>
        __pyx_t_25.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

{
    Py_ssize_t __pyx_tmp_idx = __pyx_v_d;
        Py_ssize_t __pyx_tmp_shape = __pyx_v_MI.shape[1];
    Py_ssize_t __pyx_tmp_stride = __pyx_v_MI.strides[1];
        if (__pyx_tmp_idx &lt; 0)
            __pyx_tmp_idx += __pyx_tmp_shape;
        if ((0)) <span class='error_goto'>__PYX_ERR(0, 571, __pyx_L11_error)</span>
        __pyx_t_25.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_25.shape[0] = __pyx_v_MI.shape[2];
__pyx_t_25.strides[0] = __pyx_v_MI.strides[2];
    __pyx_t_25.suboffsets[0] = -1;

if (unlikely(__pyx_memoryview_copy_contents(__pyx_t_17, __pyx_t_25, 1, 1, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 571, __pyx_L11_error)</span>
                              __PYX_XDEC_MEMVIEW(&amp;__pyx_t_25, 0);
                              __pyx_t_25.memview = NULL;
                              __pyx_t_25.data = NULL;
                              __PYX_XDEC_MEMVIEW(&amp;__pyx_t_17, 0);
                              __pyx_t_17.memview = NULL;
                              __pyx_t_17.data = NULL;
                            }
                            goto __pyx_L21;
                            __pyx_L11_error:;
                            {
                                #ifdef WITH_THREAD
                                PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                                #endif
                                #ifdef _OPENMP
                                #pragma omp flush(__pyx_parallel_exc_type)
                                #endif /* _OPENMP */
                                if (!__pyx_parallel_exc_type) {
                                  <span class='pyx_c_api'>__Pyx_ErrFetchWithState</span>(&amp;__pyx_parallel_exc_type, &amp;__pyx_parallel_exc_value, &amp;__pyx_parallel_exc_tb);
                                  __pyx_parallel_filename = __pyx_filename; __pyx_parallel_lineno = __pyx_lineno; __pyx_parallel_clineno = __pyx_clineno;
                                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_parallel_exc_type);
                                }
                                #ifdef WITH_THREAD
                                <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                                #endif
                            }
                            __pyx_parallel_why = 4;
                            goto __pyx_L20;
                            __pyx_L20:;
                            #ifdef _OPENMP
                            #pragma omp critical(__pyx_parallel_lastprivates5)
                            #endif /* _OPENMP */
                            {
                                __pyx_parallel_temp0 = __pyx_v_allNeighbours;
                                __pyx_parallel_temp1 = __pyx_v_d;
                                __pyx_parallel_temp2 = __pyx_v_n;
                            }
                            __pyx_L21:;
                            #ifdef _OPENMP
                            #pragma omp flush(__pyx_parallel_why)
                            #endif /* _OPENMP */
                        }
                    }
                    #ifdef _OPENMP
                    Py_END_ALLOW_THREADS
                    #else
{
#ifdef WITH_THREAD
                    PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                    #endif
                    #endif /* _OPENMP */
                    /* Clean up any temporaries */
                    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_17, 0);
                    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
                    __pyx_t_2 = NULL;
                    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_25, 0);
                    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
                    __pyx_t_3 = NULL;
                    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
                    __pyx_t_8 = NULL;
                    #ifdef WITH_THREAD
                    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                    #endif
                    #ifndef _OPENMP
}
#endif /* _OPENMP */
                }
            }
            if (__pyx_parallel_exc_type) {
              /* This may have been overridden by a continue, break or return in another thread. Prefer the error. */
              __pyx_parallel_why = 4;
            }
            if (__pyx_parallel_why) {
              __pyx_v_allNeighbours = __pyx_parallel_temp0;
              __pyx_v_d = __pyx_parallel_temp1;
              __pyx_v_n = __pyx_parallel_temp2;
              switch (__pyx_parallel_why) {
                    case 4:
                {
                    #ifdef WITH_THREAD
                    PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                    #endif
                    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_parallel_exc_type);
                    <span class='pyx_c_api'>__Pyx_ErrRestoreWithState</span>(__pyx_parallel_exc_type, __pyx_parallel_exc_value, __pyx_parallel_exc_tb);
                    __pyx_filename = __pyx_parallel_filename; __pyx_lineno = __pyx_parallel_lineno; __pyx_clineno = __pyx_parallel_clineno;
                    #ifdef WITH_THREAD
                    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                    #endif
                }
                goto __pyx_L7_error;
              }
            }
        }
        #if ((defined(__APPLE__) || defined(__OSX__)) &amp;&amp; (defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 2 || (__GNUC__ == 2 &amp;&amp; (__GNUC_MINOR__ &gt; 95)))))
            #undef likely
            #undef unlikely
            #define likely(x)   __builtin_expect(!!(x), 1)
            #define unlikely(x) __builtin_expect(!!(x), 0)
        #endif
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">572</span>: </pre>
<pre class="cython line score-80" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">573</span>:     degrees = [model.graph.degree(n) for n in nodes]</pre>
<pre class='cython code score-80 '>  { /* enter inner scope */
    __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 573, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    if (likely(<span class='py_c_api'>PyList_CheckExact</span>(((PyObject *)__pyx_v_nodes))) || <span class='py_c_api'>PyTuple_CheckExact</span>(((PyObject *)__pyx_v_nodes))) {
      __pyx_t_8 = ((PyObject *)__pyx_v_nodes); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8); __pyx_t_6 = 0;
      __pyx_t_7 = NULL;
    } else {
      __pyx_t_6 = -1; __pyx_t_8 = <span class='py_c_api'>PyObject_GetIter</span>(((PyObject *)__pyx_v_nodes));<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 573, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      __pyx_t_7 = Py_TYPE(__pyx_t_8)-&gt;tp_iternext;<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 573, __pyx_L1_error)</span>
    }
    for (;;) {
      if (likely(!__pyx_t_7)) {
        if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_8))) {
          if (__pyx_t_6 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_8)) break;
          #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_3 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_8, __pyx_t_6); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_6++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 573, __pyx_L1_error)</span>
          #else
          __pyx_t_3 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_8, __pyx_t_6); __pyx_t_6++;<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 573, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
          #endif
        } else {
          if (__pyx_t_6 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_8)) break;
          #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_3 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_8, __pyx_t_6); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_6++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 573, __pyx_L1_error)</span>
          #else
          __pyx_t_3 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_8, __pyx_t_6); __pyx_t_6++;<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 573, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
          #endif
        }
      } else {
        __pyx_t_3 = __pyx_t_7(__pyx_t_8);
        if (unlikely(!__pyx_t_3)) {
          PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
          if (exc_type) {
            if (likely(<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
            else <span class='error_goto'>__PYX_ERR(0, 573, __pyx_L1_error)</span>
          }
          break;
        }
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      }
      __pyx_t_19 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_3); if (unlikely((__pyx_t_19 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 573, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_8genexpr5__pyx_v_n = __pyx_t_19;
      __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(((PyObject *)__pyx_v_model), __pyx_n_s_graph);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 573, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_10, __pyx_n_s_degree);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 573, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_8genexpr5__pyx_v_n);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 573, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
      __pyx_t_4 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
        __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
        if (likely(__pyx_t_4)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
        }
      }
      __pyx_t_3 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_4, __pyx_t_10) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_5, __pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 573, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      if (unlikely(<span class='pyx_c_api'>__Pyx_ListComp_Append</span>(__pyx_t_2, (PyObject*)__pyx_t_3))) <span class='error_goto'>__PYX_ERR(0, 573, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  } /* exit inner scope */
  __pyx_v_degrees = ((PyObject*)__pyx_t_2);
  __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">574</span>: </pre>
<pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">575</span>:     return snapshots.base, MI.base, degrees</pre>
<pre class='cython code score-16 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_snapshots, 2, (PyObject *(*)(char *)) __pyx_memview_get_long, (int (*)(char *, PyObject *)) __pyx_memview_set_long, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 575, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_base);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 575, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_MI, 3, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 575, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_base);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 575, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 575, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_8);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, __pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_degrees);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_degrees);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 2, __pyx_v_degrees);
  __pyx_t_8 = 0;
  __pyx_t_3 = 0;
  __pyx_r = ((PyObject*)__pyx_t_2);
  __pyx_t_2 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">576</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">577</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">578</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">579</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">580</span>: @cython.wraparound(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">581</span>: @cython.nonecheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">582</span>: @cython.cdivision(True)</pre>
<pre class="cython line score-0">&#xA0;<span class="">583</span>: @cython.initializedcheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">584</span>: @cython.overflowcheck(False)</pre>
<pre class="cython line score-66" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">585</span>: cpdef np.ndarray magnetizationParallel(Model model,\</pre>
<pre class='cython code score-66 '>static PyObject *__pyx_pw_7Toolbox_8infcyIDL_27magnetizationParallel(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyArrayObject *__pyx_f_7Toolbox_8infcyIDL_magnetizationParallel(struct __pyx_obj_6Models_6models_Model *__pyx_v_model, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_7Toolbox_8infcyIDL_magnetizationParallel *__pyx_optional_args) {
  PyArrayObject *__pyx_v_temps = __pyx_k__8;
  long __pyx_v_n = __pyx_k__9;
  long __pyx_v_burninSamples = ((long)0x64);
  std::vector&lt;PyObjectHolder&gt;  __pyx_v_models_;
  struct __pyx_obj_6Models_6models_Model *__pyx_v_tmp = 0;
  CYTHON_UNUSED long __pyx_v_nNodes;
  long __pyx_v_t;
  int __pyx_v_tid;
  int __pyx_v_nThreads;
  long __pyx_v_nTemps;
  CYTHON_UNUSED long __pyx_v_totalSteps;
  double __pyx_v_m;
  std::vector&lt;double&gt;  __pyx_v_mag_sum;
  PyArrayObject *__pyx_v_betas = 0;
  __Pyx_memviewslice __pyx_v_cview_betas = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyArrayObject *__pyx_v_results = 0;
  __Pyx_memviewslice __pyx_v_cview_results = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_v_pbar = NULL;
  long __pyx_8genexpr6__pyx_v_t;
  PyArrayObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("magnetizationParallel", 0);
  if (__pyx_optional_args) {
    if (__pyx_optional_args-&gt;__pyx_n &gt; 0) {
      __pyx_v_temps = __pyx_optional_args-&gt;temps;
      if (__pyx_optional_args-&gt;__pyx_n &gt; 1) {
        __pyx_v_n = __pyx_optional_args-&gt;n;
        if (__pyx_optional_args-&gt;__pyx_n &gt; 2) {
          __pyx_v_burninSamples = __pyx_optional_args-&gt;burninSamples;
        }
      }
    }
  }
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_13, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_14, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_t_20));
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_21, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.magnetizationParallel", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_tmp);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_betas);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_cview_betas, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_results);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_cview_results, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_pbar);
  <span class='refnanny'>__Pyx_XGIVEREF</span>((PyObject *)__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_7Toolbox_8infcyIDL_27magnetizationParallel(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_7Toolbox_8infcyIDL_26magnetizationParallel[] = "\n    Computes the magnetization as a function of temperatures\n    Input:\n          :model: the model to use for simulations\n          :temps: a range of temperatures\n          :n:     number of samples to simulate for\n          :burninSamples: number of samples to throw away before sampling\n    Returns:\n          :temps: the temperature range as input\n          :mag:  the magnetization for t in temps\n          :sus:  the magnetic susceptibility\n    ";
static PyObject *__pyx_pw_7Toolbox_8infcyIDL_27magnetizationParallel(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_6Models_6models_Model *__pyx_v_model = 0;
  PyArrayObject *__pyx_v_temps = 0;
  long __pyx_v_n;
  long __pyx_v_burninSamples;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("magnetizationParallel (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_model,&amp;__pyx_n_s_temps,&amp;__pyx_n_s_n,&amp;__pyx_n_s_burninSamples,0};
    PyObject* values[4] = {0,0,0,0};
    values[1] = (PyObject *)__pyx_k__8;
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_model)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_temps);
          if (value) { values[1] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_n);
          if (value) { values[2] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_burninSamples);
          if (value) { values[3] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "magnetizationParallel") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 585, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_model = ((struct __pyx_obj_6Models_6models_Model *)values[0]);
    __pyx_v_temps = ((PyArrayObject *)values[1]);
    if (values[2]) {
      __pyx_v_n = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[2]); if (unlikely((__pyx_v_n == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 587, __pyx_L3_error)</span>
    } else {
      __pyx_v_n = __pyx_k__9;
    }
    if (values[3]) {
      __pyx_v_burninSamples = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[3]); if (unlikely((__pyx_v_burninSamples == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 588, __pyx_L3_error)</span>
    } else {
      __pyx_v_burninSamples = ((long)0x64);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("magnetizationParallel", 0, 1, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 585, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.magnetizationParallel", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_model), __pyx_ptype_6Models_6models_Model, 1, "model", 0))) <span class='error_goto'>__PYX_ERR(0, 585, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_temps), __pyx_ptype_5numpy_ndarray, 1, "temps", 0))) <span class='error_goto'>__PYX_ERR(0, 586, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_7Toolbox_8infcyIDL_26magnetizationParallel(__pyx_self, __pyx_v_model, __pyx_v_temps, __pyx_v_n, __pyx_v_burninSamples);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_7Toolbox_8infcyIDL_26magnetizationParallel(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6Models_6models_Model *__pyx_v_model, PyArrayObject *__pyx_v_temps, long __pyx_v_n, long __pyx_v_burninSamples) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("magnetizationParallel", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_2.__pyx_n = 3;
  __pyx_t_2.temps = __pyx_v_temps;
  __pyx_t_2.n = __pyx_v_n;
  __pyx_t_2.burninSamples = __pyx_v_burninSamples;
  __pyx_t_1 = ((PyObject *)__pyx_f_7Toolbox_8infcyIDL_magnetizationParallel(__pyx_v_model, 0, &amp;__pyx_t_2));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 585, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.magnetizationParallel", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
struct __pyx_opt_args_7Toolbox_8infcyIDL_magnetizationParallel {
  int __pyx_n;
  PyArrayObject *temps;
  long n;
  long burninSamples;
};
</pre><pre class="cython line score-25" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">586</span>:                           np.ndarray temps  = np.logspace(-3, 2, 20),\</pre>
<pre class='cython code score-25 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 586, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_logspace);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 586, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_tuple__43, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 586, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 586, __pyx_L1_error)</span>
  __pyx_k__8 = ((PyArrayObject *)__pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  __pyx_t_2 = 0;
/* … */
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 586, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_logspace);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 586, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_tuple__43, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 586, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 586, __pyx_L1_error)</span>
  __pyx_k__8 = ((PyArrayObject *)__pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  __pyx_t_2 = 0;
/* … */
  __pyx_tuple__43 = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_int_neg_3, __pyx_int_2, __pyx_int_20);<span class='error_goto'> if (unlikely(!__pyx_tuple__43)) __PYX_ERR(0, 586, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__43);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__43);
</pre><pre class="cython line score-20" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">587</span>:                       long n             = int(1e3),\</pre>
<pre class='cython code score-20 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyNumber_Int</span>(__pyx_float_1e3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 587, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_2); if (unlikely((__pyx_t_3 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 587, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_k__9 = __pyx_t_3;
/* … */
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyNumber_Int</span>(__pyx_float_1e3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 587, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_2); if (unlikely((__pyx_t_3 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 587, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_k__9 = __pyx_t_3;
</pre><pre class="cython line score-0">&#xA0;<span class="">588</span>:                       long burninSamples = 100):</pre>
<pre class="cython line score-0">&#xA0;<span class="">589</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">590</span>:     Computes the magnetization as a function of temperatures</pre>
<pre class="cython line score-0">&#xA0;<span class="">591</span>:     Input:</pre>
<pre class="cython line score-0">&#xA0;<span class="">592</span>:           :model: the model to use for simulations</pre>
<pre class="cython line score-0">&#xA0;<span class="">593</span>:           :temps: a range of temperatures</pre>
<pre class="cython line score-0">&#xA0;<span class="">594</span>:           :n:     number of samples to simulate for</pre>
<pre class="cython line score-0">&#xA0;<span class="">595</span>:           :burninSamples: number of samples to throw away before sampling</pre>
<pre class="cython line score-0">&#xA0;<span class="">596</span>:     Returns:</pre>
<pre class="cython line score-0">&#xA0;<span class="">597</span>:           :temps: the temperature range as input</pre>
<pre class="cython line score-0">&#xA0;<span class="">598</span>:           :mag:  the magnetization for t in temps</pre>
<pre class="cython line score-0">&#xA0;<span class="">599</span>:           :sus:  the magnetic susceptibility</pre>
<pre class="cython line score-0">&#xA0;<span class="">600</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">601</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">602</span>:     # if workload is small, use serial implementation</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">603</span>:     if n &lt; 1e4:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_n &lt; 1e4) != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-50" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">604</span>:         return model.matchMagnetization(temps, n, burninSamples)</pre>
<pre class='cython code score-50 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(((PyObject *)__pyx_v_model), __pyx_n_s_matchMagnetization);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 604, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_n);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 604, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_burninSamples);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 604, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_6 = NULL;
    __pyx_t_7 = 0;
    if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
      __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
      if (likely(__pyx_t_6)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
        __pyx_t_7 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_3)) {
      PyObject *__pyx_temp[4] = {__pyx_t_6, ((PyObject *)__pyx_v_temps), __pyx_t_4, __pyx_t_5};
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 604, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_3)) {
      PyObject *__pyx_temp[4] = {__pyx_t_6, ((PyObject *)__pyx_v_temps), __pyx_t_4, __pyx_t_5};
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 604, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    } else
    #endif
    {
      __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(3+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 604, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      if (__pyx_t_6) {
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_6); __pyx_t_6 = NULL;
      }
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_temps));
      <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_temps));
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0+__pyx_t_7, ((PyObject *)__pyx_v_temps));
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 1+__pyx_t_7, __pyx_t_4);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 2+__pyx_t_7, __pyx_t_5);
      __pyx_t_4 = 0;
      __pyx_t_5 = 0;
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_8, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 604, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 604, __pyx_L1_error)</span>
    __pyx_r = ((PyArrayObject *)__pyx_t_2);
    __pyx_t_2 = 0;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">605</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">606</span>:     # otherwise parallel is faster</pre>
<pre class="cython line score-0">&#xA0;<span class="">607</span>:     cdef:</pre>
<pre class="cython line score-0">&#xA0;<span class="">608</span>:         vector[PyObjectHolder] models_</pre>
<pre class="cython line score-0">&#xA0;<span class="">609</span>:         Model tmp</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">610</span>:         long idx, nNodes = model._nNodes, t, step, start</pre>
<pre class='cython code score-0 '>  __pyx_t_7 = __pyx_v_model-&gt;_nNodes;
  __pyx_v_nNodes = __pyx_t_7;
</pre><pre class="cython line score-29" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">611</span>:         int tid, nThreads = mp.cpu_count()</pre>
<pre class='cython code score-29 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_mp);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 611, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_cpu_count);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 611, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_8))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_8);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_8, function);
    }
  }
  __pyx_t_2 = (__pyx_t_3) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_8, __pyx_t_3) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 611, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_2); if (unlikely((__pyx_t_7 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 611, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_nThreads = __pyx_t_7;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">612</span>:         long nTemps = temps.shape[0]</pre>
<pre class='cython code score-0 '>  __pyx_v_nTemps = (__pyx_v_temps-&gt;dimensions[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">613</span>:         long totalSteps = n + burninSamples</pre>
<pre class='cython code score-0 '>  __pyx_v_totalSteps = (__pyx_v_n + __pyx_v_burninSamples);
</pre><pre class="cython line score-0">&#xA0;<span class="">614</span>:         double m</pre>
<pre class="cython line score-0">&#xA0;<span class="">615</span>:         vector[double] mag_sum</pre>
<pre class="cython line score-87" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">616</span>:         np.ndarray betas = np.array([1 / t if t != 0 else np.inf for t in temps])</pre>
<pre class='cython code score-87 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_8, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 616, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 616, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  { /* enter inner scope */
    __pyx_t_8 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 616, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    if (likely(<span class='py_c_api'>PyList_CheckExact</span>(((PyObject *)__pyx_v_temps))) || <span class='py_c_api'>PyTuple_CheckExact</span>(((PyObject *)__pyx_v_temps))) {
      __pyx_t_5 = ((PyObject *)__pyx_v_temps); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_9 = 0;
      __pyx_t_10 = NULL;
    } else {
      __pyx_t_9 = -1; __pyx_t_5 = <span class='py_c_api'>PyObject_GetIter</span>(((PyObject *)__pyx_v_temps));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 616, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      __pyx_t_10 = Py_TYPE(__pyx_t_5)-&gt;tp_iternext;<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 616, __pyx_L1_error)</span>
    }
    for (;;) {
      if (likely(!__pyx_t_10)) {
        if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_5))) {
          if (__pyx_t_9 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_5)) break;
          #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_4 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_5, __pyx_t_9); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4); __pyx_t_9++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 616, __pyx_L1_error)</span>
          #else
          __pyx_t_4 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_5, __pyx_t_9); __pyx_t_9++;<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 616, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
          #endif
        } else {
          if (__pyx_t_9 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_5)) break;
          #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_4 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_5, __pyx_t_9); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4); __pyx_t_9++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 616, __pyx_L1_error)</span>
          #else
          __pyx_t_4 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_5, __pyx_t_9); __pyx_t_9++;<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 616, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
          #endif
        }
      } else {
        __pyx_t_4 = __pyx_t_10(__pyx_t_5);
        if (unlikely(!__pyx_t_4)) {
          PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
          if (exc_type) {
            if (likely(<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
            else <span class='error_goto'>__PYX_ERR(0, 616, __pyx_L1_error)</span>
          }
          break;
        }
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      }
      __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_4); if (unlikely((__pyx_t_11 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 616, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_8genexpr6__pyx_v_t = __pyx_t_11;
      if (((__pyx_8genexpr6__pyx_v_t != 0) != 0)) {
        __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((1 / __pyx_8genexpr6__pyx_v_t));<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 616, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
        __pyx_t_4 = __pyx_t_6;
        __pyx_t_6 = 0;
      } else {
        <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_6, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 616, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
        __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_inf);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 616, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
        __pyx_t_4 = __pyx_t_12;
        __pyx_t_12 = 0;
      }
      if (unlikely(<span class='pyx_c_api'>__Pyx_ListComp_Append</span>(__pyx_t_8, (PyObject*)__pyx_t_4))) <span class='error_goto'>__PYX_ERR(0, 616, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  } /* exit inner scope */
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_5)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_5, __pyx_t_8) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 616, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 616, __pyx_L1_error)</span>
  __pyx_v_betas = ((PyArrayObject *)__pyx_t_2);
  __pyx_t_2 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">617</span>:         double[::1] cview_betas = betas</pre>
<pre class='cython code score-2 '>  __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dc_double</span>(((PyObject *)__pyx_v_betas), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_13.memview)) __PYX_ERR(0, 617, __pyx_L1_error)</span>
  __pyx_v_cview_betas = __pyx_t_13;
  __pyx_t_13.memview = NULL;
  __pyx_t_13.data = NULL;
</pre><pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">618</span>:         np.ndarray results = np.zeros((2, nTemps))</pre>
<pre class='cython code score-32 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 618, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 618, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_nTemps);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 618, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 618, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_int_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1, __pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_8))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_8);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_8, function);
    }
  }
  __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_8, __pyx_t_3, __pyx_t_5) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_8, __pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 618, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 618, __pyx_L1_error)</span>
  __pyx_v_results = ((PyArrayObject *)__pyx_t_2);
  __pyx_t_2 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">619</span>:         double[:,::1] cview_results = results</pre>
<pre class='cython code score-2 '>  __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_d_dc_double</span>(((PyObject *)__pyx_v_results), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_14.memview)) __PYX_ERR(0, 619, __pyx_L1_error)</span>
  __pyx_v_cview_results = __pyx_t_14;
  __pyx_t_14.memview = NULL;
  __pyx_t_14.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">620</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">621</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">622</span>:     # threadsafe model access</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">623</span>:     for tid in range(nThreads):</pre>
<pre class='cython code score-0 '>  __pyx_t_7 = __pyx_v_nThreads;
  __pyx_t_15 = __pyx_t_7;
  for (__pyx_t_16 = 0; __pyx_t_16 &lt; __pyx_t_15; __pyx_t_16+=1) {
    __pyx_v_tid = __pyx_t_16;
</pre><pre class="cython line score-22" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">624</span>:         tmp = copy.deepcopy(model)</pre>
<pre class='cython code score-22 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_8, __pyx_n_s_copy);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 624, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_deepcopy);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 624, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
      __pyx_t_8 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
      if (likely(__pyx_t_8)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
      }
    }
    __pyx_t_2 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_8, ((PyObject *)__pyx_v_model)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_5, ((PyObject *)__pyx_v_model));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 624, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_6Models_6models_Model))))) <span class='error_goto'>__PYX_ERR(0, 624, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_tmp, ((struct __pyx_obj_6Models_6models_Model *)__pyx_t_2));
    __pyx_t_2 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">625</span>:         models_.push_back(PyObjectHolder(&lt;PyObject *&gt; tmp))</pre>
<pre class='cython code score-0 '>    try {
      __pyx_v_models_.push_back(PyObjectHolder(((PyObject *)__pyx_v_tmp)));
    } catch(...) {
      __Pyx_CppExn2PyErr();
      <span class='error_goto'>__PYX_ERR(0, 625, __pyx_L1_error)</span>
    }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">626</span>: </pre>
<pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">627</span>:     pbar = tqdm(total = nTemps)</pre>
<pre class='cython code score-16 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_tqdm);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 627, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 627, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_nTemps);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 627, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_total, __pyx_t_8) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 627, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_empty_tuple, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 627, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_v_pbar = __pyx_t_8;
  __pyx_t_8 = 0;
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">628</span>:     for t in prange(nTemps, nogil = True, \</pre>
<pre class='cython code score-6 '>  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      <span class='pyx_c_api'>__Pyx_FastGIL_Remember</span>();
      #endif
      /*try:*/ {
        __pyx_t_11 = __pyx_v_nTemps;
        if (1 == 0) abort();
        {
            #if ((defined(__APPLE__) || defined(__OSX__)) &amp;&amp; (defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 2 || (__GNUC__ == 2 &amp;&amp; (__GNUC_MINOR__ &gt; 95)))))
                #undef likely
                #undef unlikely
                #define likely(x)   (x)
                #define unlikely(x) (x)
            #endif
            __pyx_t_18 = (__pyx_t_11 - 0 + 1 - 1/abs(1)) / 1;
            if (__pyx_t_18 &gt; 0)
            {
                #ifdef _OPENMP
                #pragma omp parallel
                #endif /* _OPENMP */
                {
                    #ifdef _OPENMP
                    #pragma omp for lastprivate(__pyx_v_m) lastprivate(__pyx_v_mag_sum) firstprivate(__pyx_v_t) lastprivate(__pyx_v_t) lastprivate(__pyx_v_tid) schedule(static)        __pyx_t_11 = __pyx_v_nTemps;
        if (1 == 0) abort();
        {
            #if ((defined(__APPLE__) || defined(__OSX__)) &amp;&amp; (defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 2 || (__GNUC__ == 2 &amp;&amp; (__GNUC_MINOR__ &gt; 95)))))
                #undef likely
                #undef unlikely
                #define likely(x)   (x)
                #define unlikely(x) (x)
            #endif
            __pyx_t_18 = (__pyx_t_11 - 0 + 1 - 1/abs(1)) / 1;
            if (__pyx_t_18 &gt; 0)
            {
                #ifdef _OPENMP
                #pragma omp parallel
                #endif /* _OPENMP */
                {
                    #ifdef _OPENMP
                    #pragma omp for lastprivate(__pyx_v_m) lastprivate(__pyx_v_mag_sum) firstprivate(__pyx_v_t) lastprivate(__pyx_v_t) lastprivate(__pyx_v_tid) schedule(static) num_threads(__pyx_v_nThreads)
                    #endif /* _OPENMP */
                    for (__pyx_t_17 = 0; __pyx_t_17 &lt; __pyx_t_18; __pyx_t_17++){
                        {
                            __pyx_v_t = (long)(0 + 1 * __pyx_t_17);
                            /* Initialize private variables to invalid values */
                            __pyx_v_m = ((double)__PYX_NAN());
                            __pyx_v_tid = ((int)0xbad0bad0);
/* … */
      /*finally:*/ {
        /*normal exit:*/{
          #ifdef WITH_THREAD
          <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L10;
        }
        __pyx_L9_error: {
          #ifdef WITH_THREAD
          <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L1_error;
        }
        __pyx_L10:;
      }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">629</span>:                          schedule = 'static', num_threads = nThreads): # simulate with different temps in parallel</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">630</span>:         tid = threadid()</pre>
<pre class='cython code score-0 '>                            #ifdef _OPENMP
                            __pyx_t_7 = omp_get_thread_num();
                            #else
                            __pyx_t_7 = 0;
                            #endif
                            __pyx_v_tid = __pyx_t_7;
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">631</span>:         with gil:</pre>
<pre class='cython code score-6 '>                            {
                                #ifdef WITH_THREAD
                                PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                                #endif
                                /*try:*/ {
/* … */
                                /*finally:*/ {
                                  /*normal exit:*/{
                                    #ifdef WITH_THREAD
                                    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                                    #endif
                                    goto __pyx_L19;
                                  }
                                  __pyx_L18_error: {
                                    #ifdef WITH_THREAD
                                    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                                    #endif
                                    goto __pyx_L13_error;
                                  }
                                  __pyx_L19:;
                                }
                            }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">632</span>:             (&lt;Model&gt;models_[tid].ptr).reset()</pre>
<pre class='cython code score-0 '>                                  __pyx_t_19 = (__pyx_v_models_[__pyx_v_tid]).ptr;
                                  ((struct __pyx_vtabstruct_6Models_6models_Model *)((struct __pyx_obj_6Models_6models_Model *)__pyx_t_19)-&gt;__pyx_vtab)-&gt;reset(((struct __pyx_obj_6Models_6models_Model *)__pyx_t_19), 0);
</pre><pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">633</span>:             (&lt;Model&gt;models_[tid].ptr).seed += t</pre>
<pre class='cython code score-16 '>                                  __pyx_t_19 = (__pyx_v_models_[__pyx_v_tid]).ptr;
                                  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)((struct __pyx_obj_6Models_6models_Model *)__pyx_t_19)));
                                  __pyx_t_20 = ((struct __pyx_obj_6Models_6models_Model *)__pyx_t_19);
                                  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(((PyObject *)__pyx_t_20), __pyx_n_s_seed);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 633, __pyx_L18_error)</span>
                                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
                                  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_t);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 633, __pyx_L18_error)</span>
                                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
                                  __pyx_t_2 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_8, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 633, __pyx_L18_error)</span>
                                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
                                  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
                                  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
                                  if (<span class='pyx_c_api'>__Pyx_PyObject_SetAttrStr</span>(((PyObject *)__pyx_t_20), __pyx_n_s_seed, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 633, __pyx_L18_error)</span>
                                  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
                                  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_20)); __pyx_t_20 = 0;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">634</span>:             (&lt;Model&gt;models_[tid].ptr).t = temps[t]</pre>
<pre class='cython code score-5 '>                                  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(((PyObject *)__pyx_v_temps), __pyx_v_t, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 634, __pyx_L18_error)</span>
                                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
                                  __pyx_t_19 = (__pyx_v_models_[__pyx_v_tid]).ptr;
                                  if (<span class='pyx_c_api'>__Pyx_PyObject_SetAttrStr</span>(((PyObject *)__pyx_t_19), __pyx_n_s_t, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 634, __pyx_L18_error)</span>
                                  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
                                }
</pre><pre class="cython line score-0">&#xA0;<span class="">635</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">636</span>:         # simulate until equilibrium reached</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">637</span>:         (&lt;Model&gt;models_[tid].ptr).simulateNSteps(burninSamples)</pre>
<pre class='cython code score-0 '>                            __pyx_t_19 = (__pyx_v_models_[__pyx_v_tid]).ptr;
                            __pyx_t_21 = ((struct __pyx_vtabstruct_6Models_6models_Model *)((struct __pyx_obj_6Models_6models_Model *)__pyx_t_19)-&gt;__pyx_vtab)-&gt;simulateNSteps(((struct __pyx_obj_6Models_6models_Model *)__pyx_t_19), __pyx_v_burninSamples);<span class='error_goto'> if (unlikely(!__pyx_t_21.memview)) __PYX_ERR(0, 637, __pyx_L13_error)</span>
                            __PYX_XDEC_MEMVIEW(&amp;__pyx_t_21, 0);
                            __pyx_t_21.memview = NULL;
                            __pyx_t_21.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">638</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">639</span>:         mag_sum = simulateGetMeanMag((&lt;Model&gt;models_[tid].ptr), n)</pre>
<pre class='cython code score-0 '>                            __pyx_t_19 = (__pyx_v_models_[__pyx_v_tid]).ptr;
                            __pyx_t_23.__pyx_n = 1;
                            __pyx_t_23.nSamples = __pyx_v_n;
                            __pyx_t_22 = __pyx_f_7Toolbox_8infcyIDL_simulateGetMeanMag(((struct __pyx_obj_6Models_6models_Model *)__pyx_t_19), &amp;__pyx_t_23); 
                            __pyx_v_mag_sum = __pyx_t_22;
</pre><pre class="cython line score-0">&#xA0;<span class="">640</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">641</span>:         m = mag_sum[0] / n</pre>
<pre class='cython code score-0 '>                            __pyx_v_m = (((double)(__pyx_v_mag_sum[0])) / ((double)__pyx_v_n));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">642</span>:         cview_results[0][t] = m if m &gt; 0 else -m</pre>
<pre class='cython code score-0 '>                            if (((__pyx_v_m &gt; 0.0) != 0)) {
                              __pyx_t_24 = __pyx_v_m;
                            } else {
                              __pyx_t_24 = (-__pyx_v_m);
                            }
                            __pyx_t_25 = 0;
                            __pyx_t_26 = __pyx_v_t;
                            *((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_cview_results.data + __pyx_t_25 * __pyx_v_cview_results.strides[0]) )) + __pyx_t_26)) )) = __pyx_t_24;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">643</span>:         cview_results[1][t] = ((mag_sum[1] / n) - (m * m)) * cview_betas[t] #* (&lt;Model&gt; models_[t].ptr).beta</pre>
<pre class='cython code score-0 '>                            __pyx_t_27 = __pyx_v_t;
                            __pyx_t_28 = 1;
                            __pyx_t_29 = __pyx_v_t;
                            *((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_cview_results.data + __pyx_t_28 * __pyx_v_cview_results.strides[0]) )) + __pyx_t_29)) )) = (((((double)(__pyx_v_mag_sum[1])) / ((double)__pyx_v_n)) - (__pyx_v_m * __pyx_v_m)) * (*((double *) ( /* dim=0 */ ((char *) (((double *) __pyx_v_cview_betas.data) + __pyx_t_27)) ))));
</pre><pre class="cython line score-0">&#xA0;<span class="">644</span>: </pre>
<pre class="cython line score-26" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">645</span>:         with gil:</pre>
<pre class='cython code score-26 '>                            {
                                #ifdef WITH_THREAD
                                PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                                #endif
                                /*try:*/ {
/* … */
                                /*finally:*/ {
                                  /*normal exit:*/{
                                    #ifdef WITH_THREAD
                                    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                                    #endif
                                    goto __pyx_L24;
                                  }
                                  __pyx_L23_error: {
                                    #ifdef WITH_THREAD
                                    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                                    #endif
                                    goto __pyx_L13_error;
                                  }
                                  __pyx_L24:;
                                }
                            }
                            goto __pyx_L26;
                            __pyx_L13_error:;
                            {
                                #ifdef WITH_THREAD
                                PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                                #endif
                                #ifdef _OPENMP
                                #pragma omp flush(__pyx_parallel_exc_type)
                                #endif /* _OPENMP */
                                if (!__pyx_parallel_exc_type) {
                                  <span class='pyx_c_api'>__Pyx_ErrFetchWithState</span>(&amp;__pyx_parallel_exc_type, &amp;__pyx_parallel_exc_value, &amp;__pyx_parallel_exc_tb);
                                  __pyx_parallel_filename = __pyx_filename; __pyx_parallel_lineno = __pyx_lineno; __pyx_parallel_clineno = __pyx_clineno;
                                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_parallel_exc_type);
                                }
                                #ifdef WITH_THREAD
                                <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                                #endif
                            }
                            __pyx_parallel_why = 4;
                            goto __pyx_L25;
                            __pyx_L25:;
                            #ifdef _OPENMP
                            #pragma omp critical(__pyx_parallel_lastprivates6)
                            #endif /* _OPENMP */
                            {
                                __pyx_parallel_temp0 = __pyx_v_m;
                                __pyx_parallel_temp1 = __pyx_v_mag_sum;
                                __pyx_parallel_temp2 = __pyx_v_t;
                                __pyx_parallel_temp3 = __pyx_v_tid;
                            }
                            __pyx_L26:;
                            #ifdef _OPENMP
                            #pragma omp flush(__pyx_parallel_why)
                            #endif /* _OPENMP */
                        }
                    }
                    #ifdef _OPENMP
                    Py_END_ALLOW_THREADS
                    #else
{
#ifdef WITH_THREAD
                    PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                    #endif
                    #endif /* _OPENMP */
                    /* Clean up any temporaries */
                    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
                    __pyx_t_2 = NULL;
                    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_t_20));
                    __pyx_t_20 = NULL;
                    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_21, 0);
                    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
                    __pyx_t_5 = NULL;
                    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
                    __pyx_t_8 = NULL;
                    #ifdef WITH_THREAD
                    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                    #endif
                    #ifndef _OPENMP
}
#endif /* _OPENMP */
                }
            }
            if (__pyx_parallel_exc_type) {
              /* This may have been overridden by a continue, break or return in another thread. Prefer the error. */
              __pyx_parallel_why = 4;
            }
            if (__pyx_parallel_why) {
              __pyx_v_m = __pyx_parallel_temp0;
              __pyx_v_mag_sum = __pyx_parallel_temp1;
              __pyx_v_t = __pyx_parallel_temp2;
              __pyx_v_tid = __pyx_parallel_temp3;
              switch (__pyx_parallel_why) {
                    case 4:
                {
                    #ifdef WITH_THREAD
                    PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                    #endif
                    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_parallel_exc_type);
                    <span class='pyx_c_api'>__Pyx_ErrRestoreWithState</span>(__pyx_parallel_exc_type, __pyx_parallel_exc_value, __pyx_parallel_exc_tb);
                    __pyx_filename = __pyx_parallel_filename; __pyx_lineno = __pyx_parallel_lineno; __pyx_clineno = __pyx_parallel_clineno;
                    #ifdef WITH_THREAD
                    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                    #endif
                }
                goto __pyx_L9_error;
              }
            }
        }
        #if ((defined(__APPLE__) || defined(__OSX__)) &amp;&amp; (defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 2 || (__GNUC__ == 2 &amp;&amp; (__GNUC_MINOR__ &gt; 95)))))
            #undef likely
            #undef unlikely
            #define likely(x)   __builtin_expect(!!(x), 1)
            #define unlikely(x) __builtin_expect(!!(x), 0)
        #endif
      }
</pre><pre class="cython line score-17" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">646</span>:             pbar.update(1)</pre>
<pre class='cython code score-17 '>                                  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_pbar, __pyx_n_s_update);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 646, __pyx_L23_error)</span>
                                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
                                  __pyx_t_8 = NULL;
                                  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
                                    __pyx_t_8 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
                                    if (likely(__pyx_t_8)) {
                                      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
                                      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8);
                                      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
                                      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
                                    }
                                  }
                                  __pyx_t_2 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_8, __pyx_int_1) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_5, __pyx_int_1);
                                  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
                                  if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 646, __pyx_L23_error)</span>
                                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
                                  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
                                  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
                                }
</pre><pre class="cython line score-0">&#xA0;<span class="">647</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">648</span>:     return results</pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_results));
  __pyx_r = __pyx_v_results;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">649</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">650</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">651</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">652</span>: @cython.wraparound(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">653</span>: @cython.nonecheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">654</span>: #@cython.cdivision(True)</pre>
<pre class="cython line score-0">&#xA0;<span class="">655</span>: @cython.initializedcheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">656</span>: @cython.overflowcheck(False)</pre>
<pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">657</span>: cpdef np.ndarray autocorrelation(np.ndarray timeSeries):</pre>
<pre class='cython code score-14 '>static PyObject *__pyx_pw_7Toolbox_8infcyIDL_29autocorrelation(PyObject *__pyx_self, PyObject *__pyx_v_timeSeries); /*proto*/
static PyArrayObject *__pyx_f_7Toolbox_8infcyIDL_autocorrelation(PyArrayObject *__pyx_v_timeSeries, CYTHON_UNUSED int __pyx_skip_dispatch) {
  int __pyx_v_padding;
  PyArrayObject *__pyx_v_autocorr = 0;
  PyArrayObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("autocorrelation", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.autocorrelation", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_autocorr);
  <span class='refnanny'>__Pyx_XGIVEREF</span>((PyObject *)__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_7Toolbox_8infcyIDL_29autocorrelation(PyObject *__pyx_self, PyObject *__pyx_v_timeSeries); /*proto*/
static PyObject *__pyx_pw_7Toolbox_8infcyIDL_29autocorrelation(PyObject *__pyx_self, PyObject *__pyx_v_timeSeries) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("autocorrelation (wrapper)", 0);
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_timeSeries), __pyx_ptype_5numpy_ndarray, 1, "timeSeries", 0))) <span class='error_goto'>__PYX_ERR(0, 657, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_7Toolbox_8infcyIDL_28autocorrelation(__pyx_self, ((PyArrayObject *)__pyx_v_timeSeries));

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_7Toolbox_8infcyIDL_28autocorrelation(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_timeSeries) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("autocorrelation", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = ((PyObject *)__pyx_f_7Toolbox_8infcyIDL_autocorrelation(__pyx_v_timeSeries, 0));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 657, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.autocorrelation", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">658</span>:     cdef:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">659</span>:         int padding = 1</pre>
<pre class='cython code score-0 '>  __pyx_v_padding = 1;
</pre><pre class="cython line score-0">&#xA0;<span class="">660</span>:         np.ndarray autocorr</pre>
<pre class="cython line score-0">&#xA0;<span class="">661</span>:         double corrTime</pre>
<pre class="cython line score-0">&#xA0;<span class="">662</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">663</span>:     # get next power of two for padding</pre>
<pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">664</span>:     while padding &lt; timeSeries.size:</pre>
<pre class='cython code score-14 '>  while (1) {
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_padding);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 664, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(((PyObject *)__pyx_v_timeSeries), __pyx_n_s_size);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 664, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_3 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_1, __pyx_t_2, Py_LT); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 664, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_3); if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 664, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    if (!__pyx_t_4) break;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">665</span>:         padding = padding &lt;&lt; 1</pre>
<pre class='cython code score-0 '>    __pyx_v_padding = (__pyx_v_padding &lt;&lt; 1);
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">666</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">667</span>:     # use discrete fourier transform for faster computation of autocorrelation</pre>
<pre class="cython line score-56" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">668</span>:     autocorr = np.fft.fft(timeSeries - np.mean(timeSeries), n=2*padding)</pre>
<pre class='cython code score-56 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 668, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_fft);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 668, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_fft);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 668, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 668, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_mean);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 668, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
    __pyx_t_1 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
    if (likely(__pyx_t_1)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
    }
  }
  __pyx_t_2 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_1, ((PyObject *)__pyx_v_timeSeries)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_5, ((PyObject *)__pyx_v_timeSeries));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 668, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyNumber_Subtract</span>(((PyObject *)__pyx_v_timeSeries), __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 668, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 668, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_5);
  __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 668, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((2 * __pyx_v_padding));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 668, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_n, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 668, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_2, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 668, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 668, __pyx_L1_error)</span>
  __pyx_v_autocorr = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-54" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">669</span>:     autocorr = np.fft.ifft(autocorr * np.conjugate(autocorr)).real</pre>
<pre class='cython code score-54 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 669, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_fft);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 669, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_ifft);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 669, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 669, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_conjugate);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 669, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_6))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_6);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_6, function);
    }
  }
  __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_3, ((PyObject *)__pyx_v_autocorr)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_6, ((PyObject *)__pyx_v_autocorr));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 669, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = <span class='py_c_api'>PyNumber_Multiply</span>(((PyObject *)__pyx_v_autocorr), __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 669, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
    __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
    if (likely(__pyx_t_2)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
    }
  }
  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_2, __pyx_t_6) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_5, __pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 669, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_real);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 669, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 669, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_autocorr, ((PyArrayObject *)__pyx_t_5));
  __pyx_t_5 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">670</span>:     if autocorr[0] == 0:</pre>
<pre class='cython code score-8 '>  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(((PyObject *)__pyx_v_autocorr), 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 670, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_EqObjC</span>(__pyx_t_5, __pyx_int_0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 670, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_1); if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 670, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_4) {
/* … */
    goto __pyx_L5;
  }
</pre><pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">671</span>:         print(timeSeries)</pre>
<pre class='cython code score-3 '>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_builtin_print, ((PyObject *)__pyx_v_timeSeries));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 671, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-25" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">672</span>:         autocorr = np.ones(autocorr.size)</pre>
<pre class='cython code score-25 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 672, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_ones);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 672, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(((PyObject *)__pyx_v_autocorr), __pyx_n_s_size);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 672, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_2 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_6))) {
      __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_6);
      if (likely(__pyx_t_2)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_6);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_6, function);
      }
    }
    __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_2, __pyx_t_5) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_6, __pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 672, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 672, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_autocorr, ((PyArrayObject *)__pyx_t_1));
    __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">673</span>:     else:</pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">674</span>:         autocorr /= autocorr[0] # normalize</pre>
<pre class='cython code score-8 '>  /*else*/ {
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(((PyObject *)__pyx_v_autocorr), 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 674, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyNumber_InPlaceDivide</span>(((PyObject *)__pyx_v_autocorr), __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 674, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 674, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_autocorr, ((PyArrayObject *)__pyx_t_6));
    __pyx_t_6 = 0;
  }
  __pyx_L5:;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">675</span>:     autocorr = autocorr[:timeSeries.size]</pre>
<pre class='cython code score-8 '>  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(((PyObject *)__pyx_v_timeSeries), __pyx_n_s_size);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 675, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetSlice</span>(((PyObject *)__pyx_v_autocorr), 0, 0, NULL, &amp;__pyx_t_6, NULL, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 675, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 675, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_autocorr, ((PyArrayObject *)__pyx_t_1));
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">676</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">677</span>:     return autocorr</pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_autocorr));
  __pyx_r = __pyx_v_autocorr;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">678</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">679</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">680</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">681</span>: #@cython.wraparound(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">682</span>: @cython.nonecheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">683</span>: @cython.cdivision(True)</pre>
<pre class="cython line score-0">&#xA0;<span class="">684</span>: @cython.initializedcheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">685</span>: @cython.overflowcheck(False)</pre>
<pre class="cython line score-95" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">686</span>: cpdef tuple determineMixingTime(Model model,\</pre>
<pre class='cython code score-95 '>static PyObject *__pyx_pw_7Toolbox_8infcyIDL_31determineMixingTime(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_7Toolbox_8infcyIDL_determineMixingTime(struct __pyx_obj_6Models_6models_Model *__pyx_v_model, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_7Toolbox_8infcyIDL_determineMixingTime *__pyx_optional_args) {
  long __pyx_v_burninSteps = ((long)0x64);
  long __pyx_v_nStepsRegress = __pyx_k__10;
  double __pyx_v_threshold = ((double)0.05);
  long __pyx_v_nStepsCorr = __pyx_k__11;
  int __pyx_v_checkMixing = ((int)1);
  long __pyx_v_nNodes;
  __Pyx_memviewslice __pyx_v_mags = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyArrayObject *__pyx_v_allMags = 0;
  long __pyx_v_counter;
  long __pyx_v_mixingTime;
  PyArrayObject *__pyx_v_magSeries = 0;
  PyArrayObject *__pyx_v_autocorr = 0;
  PyArrayObject *__pyx_v_x = 0;
  CYTHON_UNUSED double __pyx_v_slope;
  CYTHON_UNUSED double __pyx_v_intercept;
  CYTHON_UNUSED double __pyx_v_r_value;
  double __pyx_v_p_value;
  CYTHON_UNUSED double __pyx_v_std_err;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("determineMixingTime", 0);
  if (__pyx_optional_args) {
    if (__pyx_optional_args-&gt;__pyx_n &gt; 0) {
      __pyx_v_burninSteps = __pyx_optional_args-&gt;burninSteps;
      if (__pyx_optional_args-&gt;__pyx_n &gt; 1) {
        __pyx_v_nStepsRegress = __pyx_optional_args-&gt;nStepsRegress;
        if (__pyx_optional_args-&gt;__pyx_n &gt; 2) {
          __pyx_v_threshold = __pyx_optional_args-&gt;threshold;
          if (__pyx_optional_args-&gt;__pyx_n &gt; 3) {
            __pyx_v_nStepsCorr = __pyx_optional_args-&gt;nStepsCorr;
            if (__pyx_optional_args-&gt;__pyx_n &gt; 4) {
              __pyx_v_checkMixing = __pyx_optional_args-&gt;checkMixing;
            }
          }
        }
      }
    }
  }
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_6, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_7, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_13);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_14);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.determineMixingTime", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_mags, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_allMags);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_magSeries);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_autocorr);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_x);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_7Toolbox_8infcyIDL_31determineMixingTime(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_7Toolbox_8infcyIDL_31determineMixingTime(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_6Models_6models_Model *__pyx_v_model = 0;
  long __pyx_v_burninSteps;
  long __pyx_v_nStepsRegress;
  double __pyx_v_threshold;
  long __pyx_v_nStepsCorr;
  int __pyx_v_checkMixing;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("determineMixingTime (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_model,&amp;__pyx_n_s_burninSteps,&amp;__pyx_n_s_nStepsRegress,&amp;__pyx_n_s_threshold,&amp;__pyx_n_s_nStepsCorr,&amp;__pyx_n_s_checkMixing,0};
    PyObject* values[6] = {0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_model)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_burninSteps);
          if (value) { values[1] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_nStepsRegress);
          if (value) { values[2] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_threshold);
          if (value) { values[3] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_nStepsCorr);
          if (value) { values[4] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_checkMixing);
          if (value) { values[5] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "determineMixingTime") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 686, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_model = ((struct __pyx_obj_6Models_6models_Model *)values[0]);
    if (values[1]) {
      __pyx_v_burninSteps = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[1]); if (unlikely((__pyx_v_burninSteps == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 687, __pyx_L3_error)</span>
    } else {
      __pyx_v_burninSteps = ((long)0x64);
    }
    if (values[2]) {
      __pyx_v_nStepsRegress = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[2]); if (unlikely((__pyx_v_nStepsRegress == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 688, __pyx_L3_error)</span>
    } else {
      __pyx_v_nStepsRegress = __pyx_k__10;
    }
    if (values[3]) {
      __pyx_v_threshold = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]); if (unlikely((__pyx_v_threshold == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 689, __pyx_L3_error)</span>
    } else {
      __pyx_v_threshold = ((double)0.05);
    }
    if (values[4]) {
      __pyx_v_nStepsCorr = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[4]); if (unlikely((__pyx_v_nStepsCorr == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L3_error)</span>
    } else {
      __pyx_v_nStepsCorr = __pyx_k__11;
    }
    if (values[5]) {
      __pyx_v_checkMixing = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[5]); if (unlikely((__pyx_v_checkMixing == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 691, __pyx_L3_error)</span>
    } else {
      __pyx_v_checkMixing = ((int)1);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("determineMixingTime", 0, 1, 6, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 686, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.determineMixingTime", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_model), __pyx_ptype_6Models_6models_Model, 1, "model", 0))) <span class='error_goto'>__PYX_ERR(0, 686, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_7Toolbox_8infcyIDL_30determineMixingTime(__pyx_self, __pyx_v_model, __pyx_v_burninSteps, __pyx_v_nStepsRegress, __pyx_v_threshold, __pyx_v_nStepsCorr, __pyx_v_checkMixing);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_7Toolbox_8infcyIDL_30determineMixingTime(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6Models_6models_Model *__pyx_v_model, long __pyx_v_burninSteps, long __pyx_v_nStepsRegress, double __pyx_v_threshold, long __pyx_v_nStepsCorr, int __pyx_v_checkMixing) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("determineMixingTime", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_2.__pyx_n = 5;
  __pyx_t_2.burninSteps = __pyx_v_burninSteps;
  __pyx_t_2.nStepsRegress = __pyx_v_nStepsRegress;
  __pyx_t_2.threshold = __pyx_v_threshold;
  __pyx_t_2.nStepsCorr = __pyx_v_nStepsCorr;
  __pyx_t_2.checkMixing = __pyx_v_checkMixing;
  __pyx_t_1 = __pyx_f_7Toolbox_8infcyIDL_determineMixingTime(__pyx_v_model, 0, &amp;__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 686, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.determineMixingTime", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
struct __pyx_opt_args_7Toolbox_8infcyIDL_determineMixingTime {
  int __pyx_n;
  long burninSteps;
  long nStepsRegress;
  double threshold;
  long nStepsCorr;
  int checkMixing;
};
</pre><pre class="cython line score-0">&#xA0;<span class="">687</span>:                       long burninSteps = 100,\</pre>
<pre class="cython line score-20" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">688</span>:                       long nStepsRegress = int(1e3),\</pre>
<pre class='cython code score-20 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyNumber_Int</span>(__pyx_float_1e3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 688, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_2); if (unlikely((__pyx_t_3 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 688, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_k__10 = __pyx_t_3;
/* … */
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyNumber_Int</span>(__pyx_float_1e3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 688, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_2); if (unlikely((__pyx_t_3 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 688, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_k__10 = __pyx_t_3;
</pre><pre class="cython line score-0">&#xA0;<span class="">689</span>:                       double threshold = 0.05,\</pre>
<pre class="cython line score-20" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">690</span>:                       long nStepsCorr = int(1e4), \</pre>
<pre class='cython code score-20 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyNumber_Int</span>(__pyx_float_1e4);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 690, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_2); if (unlikely((__pyx_t_3 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_k__11 = __pyx_t_3;
/* … */
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyNumber_Int</span>(__pyx_float_1e4);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 690, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_2); if (unlikely((__pyx_t_3 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_k__11 = __pyx_t_3;
</pre><pre class="cython line score-0">&#xA0;<span class="">691</span>:                       int checkMixing = 1):</pre>
<pre class="cython line score-0">&#xA0;<span class="">692</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">693</span>:     cdef:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">694</span>:         long s, nNodes = model._nNodes</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_model-&gt;_nNodes;
  __pyx_v_nNodes = __pyx_t_1;
</pre><pre class="cython line score-25" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">695</span>:         double[::1] mags = np.zeros(burninSteps)</pre>
<pre class='cython code score-25 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 695, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 695, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_burninSteps);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 695, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
    __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
    }
  }
  __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_t_3) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, __pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 695, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dc_double</span>(__pyx_t_2, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 695, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_mags = __pyx_t_6;
  __pyx_t_6.memview = NULL;
  __pyx_t_6.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">696</span>:         np.ndarray allMags  # for regression</pre>
<pre class="cython line score-0">&#xA0;<span class="">697</span>:         long lag, h, counter, mixingTime # tmp var and counter</pre>
<pre class="cython line score-0">&#xA0;<span class="">698</span>:         double beta        # slope value</pre>
<pre class="cython line score-24" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">699</span>:         np.ndarray magSeries, autocorr, x = np.arange(nStepsRegress)# for regression</pre>
<pre class='cython code score-24 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 699, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_arange);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 699, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_nStepsRegress);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 699, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_5)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_5, __pyx_t_4) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 699, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 699, __pyx_L1_error)</span>
  __pyx_v_x = ((PyArrayObject *)__pyx_t_2);
  __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">700</span>:         double slope, intercept, r_value, p_value, std_err, corrTime</pre>
<pre class="cython line score-0">&#xA0;<span class="">701</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">702</span>:     counter = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_counter = 0;
</pre><pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">703</span>:     allMags = np.array(mean(model.states, nNodes, abs=1))</pre>
<pre class='cython code score-32 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 703, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 703, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(((PyObject *)__pyx_v_model), __pyx_n_s_states);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 703, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dc_long</span>(__pyx_t_3, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 703, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_9.__pyx_n = 1;
  __pyx_t_9.abs = 1;
  __pyx_t_8 = __pyx_f_7Toolbox_8infcyIDL_mean(__pyx_t_7, __pyx_v_nNodes, &amp;__pyx_t_9); 
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_7, 1);
  __pyx_t_7.memview = NULL;
  __pyx_t_7.data = NULL;
  __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 703, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
    __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
    }
  }
  __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_t_3) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, __pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 703, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 703, __pyx_L1_error)</span>
  __pyx_v_allMags = ((PyArrayObject *)__pyx_t_2);
  __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">704</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">705</span>:     # simulate until mag has stabilized</pre>
<pre class="cython line score-0">&#xA0;<span class="">706</span>:     # remember mixing time needed</pre>
<pre class="cython line score-0">&#xA0;<span class="">707</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">708</span>:     if checkMixing:</pre>
<pre class='cython code score-0 '>  __pyx_t_10 = (__pyx_v_checkMixing != 0);
  if (__pyx_t_10) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">709</span>:         while True:</pre>
<pre class='cython code score-0 '>    while (1) {
</pre><pre class="cython line score-0">&#xA0;<span class="">710</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">711</span>:             mags = _magTimeSeries(model, 0, burninSteps, abs=1)</pre>
<pre class='cython code score-0 '>      __pyx_t_11.__pyx_n = 1;
      __pyx_t_11.abs = 1;
      __pyx_t_6 = __pyx_f_7Toolbox_8infcyIDL__magTimeSeries(__pyx_v_model, 0, __pyx_v_burninSteps, &amp;__pyx_t_11);<span class='error_goto'> if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 711, __pyx_L1_error)</span>
      __PYX_XDEC_MEMVIEW(&amp;__pyx_v_mags, 1);
      __pyx_v_mags = __pyx_t_6;
      __pyx_t_6.memview = NULL;
      __pyx_t_6.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">712</span>: </pre>
<pre class="cython line score-34" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">713</span>:             allMags = np.hstack((allMags, mags.base))</pre>
<pre class='cython code score-34 '>      <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 713, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_hstack);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 713, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_mags, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 713, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_base);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 713, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 713, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_allMags));
      <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_allMags));
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, ((PyObject *)__pyx_v_allMags));
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_5);
      __pyx_t_5 = 0;
      __pyx_t_5 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
        __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
        if (likely(__pyx_t_5)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
        }
      }
      __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_5, __pyx_t_4) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 713, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 713, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_allMags, ((PyArrayObject *)__pyx_t_2));
      __pyx_t_2 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">714</span>:             if counter &gt;= nStepsRegress :</pre>
<pre class='cython code score-0 '>      __pyx_t_10 = ((__pyx_v_counter &gt;= __pyx_v_nStepsRegress) != 0);
      if (__pyx_t_10) {
/* … */
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">715</span>:                 # do linear regression</pre>
<pre class="cython line score-149" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">716</span>:                 slope, intercept, r_value, p_value, std_err = linregress(x, allMags[-nStepsRegress:])</pre>
<pre class='cython code score-149 '>        <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_linregress);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 716, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
        __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetSlice</span>(((PyObject *)__pyx_v_allMags), (-__pyx_v_nStepsRegress), 0, NULL, NULL, NULL, 1, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 716, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
        __pyx_t_5 = NULL;
        __pyx_t_1 = 0;
        if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
          __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
          if (likely(__pyx_t_5)) {
            PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
            <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
            __pyx_t_1 = 1;
          }
        }
        #if CYTHON_FAST_PYCALL
        if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_3)) {
          PyObject *__pyx_temp[3] = {__pyx_t_5, ((PyObject *)__pyx_v_x), __pyx_t_4};
          __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-__pyx_t_1, 2+__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 716, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_3)) {
          PyObject *__pyx_temp[3] = {__pyx_t_5, ((PyObject *)__pyx_v_x), __pyx_t_4};
          __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-__pyx_t_1, 2+__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 716, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
        } else
        #endif
        {
          __pyx_t_12 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 716, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
          if (__pyx_t_5) {
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 0, __pyx_t_5); __pyx_t_5 = NULL;
          }
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_x));
          <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_x));
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 0+__pyx_t_1, ((PyObject *)__pyx_v_x));
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 1+__pyx_t_1, __pyx_t_4);
          __pyx_t_4 = 0;
          __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_12, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 716, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
        }
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        if ((likely(<span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_2))) || (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_2))) {
          PyObject* sequence = __pyx_t_2;
          Py_ssize_t size = <span class='pyx_c_api'>__Pyx_PySequence_SIZE</span>(sequence);
          if (unlikely(size != 5)) {
            if (size &gt; 5) <span class='pyx_c_api'>__Pyx_RaiseTooManyValuesError</span>(5);
            else if (size &gt;= 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(size);
            <span class='error_goto'>__PYX_ERR(0, 716, __pyx_L1_error)</span>
          }
          #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
          if (likely(<span class='py_c_api'>PyTuple_CheckExact</span>(sequence))) {
            __pyx_t_3 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 0); 
            __pyx_t_12 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 1); 
            __pyx_t_4 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 2); 
            __pyx_t_5 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 3); 
            __pyx_t_13 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 4); 
          } else {
            __pyx_t_3 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 0); 
            __pyx_t_12 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 1); 
            __pyx_t_4 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 2); 
            __pyx_t_5 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 3); 
            __pyx_t_13 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 4); 
          }
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_12);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_13);
          #else
          {
            Py_ssize_t i;
            PyObject** temps[5] = {&amp;__pyx_t_3,&amp;__pyx_t_12,&amp;__pyx_t_4,&amp;__pyx_t_5,&amp;__pyx_t_13};
            for (i=0; i &lt; 5; i++) {
              PyObject* item = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, i);<span class='error_goto'> if (unlikely(!item)) __PYX_ERR(0, 716, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(item);
              *(temps[i]) = item;
            }
          }
          #endif
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
        } else {
          Py_ssize_t index = -1;
          PyObject** temps[5] = {&amp;__pyx_t_3,&amp;__pyx_t_12,&amp;__pyx_t_4,&amp;__pyx_t_5,&amp;__pyx_t_13};
          __pyx_t_14 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 716, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
          __pyx_t_15 = Py_TYPE(__pyx_t_14)-&gt;tp_iternext;
          for (index=0; index &lt; 5; index++) {
            PyObject* item = __pyx_t_15(__pyx_t_14); if (unlikely(!item)) goto __pyx_L7_unpacking_failed;
            <span class='refnanny'>__Pyx_GOTREF</span>(item);
            *(temps[index]) = item;
          }
          if (<span class='pyx_c_api'>__Pyx_IternextUnpackEndCheck</span>(__pyx_t_15(__pyx_t_14), 5) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 716, __pyx_L1_error)</span>
          __pyx_t_15 = NULL;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
          goto __pyx_L8_unpacking_done;
          __pyx_L7_unpacking_failed:;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
          __pyx_t_15 = NULL;
          if (<span class='pyx_c_api'>__Pyx_IterFinish</span>() == 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(index);
          <span class='error_goto'>__PYX_ERR(0, 716, __pyx_L1_error)</span>
          __pyx_L8_unpacking_done:;
        }
        __pyx_t_8 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_3); if (unlikely((__pyx_t_8 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 716, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_16 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_12); if (unlikely((__pyx_t_16 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 716, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
        __pyx_t_17 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_4); if (unlikely((__pyx_t_17 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 716, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_t_18 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_5); if (unlikely((__pyx_t_18 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 716, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_19 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_13); if (unlikely((__pyx_t_19 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 716, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
        __pyx_v_slope = __pyx_t_8;
        __pyx_v_intercept = __pyx_t_16;
        __pyx_v_r_value = __pyx_t_17;
        __pyx_v_p_value = __pyx_t_18;
        __pyx_v_std_err = __pyx_t_19;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">717</span>:                 if 1 - p_value &lt; threshold: # p-value of test for slope=0</pre>
<pre class='cython code score-0 '>        __pyx_t_10 = (((1.0 - __pyx_v_p_value) &lt; __pyx_v_threshold) != 0);
        if (__pyx_t_10) {
/* … */
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">718</span>:                     break</pre>
<pre class='cython code score-0 '>          goto __pyx_L5_break;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">719</span>:             counter = counter + burninSteps</pre>
<pre class='cython code score-0 '>      __pyx_v_counter = (__pyx_v_counter + __pyx_v_burninSteps);
    }
    __pyx_L5_break:;
</pre><pre class="cython line score-0">&#xA0;<span class="">720</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">721</span>:         mixingTime = counter - nStepsRegress</pre>
<pre class='cython code score-0 '>    __pyx_v_mixingTime = (__pyx_v_counter - __pyx_v_nStepsRegress);
</pre><pre class="cython line score-0">&#xA0;<span class="">722</span>:         #print('Number of bunin samples needed {0}\n\n'.format(mixingTime))</pre>
<pre class="cython line score-0">&#xA0;<span class="">723</span>:         #print(f'absolute mean magnetization last sample {y[-1]}')</pre>
<pre class="cython line score-0">&#xA0;<span class="">724</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">725</span>:     else: # run given number of burnin steps</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">726</span>:         mixingTime = burninSteps</pre>
<pre class='cython code score-0 '>  /*else*/ {
    __pyx_v_mixingTime = __pyx_v_burninSteps;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">727</span>:         model.simulateNSteps(mixingTime)</pre>
<pre class='cython code score-0 '>    __pyx_t_7 = ((struct __pyx_vtabstruct_6Models_6models_Model *)__pyx_v_model-&gt;__pyx_vtab)-&gt;simulateNSteps(__pyx_v_model, __pyx_v_mixingTime);<span class='error_goto'> if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 727, __pyx_L1_error)</span>
    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_7, 1);
    __pyx_t_7.memview = NULL;
    __pyx_t_7.data = NULL;
  }
  __pyx_L3:;
</pre><pre class="cython line score-0">&#xA0;<span class="">728</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">729</span>:     # measure correlation time (autocorrelation for varying lags)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">730</span>:     magSeries = magTimeSeries(model, 0, nStepsCorr)</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = ((PyObject *)__pyx_f_7Toolbox_8infcyIDL_magTimeSeries(__pyx_v_model, 0, __pyx_v_nStepsCorr, 0, NULL));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 730, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_v_magSeries = ((PyArrayObject *)__pyx_t_2);
  __pyx_t_2 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">731</span>:     autocorr = autocorrelation(magSeries)</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = ((PyObject *)__pyx_f_7Toolbox_8infcyIDL_autocorrelation(__pyx_v_magSeries, 0));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 731, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_v_autocorr = ((PyArrayObject *)__pyx_t_2);
  __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">732</span>: </pre>
<pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">733</span>:     return allMags, mixingTime, autocorr</pre>
<pre class='cython code score-13 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_mixingTime);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 733, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_13 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 733, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_allMags));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_allMags));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 0, ((PyObject *)__pyx_v_allMags));
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 1, __pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_autocorr));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_autocorr));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 2, ((PyObject *)__pyx_v_autocorr));
  __pyx_t_2 = 0;
  __pyx_r = ((PyObject*)__pyx_t_13);
  __pyx_t_13 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">734</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">735</span>: </pre>
<pre class="cython line score-120" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">736</span>: cpdef tuple determineCorrTime(Model model, \</pre>
<pre class='cython code score-120 '>static PyObject *__pyx_pw_7Toolbox_8infcyIDL_33determineCorrTime(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_7Toolbox_8infcyIDL_determineCorrTime(struct __pyx_obj_6Models_6models_Model *__pyx_v_model, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_7Toolbox_8infcyIDL_determineCorrTime *__pyx_optional_args) {
  int __pyx_v_nInitialConfigs = ((int)10);
  long __pyx_v_burninSteps = ((long)10);
  long __pyx_v_nStepsRegress = __pyx_k__12;
  double __pyx_v_thresholdReg = ((double)0.05);
  long __pyx_v_nStepsCorr = __pyx_k__13;
  double __pyx_v_thresholdCorr = ((double)0.05);
  int __pyx_v_checkMixing = ((int)1);
  long __pyx_v_mixingTime;
  long __pyx_v_mixingTimeMax;
  long __pyx_v_nNodes;
  double __pyx_v_corrTime;
  double __pyx_v_prob;
  double __pyx_v_corrTimeMax;
  PyArrayObject *__pyx_v_tmp = 0;
  CYTHON_UNUSED PyArrayObject *__pyx_v_mags = 0;
  PyArrayObject *__pyx_v_autocorr = 0;
  PyArrayObject *__pyx_v_initialConfigs = 0;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("determineCorrTime", 0);
  if (__pyx_optional_args) {
    if (__pyx_optional_args-&gt;__pyx_n &gt; 0) {
      __pyx_v_nInitialConfigs = __pyx_optional_args-&gt;nInitialConfigs;
      if (__pyx_optional_args-&gt;__pyx_n &gt; 1) {
        __pyx_v_burninSteps = __pyx_optional_args-&gt;burninSteps;
        if (__pyx_optional_args-&gt;__pyx_n &gt; 2) {
          __pyx_v_nStepsRegress = __pyx_optional_args-&gt;nStepsRegress;
          if (__pyx_optional_args-&gt;__pyx_n &gt; 3) {
            __pyx_v_thresholdReg = __pyx_optional_args-&gt;thresholdReg;
            if (__pyx_optional_args-&gt;__pyx_n &gt; 4) {
              __pyx_v_nStepsCorr = __pyx_optional_args-&gt;nStepsCorr;
              if (__pyx_optional_args-&gt;__pyx_n &gt; 5) {
                __pyx_v_thresholdCorr = __pyx_optional_args-&gt;thresholdCorr;
                if (__pyx_optional_args-&gt;__pyx_n &gt; 6) {
                  __pyx_v_checkMixing = __pyx_optional_args-&gt;checkMixing;
                }
              }
            }
          }
        }
      }
    }
  }
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.determineCorrTime", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_tmp);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_mags);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_autocorr);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_initialConfigs);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_7Toolbox_8infcyIDL_33determineCorrTime(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_7Toolbox_8infcyIDL_33determineCorrTime(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_6Models_6models_Model *__pyx_v_model = 0;
  int __pyx_v_nInitialConfigs;
  long __pyx_v_burninSteps;
  long __pyx_v_nStepsRegress;
  double __pyx_v_thresholdReg;
  long __pyx_v_nStepsCorr;
  double __pyx_v_thresholdCorr;
  int __pyx_v_checkMixing;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("determineCorrTime (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_model,&amp;__pyx_n_s_nInitialConfigs,&amp;__pyx_n_s_burninSteps,&amp;__pyx_n_s_nStepsRegress,&amp;__pyx_n_s_thresholdReg,&amp;__pyx_n_s_nStepsCorr,&amp;__pyx_n_s_thresholdCorr,&amp;__pyx_n_s_checkMixing,0};
    PyObject* values[8] = {0,0,0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_model)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_nInitialConfigs);
          if (value) { values[1] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_burninSteps);
          if (value) { values[2] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_nStepsRegress);
          if (value) { values[3] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_thresholdReg);
          if (value) { values[4] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_nStepsCorr);
          if (value) { values[5] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_thresholdCorr);
          if (value) { values[6] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_checkMixing);
          if (value) { values[7] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "determineCorrTime") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 736, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_model = ((struct __pyx_obj_6Models_6models_Model *)values[0]);
    if (values[1]) {
      __pyx_v_nInitialConfigs = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[1]); if (unlikely((__pyx_v_nInitialConfigs == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 737, __pyx_L3_error)</span>
    } else {
      __pyx_v_nInitialConfigs = ((int)10);
    }
    if (values[2]) {
      __pyx_v_burninSteps = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[2]); if (unlikely((__pyx_v_burninSteps == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 738, __pyx_L3_error)</span>
    } else {
      __pyx_v_burninSteps = ((long)10);
    }
    if (values[3]) {
      __pyx_v_nStepsRegress = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[3]); if (unlikely((__pyx_v_nStepsRegress == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 739, __pyx_L3_error)</span>
    } else {
      __pyx_v_nStepsRegress = __pyx_k__12;
    }
    if (values[4]) {
      __pyx_v_thresholdReg = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[4]); if (unlikely((__pyx_v_thresholdReg == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 740, __pyx_L3_error)</span>
    } else {
      __pyx_v_thresholdReg = ((double)0.05);
    }
    if (values[5]) {
      __pyx_v_nStepsCorr = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[5]); if (unlikely((__pyx_v_nStepsCorr == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 741, __pyx_L3_error)</span>
    } else {
      __pyx_v_nStepsCorr = __pyx_k__13;
    }
    if (values[6]) {
      __pyx_v_thresholdCorr = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[6]); if (unlikely((__pyx_v_thresholdCorr == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 742, __pyx_L3_error)</span>
    } else {
      __pyx_v_thresholdCorr = ((double)0.05);
    }
    if (values[7]) {
      __pyx_v_checkMixing = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[7]); if (unlikely((__pyx_v_checkMixing == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 743, __pyx_L3_error)</span>
    } else {
      __pyx_v_checkMixing = ((int)1);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("determineCorrTime", 0, 1, 8, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 736, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.determineCorrTime", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_model), __pyx_ptype_6Models_6models_Model, 1, "model", 0))) <span class='error_goto'>__PYX_ERR(0, 736, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_7Toolbox_8infcyIDL_32determineCorrTime(__pyx_self, __pyx_v_model, __pyx_v_nInitialConfigs, __pyx_v_burninSteps, __pyx_v_nStepsRegress, __pyx_v_thresholdReg, __pyx_v_nStepsCorr, __pyx_v_thresholdCorr, __pyx_v_checkMixing);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_7Toolbox_8infcyIDL_32determineCorrTime(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6Models_6models_Model *__pyx_v_model, int __pyx_v_nInitialConfigs, long __pyx_v_burninSteps, long __pyx_v_nStepsRegress, double __pyx_v_thresholdReg, long __pyx_v_nStepsCorr, double __pyx_v_thresholdCorr, int __pyx_v_checkMixing) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("determineCorrTime", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_2.__pyx_n = 7;
  __pyx_t_2.nInitialConfigs = __pyx_v_nInitialConfigs;
  __pyx_t_2.burninSteps = __pyx_v_burninSteps;
  __pyx_t_2.nStepsRegress = __pyx_v_nStepsRegress;
  __pyx_t_2.thresholdReg = __pyx_v_thresholdReg;
  __pyx_t_2.nStepsCorr = __pyx_v_nStepsCorr;
  __pyx_t_2.thresholdCorr = __pyx_v_thresholdCorr;
  __pyx_t_2.checkMixing = __pyx_v_checkMixing;
  __pyx_t_1 = __pyx_f_7Toolbox_8infcyIDL_determineCorrTime(__pyx_v_model, 0, &amp;__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 736, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.determineCorrTime", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
struct __pyx_opt_args_7Toolbox_8infcyIDL_determineCorrTime {
  int __pyx_n;
  int nInitialConfigs;
  long burninSteps;
  long nStepsRegress;
  double thresholdReg;
  long nStepsCorr;
  double thresholdCorr;
  int checkMixing;
};
</pre><pre class="cython line score-0">&#xA0;<span class="">737</span>:               int nInitialConfigs = 10, \</pre>
<pre class="cython line score-0">&#xA0;<span class="">738</span>:               long burninSteps = 10, \</pre>
<pre class="cython line score-20" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">739</span>:               long nStepsRegress = int(1e3), \</pre>
<pre class='cython code score-20 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyNumber_Int</span>(__pyx_float_1e3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 739, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_2); if (unlikely((__pyx_t_3 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 739, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_k__12 = __pyx_t_3;
/* … */
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyNumber_Int</span>(__pyx_float_1e3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 739, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_2); if (unlikely((__pyx_t_3 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 739, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_k__12 = __pyx_t_3;
</pre><pre class="cython line score-0">&#xA0;<span class="">740</span>:               double thresholdReg = 0.05, \</pre>
<pre class="cython line score-20" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">741</span>:               long nStepsCorr = int(1e3), \</pre>
<pre class='cython code score-20 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyNumber_Int</span>(__pyx_float_1e3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 741, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_2); if (unlikely((__pyx_t_3 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 741, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_k__13 = __pyx_t_3;
/* … */
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyNumber_Int</span>(__pyx_float_1e3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 741, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_2); if (unlikely((__pyx_t_3 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 741, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_k__13 = __pyx_t_3;
</pre><pre class="cython line score-0">&#xA0;<span class="">742</span>:               double thresholdCorr = 0.05, \</pre>
<pre class="cython line score-0">&#xA0;<span class="">743</span>:               int checkMixing = 1):</pre>
<pre class="cython line score-0">&#xA0;<span class="">744</span>:     cdef:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">745</span>:         long mixingTime, mixingTimeMax = 0, idx, nNodes = model._nNodes</pre>
<pre class='cython code score-0 '>  __pyx_v_mixingTimeMax = 0;
  __pyx_t_1 = __pyx_v_model-&gt;_nNodes;
  __pyx_v_nNodes = __pyx_t_1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">746</span>:         double corrTime, prob, t, corrTimeMax = 0 # double because it might be infinity</pre>
<pre class='cython code score-0 '>  __pyx_v_corrTimeMax = 0.0;
</pre><pre class="cython line score-49" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">747</span>:         np.ndarray tmp, mags, autocorr, initialConfigs = np.linspace(0.5, 1, nInitialConfigs)</pre>
<pre class='cython code score-49 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 747, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_linspace);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 747, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_nInitialConfigs);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 747, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_5 = NULL;
  __pyx_t_1 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
    __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
      __pyx_t_1 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_4)) {
    PyObject *__pyx_temp[4] = {__pyx_t_5, __pyx_float_0_5, __pyx_int_1, __pyx_t_3};
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_4, __pyx_temp+1-__pyx_t_1, 3+__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 747, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_4)) {
    PyObject *__pyx_temp[4] = {__pyx_t_5, __pyx_float_0_5, __pyx_int_1, __pyx_t_3};
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_4, __pyx_temp+1-__pyx_t_1, 3+__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 747, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  } else
  #endif
  {
    __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(3+__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 747, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    if (__pyx_t_5) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_5); __pyx_t_5 = NULL;
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_float_0_5);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_float_0_5);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0+__pyx_t_1, __pyx_float_0_5);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_1);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_1);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 1+__pyx_t_1, __pyx_int_1);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 2+__pyx_t_1, __pyx_t_3);
    __pyx_t_3 = 0;
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_4, __pyx_t_6, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 747, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 747, __pyx_L1_error)</span>
  __pyx_v_initialConfigs = ((PyArrayObject *)__pyx_t_2);
  __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">748</span>: </pre>
<pre class="cython line score-70" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">749</span>:     for prob in tqdm(initialConfigs):</pre>
<pre class='cython code score-70 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_tqdm);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 749, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_6 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
    __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
    if (likely(__pyx_t_6)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
    }
  }
  __pyx_t_2 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_6, ((PyObject *)__pyx_v_initialConfigs)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, ((PyObject *)__pyx_v_initialConfigs));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 749, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_2)) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_2)) {
    __pyx_t_4 = __pyx_t_2; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4); __pyx_t_7 = 0;
    __pyx_t_8 = NULL;
  } else {
    __pyx_t_7 = -1; __pyx_t_4 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 749, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    __pyx_t_8 = Py_TYPE(__pyx_t_4)-&gt;tp_iternext;<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 749, __pyx_L1_error)</span>
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  for (;;) {
    if (likely(!__pyx_t_8)) {
      if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_4))) {
        if (__pyx_t_7 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_4)) break;
        #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_2 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_4, __pyx_t_7); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_7++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 749, __pyx_L1_error)</span>
        #else
        __pyx_t_2 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_4, __pyx_t_7); __pyx_t_7++;<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 749, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        #endif
      } else {
        if (__pyx_t_7 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_4)) break;
        #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_2 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_4, __pyx_t_7); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_7++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 749, __pyx_L1_error)</span>
        #else
        __pyx_t_2 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_4, __pyx_t_7); __pyx_t_7++;<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 749, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        #endif
      }
    } else {
      __pyx_t_2 = __pyx_t_8(__pyx_t_4);
      if (unlikely(!__pyx_t_2)) {
        PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
        if (exc_type) {
          if (likely(<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else <span class='error_goto'>__PYX_ERR(0, 749, __pyx_L1_error)</span>
        }
        break;
      }
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    }
    __pyx_t_9 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2); if (unlikely((__pyx_t_9 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 749, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_prob = __pyx_t_9;
/* … */
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class="cython line score-64" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">750</span>:         model.states = np.random.choice([-1,1], size = nNodes, p=[prob, 1-prob])</pre>
<pre class='cython code score-64 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 750, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_random);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 750, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_choice);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 750, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 750, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_neg_1);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_neg_1);
    <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_6, 0, __pyx_int_neg_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_1);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_1);
    <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_6, 1, __pyx_int_1);
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 750, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_6);
    __pyx_t_6 = 0;
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 750, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_nNodes);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 750, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_6, __pyx_n_s_size, __pyx_t_5) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 750, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_prob);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 750, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_10 = <span class='py_c_api'>PyFloat_FromDouble</span>((1.0 - __pyx_v_prob));<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 750, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    __pyx_t_11 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 750, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
    <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_11, 0, __pyx_t_5);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_10);
    <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_11, 1, __pyx_t_10);
    __pyx_t_5 = 0;
    __pyx_t_10 = 0;
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_6, __pyx_n_s_p, __pyx_t_11) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 750, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_3, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 750, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    if (<span class='pyx_c_api'>__Pyx_PyObject_SetAttrStr</span>(((PyObject *)__pyx_v_model), __pyx_n_s_states, __pyx_t_11) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 750, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
</pre><pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">751</span>:         mags, mixingTime, autocorr = determineMixingTime(model,\</pre>
<pre class='cython code score-32 '>    __pyx_t_12.__pyx_n = 5;
    __pyx_t_12.burninSteps = __pyx_v_burninSteps;
    __pyx_t_12.nStepsRegress = __pyx_v_nStepsRegress;
    __pyx_t_12.threshold = __pyx_v_thresholdReg;
    __pyx_t_12.nStepsCorr = __pyx_v_nStepsCorr;
    __pyx_t_12.checkMixing = __pyx_v_checkMixing;
    __pyx_t_11 = __pyx_f_7Toolbox_8infcyIDL_determineMixingTime(__pyx_v_model, 0, &amp;__pyx_t_12);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 751, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    if (likely(__pyx_t_11 != Py_None)) {
      PyObject* sequence = __pyx_t_11;
      Py_ssize_t size = <span class='pyx_c_api'>__Pyx_PySequence_SIZE</span>(sequence);
      if (unlikely(size != 3)) {
        if (size &gt; 3) <span class='pyx_c_api'>__Pyx_RaiseTooManyValuesError</span>(3);
        else if (size &gt;= 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(size);
        <span class='error_goto'>__PYX_ERR(0, 751, __pyx_L1_error)</span>
      }
      #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
      __pyx_t_6 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 0); 
      __pyx_t_3 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 1); 
      __pyx_t_2 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 2); 
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      #else
      __pyx_t_6 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 0);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 751, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      __pyx_t_3 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 751, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      __pyx_t_2 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 751, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      #endif
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    } else {
      <span class='pyx_c_api'>__Pyx_RaiseNoneNotIterableError</span>(); <span class='error_goto'>__PYX_ERR(0, 751, __pyx_L1_error)</span>
    }
    if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 751, __pyx_L1_error)</span>
    __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_3); if (unlikely((__pyx_t_13 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 751, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 751, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_mags, ((PyArrayObject *)__pyx_t_6));
    __pyx_t_6 = 0;
    __pyx_v_mixingTime = __pyx_t_13;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_autocorr, ((PyArrayObject *)__pyx_t_2));
    __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">752</span>:                               burninSteps,\</pre>
<pre class="cython line score-0">&#xA0;<span class="">753</span>:                               nStepsRegress,\</pre>
<pre class="cython line score-0">&#xA0;<span class="">754</span>:                               thresholdReg,\</pre>
<pre class="cython line score-0">&#xA0;<span class="">755</span>:                               nStepsCorr, \</pre>
<pre class="cython line score-0">&#xA0;<span class="">756</span>:                               checkMixing)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">757</span>:         if mixingTime &gt; mixingTimeMax: mixingTimeMax = mixingTime</pre>
<pre class='cython code score-0 '>    __pyx_t_14 = ((__pyx_v_mixingTime &gt; __pyx_v_mixingTimeMax) != 0);
    if (__pyx_t_14) {
      __pyx_v_mixingTimeMax = __pyx_v_mixingTime;
    }
</pre><pre class="cython line score-57" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">758</span>:         tmp = np.where(np.abs(autocorr) &lt; thresholdCorr)[0]</pre>
<pre class='cython code score-57 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 758, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_where);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 758, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_6, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 758, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_abs);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 758, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_10))) {
      __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_10);
      if (likely(__pyx_t_6)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_10);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_10, function);
      }
    }
    __pyx_t_2 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_10, __pyx_t_6, ((PyObject *)__pyx_v_autocorr)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_10, ((PyObject *)__pyx_v_autocorr));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 758, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_10 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_thresholdCorr);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 758, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    __pyx_t_6 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_2, __pyx_t_10, Py_LT); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 758, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_10 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
      __pyx_t_10 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
      if (likely(__pyx_t_10)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
      }
    }
    __pyx_t_11 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_10, __pyx_t_6) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_11)) <span class='error_goto'>__PYX_ERR(0, 758, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_11, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 758, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 758, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_tmp, ((PyArrayObject *)__pyx_t_3));
    __pyx_t_3 = 0;
</pre><pre class="cython line score-40" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">759</span>:         corrTime = tmp[0] if tmp.size &gt; 0 else np.inf</pre>
<pre class='cython code score-40 '>    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(((PyObject *)__pyx_v_tmp), __pyx_n_s_size);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 759, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_11 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_3, __pyx_int_0, Py_GT); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_11);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 759, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_11); if (unlikely(__pyx_t_14 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 759, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    if (__pyx_t_14) {
      __pyx_t_11 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(((PyObject *)__pyx_v_tmp), 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 759, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
      __pyx_t_15 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_11); if (unlikely((__pyx_t_15 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 759, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      __pyx_t_9 = __pyx_t_15;
    } else {
      <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_11, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 759, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_11, __pyx_n_s_inf);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 759, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      __pyx_t_15 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_3); if (unlikely((__pyx_t_15 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 759, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_9 = __pyx_t_15;
    }
    __pyx_v_corrTime = __pyx_t_9;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">760</span>:         if corrTime &gt; corrTimeMax: corrTimeMax = corrTime</pre>
<pre class='cython code score-0 '>    __pyx_t_14 = ((__pyx_v_corrTime &gt; __pyx_v_corrTimeMax) != 0);
    if (__pyx_t_14) {
      __pyx_v_corrTimeMax = __pyx_v_corrTime;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">761</span>: </pre>
<pre class="cython line score-15" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">762</span>:     return mixingTimeMax, corrTimeMax</pre>
<pre class='cython code score-15 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_mixingTimeMax);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 762, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_corrTimeMax);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 762, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_11 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 762, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 0, __pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 1, __pyx_t_3);
  __pyx_t_4 = 0;
  __pyx_t_3 = 0;
  __pyx_r = ((PyObject*)__pyx_t_11);
  __pyx_t_11 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">763</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">764</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">765</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">766</span>: @cython.wraparound(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">767</span>: @cython.nonecheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">768</span>: @cython.cdivision(True)</pre>
<pre class="cython line score-0">&#xA0;<span class="">769</span>: @cython.initializedcheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">770</span>: @cython.overflowcheck(False)</pre>
<pre class="cython line score-12" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">771</span>: cdef vector[double] simulateGetMeanMag(Model model, long nSamples = int(1e2)) nogil:</pre>
<pre class='cython code score-12 '>static std::vector&lt;double&gt;  __pyx_f_7Toolbox_8infcyIDL_simulateGetMeanMag(struct __pyx_obj_6Models_6models_Model *__pyx_v_model, struct __pyx_opt_args_7Toolbox_8infcyIDL_simulateGetMeanMag *__pyx_optional_args) {
  long __pyx_v_nSamples = __pyx_k__14;
  __Pyx_memviewslice __pyx_v_r = { 0, 0, { 0 }, { 0 }, { 0 } };
  long __pyx_v_step;
  double __pyx_v_sum;
  double __pyx_v_sum_square;
  std::vector&lt;double&gt;  __pyx_v_out;
  double __pyx_v_m;
  std::vector&lt;double&gt;  __pyx_r;
  if (__pyx_optional_args) {
    if (__pyx_optional_args-&gt;__pyx_n &gt; 0) {
      __pyx_v_nSamples = __pyx_optional_args-&gt;nSamples;
    }
  }
/* … */
  /* function exit code */
  __pyx_L1_error:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 0);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_6, 0);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_7, 0);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("Toolbox.infcyIDL.simulateGetMeanMag", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 1);
  __Pyx_pretend_to_initialize(&amp;__pyx_r);
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_r, 0);
  return __pyx_r;
}
/* … */
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyNumber_Int</span>(__pyx_float_1e2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 771, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_2); if (unlikely((__pyx_t_3 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 771, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_k__14 = __pyx_t_3;
/* … */
struct __pyx_opt_args_7Toolbox_8infcyIDL_simulateGetMeanMag {
  int __pyx_n;
  long nSamples;
};
</pre><pre class="cython line score-0">&#xA0;<span class="">772</span>:     cdef:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">773</span>:         long[:, ::1] r = model.sampleNodes(nSamples)</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((struct __pyx_vtabstruct_6Models_6models_Model *)__pyx_v_model-&gt;__pyx_vtab)-&gt;sampleNodes(__pyx_v_model, __pyx_v_nSamples);<span class='error_goto'> if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 773, __pyx_L1_error)</span>
  __pyx_v_r = __pyx_t_1;
  __pyx_t_1.memview = NULL;
  __pyx_t_1.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">774</span>:         long step</pre>
<pre class="cython line score-0">&#xA0;<span class="">775</span>:         double sum, sum_square</pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">776</span>:         vector[double] out = vector[double](2,0)</pre>
<pre class='cython code score-4 '>  try {
    __pyx_t_2 = std::vector&lt;double&gt; (2, 0.0);
  } catch(...) {
    #ifdef WITH_THREAD
    PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
    #endif
    __Pyx_CppExn2PyErr();
    #ifdef WITH_THREAD
    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
    #endif
    <span class='error_goto'>__PYX_ERR(0, 776, __pyx_L1_error)</span>
  }
  __pyx_v_out = __pyx_t_2;
</pre><pre class="cython line score-0">&#xA0;<span class="">777</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">778</span>:     sum = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_sum = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">779</span>:     sum_square = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_sum_square = 0.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">780</span>:     # collect magnetizations</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">781</span>:     for step in range(nSamples):</pre>
<pre class='cython code score-0 '>  __pyx_t_3 = __pyx_v_nSamples;
  __pyx_t_4 = __pyx_t_3;
  for (__pyx_t_5 = 0; __pyx_t_5 &lt; __pyx_t_4; __pyx_t_5+=1) {
    __pyx_v_step = __pyx_t_5;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">782</span>:         m = mean(model._updateState(r[step]), model._nNodes)</pre>
<pre class='cython code score-0 '>    __pyx_t_6.data = __pyx_v_r.data;
    __pyx_t_6.memview = __pyx_v_r.memview;
    __PYX_INC_MEMVIEW(&amp;__pyx_t_6, 0);
    {
    Py_ssize_t __pyx_tmp_idx = __pyx_v_step;
    Py_ssize_t __pyx_tmp_stride = __pyx_v_r.strides[0];
        if ((0)) <span class='error_goto'>__PYX_ERR(0, 782, __pyx_L1_error)</span>
        __pyx_t_6.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_6.shape[0] = __pyx_v_r.shape[1];
__pyx_t_6.strides[0] = __pyx_v_r.strides[1];
    __pyx_t_6.suboffsets[0] = -1;

__pyx_t_7 = ((struct __pyx_vtabstruct_6Models_6models_Model *)__pyx_v_model-&gt;__pyx_vtab)-&gt;_updateState(__pyx_v_model, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 782, __pyx_L1_error)</span>
    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_6, 0);
    __pyx_t_6.memview = NULL;
    __pyx_t_6.data = NULL;
    __pyx_v_m = __pyx_f_7Toolbox_8infcyIDL_mean(__pyx_t_7, __pyx_v_model-&gt;_nNodes, NULL);
    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_7, 0);
    __pyx_t_7.memview = NULL;
    __pyx_t_7.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">783</span>:         sum = sum + m</pre>
<pre class='cython code score-0 '>    __pyx_v_sum = (__pyx_v_sum + __pyx_v_m);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">784</span>:         sum_square = sum_square + (m*m)</pre>
<pre class='cython code score-0 '>    __pyx_v_sum_square = (__pyx_v_sum_square + (__pyx_v_m * __pyx_v_m));
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">785</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">786</span>:     out[0] = sum</pre>
<pre class='cython code score-0 '>  (__pyx_v_out[0]) = __pyx_v_sum;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">787</span>:     out[1] = sum_square</pre>
<pre class='cython code score-0 '>  (__pyx_v_out[1]) = __pyx_v_sum_square;
</pre><pre class="cython line score-0">&#xA0;<span class="">788</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">789</span>:     return out</pre>
<pre class='cython code score-0 '>  __pyx_r = __pyx_v_out;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">790</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">791</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">792</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">793</span>: @cython.wraparound(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">794</span>: @cython.nonecheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">795</span>: @cython.cdivision(True)</pre>
<pre class="cython line score-0">&#xA0;<span class="">796</span>: @cython.initializedcheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">797</span>: @cython.overflowcheck(False)</pre>
<pre class="cython line score-27" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">798</span>: cdef double[::1] simulateGetStdMag(Model model, long nSamples = int(1e2), int abs=1) nogil:</pre>
<pre class='cython code score-27 '>static __Pyx_memviewslice __pyx_f_7Toolbox_8infcyIDL_simulateGetStdMag(struct __pyx_obj_6Models_6models_Model *__pyx_v_model, struct __pyx_opt_args_7Toolbox_8infcyIDL_simulateGetStdMag *__pyx_optional_args) {
  long __pyx_v_nSamples = __pyx_k__15;
  int __pyx_v_abs = ((int)1);
  __Pyx_memviewslice __pyx_v_r = { 0, 0, { 0 }, { 0 }, { 0 } };
  long __pyx_v_step;
  double __pyx_v_avg;
  double __pyx_v_m;
  double __pyx_v_std;
  std::vector&lt;double&gt;  __pyx_v_mags;
  __Pyx_memviewslice __pyx_v_out = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_r = { 0, 0, { 0 }, { 0 }, { 0 } };
  #ifdef WITH_THREAD
  PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
  #endif
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("simulateGetStdMag", 0);
  if (__pyx_optional_args) {
    if (__pyx_optional_args-&gt;__pyx_n &gt; 0) {
      __pyx_v_nSamples = __pyx_optional_args-&gt;nSamples;
      if (__pyx_optional_args-&gt;__pyx_n &gt; 1) {
        __pyx_v_abs = __pyx_optional_args-&gt;abs;
      }
    }
  }
  #ifdef WITH_THREAD
  <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
  #endif
/* … */
  /* function exit code */
  __Pyx_pretend_to_initialize(&amp;__pyx_r);
  goto __pyx_L0;
  __pyx_L1_error:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_6, 0);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_10, 0);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_11, 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_14);
  __pyx_r.data = NULL;
  __pyx_r.memview = NULL;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Toolbox.infcyIDL.simulateGetStdMag", __pyx_clineno, __pyx_lineno, __pyx_filename);
  goto __pyx_L2;
  __pyx_L0:;
  if (unlikely(!__pyx_r.memview)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "Memoryview return value is not initialized");
  }
  __pyx_L2:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_r, 0);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_out, 0);
  #ifdef WITH_THREAD
  <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
  #endif
  return __pyx_r;
}
/* … */
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyNumber_Int</span>(__pyx_float_1e2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 798, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_2); if (unlikely((__pyx_t_3 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 798, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_k__15 = __pyx_t_3;
/* … */
struct __pyx_opt_args_7Toolbox_8infcyIDL_simulateGetStdMag {
  int __pyx_n;
  long nSamples;
  int abs;
};
</pre><pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">799</span>:     cdef:</pre>
<pre class='cython code score-4 '>  /*try:*/ {
/* … */
  /*finally:*/ {
    __pyx_L3_return: {
      #ifdef WITH_THREAD
      __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
      #endif
      goto __pyx_L0;
    }
    __pyx_L4_error: {
      #ifdef WITH_THREAD
      __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
      #endif
      goto __pyx_L1_error;
    }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">800</span>:         long[:, ::1] r = model.sampleNodes(nSamples)</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = ((struct __pyx_vtabstruct_6Models_6models_Model *)__pyx_v_model-&gt;__pyx_vtab)-&gt;sampleNodes(__pyx_v_model, __pyx_v_nSamples);<span class='error_goto'> if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 800, __pyx_L4_error)</span>
    __pyx_v_r = __pyx_t_1;
    __pyx_t_1.memview = NULL;
    __pyx_t_1.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">801</span>:         long step</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">802</span>:         double avg = 0, m, std = 0</pre>
<pre class='cython code score-0 '>    __pyx_v_avg = 0.0;
    __pyx_v_std = 0.0;
</pre><pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">803</span>:         vector[double] mags = vector[double] (nSamples, 0)</pre>
<pre class='cython code score-4 '>    try {
      __pyx_t_2 = std::vector&lt;double&gt; (__pyx_v_nSamples, 0.0);
    } catch(...) {
      #ifdef WITH_THREAD
      PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
      #endif
      __Pyx_CppExn2PyErr();
      #ifdef WITH_THREAD
      <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
      #endif
      <span class='error_goto'>__PYX_ERR(0, 803, __pyx_L4_error)</span>
    }
    __pyx_v_mags = __pyx_t_2;
</pre><pre class="cython line score-0">&#xA0;<span class="">804</span>:         double[::1] out</pre>
<pre class="cython line score-0">&#xA0;<span class="">805</span>: </pre>
<pre class="cython line score-28" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">806</span>:     with gil: out = np.zeros(2)</pre>
<pre class='cython code score-28 '>    {
        #ifdef WITH_THREAD
        PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
        #endif
        /*try:*/ {
          <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 806, __pyx_L7_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
          __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 806, __pyx_L7_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_t_4 = NULL;
          if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
            __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
            if (likely(__pyx_t_4)) {
              PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
              <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
            }
          }
          __pyx_t_3 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_4, __pyx_int_2) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_5, __pyx_int_2);
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
          if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 806, __pyx_L7_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dc_double</span>(__pyx_t_3, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 806, __pyx_L7_error)</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_v_out = __pyx_t_6;
          __pyx_t_6.memview = NULL;
          __pyx_t_6.data = NULL;
        }
        /*finally:*/ {
          /*normal exit:*/{
            #ifdef WITH_THREAD
            <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
            #endif
            goto __pyx_L8;
          }
          __pyx_L7_error: {
            #ifdef WITH_THREAD
            <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
            #endif
            goto __pyx_L4_error;
          }
          __pyx_L8:;
        }
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">807</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">808</span>:     # collect magnetizations</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">809</span>:     for step in range(nSamples):</pre>
<pre class='cython code score-0 '>    __pyx_t_7 = __pyx_v_nSamples;
    __pyx_t_8 = __pyx_t_7;
    for (__pyx_t_9 = 0; __pyx_t_9 &lt; __pyx_t_8; __pyx_t_9+=1) {
      __pyx_v_step = __pyx_t_9;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">810</span>:         m = mean(model._updateState(r[step]), model._nNodes, abs)</pre>
<pre class='cython code score-0 '>      __pyx_t_10.data = __pyx_v_r.data;
      __pyx_t_10.memview = __pyx_v_r.memview;
      __PYX_INC_MEMVIEW(&amp;__pyx_t_10, 0);
      {
    Py_ssize_t __pyx_tmp_idx = __pyx_v_step;
    Py_ssize_t __pyx_tmp_stride = __pyx_v_r.strides[0];
        if ((0)) <span class='error_goto'>__PYX_ERR(0, 810, __pyx_L4_error)</span>
        __pyx_t_10.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_10.shape[0] = __pyx_v_r.shape[1];
__pyx_t_10.strides[0] = __pyx_v_r.strides[1];
    __pyx_t_10.suboffsets[0] = -1;

__pyx_t_11 = ((struct __pyx_vtabstruct_6Models_6models_Model *)__pyx_v_model-&gt;__pyx_vtab)-&gt;_updateState(__pyx_v_model, __pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 810, __pyx_L4_error)</span>
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_10, 0);
      __pyx_t_10.memview = NULL;
      __pyx_t_10.data = NULL;
      __pyx_t_13.__pyx_n = 1;
      __pyx_t_13.abs = __pyx_v_abs;
      __pyx_t_12 = __pyx_f_7Toolbox_8infcyIDL_mean(__pyx_t_11, __pyx_v_model-&gt;_nNodes, &amp;__pyx_t_13); 
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_11, 0);
      __pyx_t_11.memview = NULL;
      __pyx_t_11.data = NULL;
      __pyx_v_m = __pyx_t_12;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">811</span>:         mags[step] = m</pre>
<pre class='cython code score-0 '>      (__pyx_v_mags[__pyx_v_step]) = __pyx_v_m;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">812</span>:         avg = avg + m</pre>
<pre class='cython code score-0 '>      __pyx_v_avg = (__pyx_v_avg + __pyx_v_m);
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">813</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">814</span>:     avg = avg/(&lt;double&gt; nSamples)</pre>
<pre class='cython code score-0 '>    __pyx_v_avg = (__pyx_v_avg / ((double)__pyx_v_nSamples));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">815</span>:     for step in range(nSamples):</pre>
<pre class='cython code score-0 '>    __pyx_t_7 = __pyx_v_nSamples;
    __pyx_t_8 = __pyx_t_7;
    for (__pyx_t_9 = 0; __pyx_t_9 &lt; __pyx_t_8; __pyx_t_9+=1) {
      __pyx_v_step = __pyx_t_9;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">816</span>:         std = std + (mags[step] - avg)*(mags[step] - avg)</pre>
<pre class='cython code score-0 '>      __pyx_v_std = (__pyx_v_std + (((__pyx_v_mags[__pyx_v_step]) - __pyx_v_avg) * ((__pyx_v_mags[__pyx_v_step]) - __pyx_v_avg)));
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">817</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">818</span>:     std = sqrt(std/&lt;double&gt; nSamples)</pre>
<pre class='cython code score-0 '>    __pyx_v_std = sqrt((__pyx_v_std / ((double)__pyx_v_nSamples)));
</pre><pre class="cython line score-39" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">819</span>:     with gil: std = np.std(mags)</pre>
<pre class='cython code score-39 '>    {
        #ifdef WITH_THREAD
        PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
        #endif
        /*try:*/ {
          <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 819, __pyx_L14_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_std);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 819, __pyx_L14_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_5 = <span class='pyx_c_api'>__pyx_convert_vector_to_py_double</span>(__pyx_v_mags);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 819, __pyx_L14_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          __pyx_t_14 = NULL;
          if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
            __pyx_t_14 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
            if (likely(__pyx_t_14)) {
              PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_14);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
              <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
            }
          }
          __pyx_t_3 = (__pyx_t_14) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_14, __pyx_t_5) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, __pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 819, __pyx_L14_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_t_12 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_3); if (unlikely((__pyx_t_12 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 819, __pyx_L14_error)</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_v_std = __pyx_t_12;
        }
        /*finally:*/ {
          /*normal exit:*/{
            #ifdef WITH_THREAD
            <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
            #endif
            goto __pyx_L15;
          }
          __pyx_L14_error: {
            #ifdef WITH_THREAD
            <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
            #endif
            goto __pyx_L4_error;
          }
          __pyx_L15:;
        }
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">820</span>:     out[0] = avg</pre>
<pre class='cython code score-0 '>    __pyx_t_15 = 0;
    *((double *) ( /* dim=0 */ ((char *) (((double *) __pyx_v_out.data) + __pyx_t_15)) )) = __pyx_v_avg;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">821</span>:     out[1] = std</pre>
<pre class='cython code score-0 '>    __pyx_t_16 = 1;
    *((double *) ( /* dim=0 */ ((char *) (((double *) __pyx_v_out.data) + __pyx_t_16)) )) = __pyx_v_std;
</pre><pre class="cython line score-0">&#xA0;<span class="">822</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">823</span>:     return out</pre>
<pre class='cython code score-0 '>    __PYX_INC_MEMVIEW(&amp;__pyx_v_out, 1);
    __pyx_r = __pyx_v_out;
    goto __pyx_L3_return;
  }
</pre></div></body></html>
